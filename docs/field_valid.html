<!DOCTYPE html>
<html lang="en-US" xml:lang="en-US">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 5 Field Validation | SfM Processing Software Comparison</title>
  <meta name="description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 5 Field Validation | SfM Processing Software Comparison" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 5 Field Validation | SfM Processing Software Comparison" />
  
  <meta name="twitter:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="George Woolsey" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="stats_processing_time.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.2/leaflet.js"></script>
<script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />
<script type="text/javascript">

// toggle visibility of R source blocks in R Markdown output
function toggle_R() {
  var x = document.getElementsByClassName('r');
  if (x.length == 0) return;
  function toggle_vis(o) {
    var d = o.style.display;
    o.style.display = (d == 'block' || d == '') ? 'none':'block';
  }

  for (i = 0; i < x.length; i++) {
    var y = x[i];
    if (y.tagName.toLowerCase() === 'pre') toggle_vis(y);
  }

    var elem = document.getElementById("myButton1");
    if (elem.value === "Hide Code") elem.value = "Show Code";
    else elem.value = "Hide Code";
}

document.write('<input onclick="toggle_R();" type="button" value="Hide Code" id="myButton1" style="position: absolute; top: 10%; right: 2%; z-index: 200"></input>')

</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="sfm_data.html"><a href="sfm_data.html"><i class="fa fa-check"></i><b>2</b> SfM Image Processing Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="sfm_data.html"><a href="sfm_data.html#udp"><i class="fa fa-check"></i><b>2.1</b> User-Defined Parameters</a></li>
<li class="chapter" data-level="2.2" data-path="sfm_data.html"><a href="sfm_data.html#metashape-image-processing"><i class="fa fa-check"></i><b>2.2</b> Metashape Image Processing</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="sfm_data.html"><a href="sfm_data.html#metashape-report-pdf-data-extraction"><i class="fa fa-check"></i><b>2.2.1</b> Metashape Report PDF Data Extraction</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="sfm_data.html"><a href="sfm_data.html#metashape-report-data-exploration"><i class="fa fa-check"></i><b>2.3</b> Metashape Report Data Exploration</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="sfm_data.html"><a href="sfm_data.html#preliminaries"><i class="fa fa-check"></i><b>2.3.1</b> Preliminaries</a></li>
<li class="chapter" data-level="2.3.2" data-path="sfm_data.html"><a href="sfm_data.html#metashape-processing-time-summary"><i class="fa fa-check"></i><b>2.3.2</b> Metashape Processing Time Summary</a></li>
<li class="chapter" data-level="2.3.3" data-path="sfm_data.html"><a href="sfm_data.html#flight-and-sparse-cloud-metrics"><i class="fa fa-check"></i><b>2.3.3</b> Flight and Sparse Cloud Metrics</a></li>
<li class="chapter" data-level="2.3.4" data-path="sfm_data.html"><a href="sfm_data.html#metashape-dense-point-cloud-summary"><i class="fa fa-check"></i><b>2.3.4</b> Metashape Dense Point Cloud Summary</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ptcld_analysis.html"><a href="ptcld_analysis.html"><i class="fa fa-check"></i><b>3</b> <strong>R</strong> Point Cloud Processing</a>
<ul>
<li class="chapter" data-level="3.1" data-path="ptcld_analysis.html"><a href="ptcld_analysis.html#number-of-files-summary"><i class="fa fa-check"></i><b>3.1</b> Number of files summary</a></li>
<li class="chapter" data-level="3.2" data-path="ptcld_analysis.html"><a href="ptcld_analysis.html#processing-time-summary"><i class="fa fa-check"></i><b>3.2</b> Processing Time Summary</a></li>
<li class="chapter" data-level="3.3" data-path="ptcld_analysis.html"><a href="ptcld_analysis.html#processing-time-vs-points"><i class="fa fa-check"></i><b>3.3</b> Processing Time vs # Points</a></li>
<li class="chapter" data-level="3.4" data-path="ptcld_analysis.html"><a href="ptcld_analysis.html#processing-section-timing"><i class="fa fa-check"></i><b>3.4</b> Processing Section Timing</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="stats_processing_time.html"><a href="stats_processing_time.html"><i class="fa fa-check"></i><b>4</b> Statistical Analysis: Processing Time</a>
<ul>
<li class="chapter" data-level="4.1" data-path="stats_processing_time.html"><a href="stats_processing_time.html#one_pred_mod"><i class="fa fa-check"></i><b>4.1</b> One Nominal Predictor</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="stats_processing_time.html"><a href="stats_processing_time.html#summary-statistics"><i class="fa fa-check"></i><b>4.1.1</b> Summary Statistics</a></li>
<li class="chapter" data-level="4.1.2" data-path="stats_processing_time.html"><a href="stats_processing_time.html#linear-model"><i class="fa fa-check"></i><b>4.1.2</b> Linear Model</a></li>
<li class="chapter" data-level="4.1.3" data-path="stats_processing_time.html"><a href="stats_processing_time.html#anova"><i class="fa fa-check"></i><b>4.1.3</b> ANOVA</a></li>
<li class="chapter" data-level="4.1.4" data-path="stats_processing_time.html"><a href="stats_processing_time.html#one_pred_mod_bays"><i class="fa fa-check"></i><b>4.1.4</b> Bayesian</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="stats_processing_time.html"><a href="stats_processing_time.html#two_pred_mod"><i class="fa fa-check"></i><b>4.2</b> Two Nominal Predictors</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="stats_processing_time.html"><a href="stats_processing_time.html#summary-statistics-1"><i class="fa fa-check"></i><b>4.2.1</b> Summary Statistics</a></li>
<li class="chapter" data-level="4.2.2" data-path="stats_processing_time.html"><a href="stats_processing_time.html#linear-model-1"><i class="fa fa-check"></i><b>4.2.2</b> Linear Model</a></li>
<li class="chapter" data-level="4.2.3" data-path="stats_processing_time.html"><a href="stats_processing_time.html#anova-1"><i class="fa fa-check"></i><b>4.2.3</b> ANOVA</a></li>
<li class="chapter" data-level="4.2.4" data-path="stats_processing_time.html"><a href="stats_processing_time.html#two_pred_mod_bays"><i class="fa fa-check"></i><b>4.2.4</b> Bayesian</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="stats_processing_time.html"><a href="stats_processing_time.html#two-nominal-predictors-site-effects"><i class="fa fa-check"></i><b>4.3</b> Two Nominal Predictors + site effects</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="stats_processing_time.html"><a href="stats_processing_time.html#summary-statistics-2"><i class="fa fa-check"></i><b>4.3.1</b> Summary Statistics</a></li>
<li class="chapter" data-level="4.3.2" data-path="stats_processing_time.html"><a href="stats_processing_time.html#id_3_pred_mod_bays"><i class="fa fa-check"></i><b>4.3.2</b> Bayesian</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="stats_processing_time.html"><a href="stats_processing_time.html#gamma-two-nominal-predictors-site-effects"><i class="fa fa-check"></i><b>4.4</b> Gamma: Two Nominal Predictors + site effects</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="stats_processing_time.html"><a href="stats_processing_time.html#summary-statistics-3"><i class="fa fa-check"></i><b>4.4.1</b> Summary Statistics</a></li>
<li class="chapter" data-level="4.4.2" data-path="stats_processing_time.html"><a href="stats_processing_time.html#id_4_pred_mod_bays"><i class="fa fa-check"></i><b>4.4.2</b> Bayesian</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="field_valid.html"><a href="field_valid.html"><i class="fa fa-check"></i><b>5</b> Field Validation</a>
<ul>
<li class="chapter" data-level="5.1" data-path="field_valid.html"><a href="field_valid.html#setup"><i class="fa fa-check"></i><b>5.1</b> Setup</a></li>
<li class="chapter" data-level="5.2" data-path="field_valid.html"><a href="field_valid.html#data-load-functions"><i class="fa fa-check"></i><b>5.2</b> Data Load Functions</a></li>
<li class="chapter" data-level="5.3" data-path="field_valid.html"><a href="field_valid.html#validation-data-functions"><i class="fa fa-check"></i><b>5.3</b> Validation Data Functions</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="field_valid.html"><a href="field_valid.html#true-positive-identification"><i class="fa fa-check"></i><b>5.3.1</b> True Positive Identification</a></li>
<li class="chapter" data-level="5.3.2" data-path="field_valid.html"><a href="field_valid.html#combine-with-commission-and-omission"><i class="fa fa-check"></i><b>5.3.2</b> Combine with Commission and Omission</a></li>
<li class="chapter" data-level="5.3.3" data-path="field_valid.html"><a href="field_valid.html#full-validation-function"><i class="fa fa-check"></i><b>5.3.3</b> Full validation function</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="field_valid.html"><a href="field_valid.html#full-pipeline-function"><i class="fa fa-check"></i><b>5.4</b> Full pipeline function</a></li>
<li class="chapter" data-level="5.5" data-path="field_valid.html"><a href="field_valid.html#apply-validation-for-all"><i class="fa fa-check"></i><b>5.5</b> Apply validation for all</a></li>
<li class="chapter" data-level="5.6" data-path="field_valid.html"><a href="field_valid.html#example-validation-process"><i class="fa fa-check"></i><b>5.6</b> Example Validation Process</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="field_valid.html"><a href="field_valid.html#height-vs.-dbh-of-tp-co-om"><i class="fa fa-check"></i><b>5.6.1</b> Height vs. DBH of <span class="math inline">\(Tp\)</span>, <span class="math inline">\(Co\)</span>, <span class="math inline">\(Om\)</span></a></li>
<li class="chapter" data-level="5.6.2" data-path="field_valid.html"><a href="field_valid.html#height-and-dbh-distribution-tp-co-om"><i class="fa fa-check"></i><b>5.6.2</b> Height and DBH Distribution <span class="math inline">\(Tp\)</span>, <span class="math inline">\(Co\)</span>, <span class="math inline">\(Om\)</span></a></li>
<li class="chapter" data-level="5.6.3" data-path="field_valid.html"><a href="field_valid.html#detected-overstory-tp-height-difference"><i class="fa fa-check"></i><b>5.6.3</b> Detected Overstory (<span class="math inline">\(TP\)</span>) Height Difference</a></li>
<li class="chapter" data-level="5.6.4" data-path="field_valid.html"><a href="field_valid.html#detected-overstory-tp-dbh-difference"><i class="fa fa-check"></i><b>5.6.4</b> Detected Overstory (<span class="math inline">\(TP\)</span>) DBH Difference</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">SfM Processing Software Comparison</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="field_valid" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">Section 5</span> Field Validation<a href="field_valid.html#field_valid" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This section combines the SfM-derived tree locations with stem-mapped tree locations from field sampling.</p>
<p><a href="https://scholar.google.com/scholar?oi=bibs&amp;hl=en&amp;cluster=11260597505702247290">Tinkham and Swayze (2021; p.6)</a> describe a methodology for matching UAS <em>detected</em> trees with stem mapped trees identified via traditional field <em>survey</em> methods. Note, <em>detected</em> trees in the excerpt below references UAS detected trees while <em>survey</em> trees references field-based stem mapped trees:</p>
<p><em>Each of the detected tree outputs was matched with survey tree locations through an iterative process. Iteratively, a detected tree was selected, and all survey trees within a 3 m radius and 10% height of the detected tree were identified. If a survey tree met both the location and height precision requirements, it was considered a true positive (TP) detection, and both the survey and detected trees were removed from further matching. However, if no match was made, the detected tree was considered a commission (Co) and removed from further matching. This process was repeated until all detected trees were classified as true positive or commission, with all unmatched survey trees classified as omission (Om). Overall tree detection performance was described using the F-score metric.</em></p>
<p>The F-score incorporates true positive, commission, and omission rates to determine how well the UAS detected trees represent the field-based stem mapped trees. As a measure of predictive performance, the highest possible value of an F-score is 1.0, indicating perfect precision and recall, and the lowest possible value is 0, if either precision or recall are zero.</p>
<p><span class="math display">\[
\textrm{F-score} = 2 \times \frac{\bigl(\frac{TP}{TP+Om} \times \frac{TP}{TP+Co} \bigr)}{\bigl(\frac{TP}{TP+Om} + \frac{TP}{TP+Co} \bigr)}
\]</span></p>
<p>The process to match UAS detected trees to field stem mapped trees implemented here is slightly different than the process described above. To match the data parametrization from the UAS point cloud processing workflow, only stem-mapped trees above 2 m were considered for analysis. Each UAS detected tree was matched with stem-mapped tree locations that were within a 3 m radius and 2 m height of the UAS detected tree. The matched UAS and stem-mapped tree pairs were jointly compared (rather than iteratively) to select the pair that minimized the height difference for both the stem-mapped tree and the UAS detected tree to ensure that only one UAS detected tree was selected for each stem-mapped tree. If more than one UAS detected tree had the same height difference to a stem-mapped tree, the UAS detected tree spatially nearest to the stem-mapped tree was selected as the match. These UAS detected trees with a paired stem-mapped tree after this filtering process were considered true positive (<span class="math inline">\(TP\)</span>) detections.</p>
<p>To determine UAS detected tree commissions (i.e. UAS detected trees within the overstory plot for which there was no stem-mapped tree pair; <span class="math inline">\(Co\)</span>) this analysis used the 2023-06 BHEF overstory field survey plot center and plot radius with a minimum DBH of 5 in (12.69 cm) as only trees above this size were sampled as part of the overstory survey. UAS detected trees within this radius with an <a href="#local_mod">estimated DBH</a> over 5 in (12.69 cm) that did not have a matched stem-mapped tree pair were considered commissions (<span class="math inline">\(Co\)</span>). The 2023-06 BHEF field surveys used <span class="math inline">\(\frac{1}{10}\)</span> acre (404.686 m<sup>2</sup>) plots with a 37.24 ft (11.35 m) radius for overstory sampling and <span class="math inline">\(\frac{1}{400}\)</span> acre (10.117 m<sup>2</sup>) plots with a 5.89 ft (1.795 m) radius for regeneration sampling. All unmatched stem-mapped survey trees were classified as omissions (<span class="math inline">\(Om\)</span>).</p>
<div id="setup" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Setup<a href="field_valid.html#setup" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Update the <code>ptcld_processing_data</code> created in <a href="ptcld_analysis.html#ptcld_analysis">this section</a></p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="field_valid.html#cb129-1" tabindex="-1"></a><span class="co"># list of study sites with completed uas data</span></span>
<span id="cb129-2"><a href="field_valid.html#cb129-2" tabindex="-1"></a>study_site_list <span class="ot">=</span> ptcld_processing_data<span class="sc">$</span>study_site <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="sc">%&gt;%</span> <span class="fu">toupper</span>()</span>
<span id="cb129-3"><a href="field_valid.html#cb129-3" tabindex="-1"></a></span>
<span id="cb129-4"><a href="field_valid.html#cb129-4" tabindex="-1"></a><span class="co"># list of field validation data</span></span>
<span id="cb129-5"><a href="field_valid.html#cb129-5" tabindex="-1"></a>validation_data <span class="ot">=</span></span>
<span id="cb129-6"><a href="field_valid.html#cb129-6" tabindex="-1"></a>  <span class="fu">list.files</span>(</span>
<span id="cb129-7"><a href="field_valid.html#cb129-7" tabindex="-1"></a>    <span class="st">&quot;../data/field_validation&quot;</span></span>
<span id="cb129-8"><a href="field_valid.html#cb129-8" tabindex="-1"></a>    , <span class="at">pattern =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.gpkg$&quot;</span>, <span class="at">full.names =</span> T</span>
<span id="cb129-9"><a href="field_valid.html#cb129-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb129-10"><a href="field_valid.html#cb129-10" tabindex="-1"></a>  <span class="fu">normalizePath</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb129-11"><a href="field_valid.html#cb129-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb129-12"><a href="field_valid.html#cb129-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">validation_file_full_path=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb129-13"><a href="field_valid.html#cb129-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb129-14"><a href="field_valid.html#cb129-14" tabindex="-1"></a>    <span class="at">study_site =</span> validation_file_full_path <span class="sc">%&gt;%</span> </span>
<span id="cb129-15"><a href="field_valid.html#cb129-15" tabindex="-1"></a>      <span class="fu">toupper</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb129-16"><a href="field_valid.html#cb129-16" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="at">pattern =</span> <span class="fu">paste</span>(study_site_list, <span class="at">collapse =</span> <span class="st">&quot;|&quot;</span>))</span>
<span id="cb129-17"><a href="field_valid.html#cb129-17" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb129-18"><a href="field_valid.html#cb129-18" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(study_site <span class="sc">%in%</span> study_site_list) <span class="sc">%&gt;%</span> </span>
<span id="cb129-19"><a href="field_valid.html#cb129-19" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(study_site) <span class="sc">%&gt;%</span> </span>
<span id="cb129-20"><a href="field_valid.html#cb129-20" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(dplyr<span class="sc">::</span><span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb129-21"><a href="field_valid.html#cb129-21" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span>
<span id="cb129-22"><a href="field_valid.html#cb129-22" tabindex="-1"></a></span>
<span id="cb129-23"><a href="field_valid.html#cb129-23" tabindex="-1"></a><span class="co"># what about the field plot boundary?</span></span>
<span id="cb129-24"><a href="field_valid.html#cb129-24" tabindex="-1"></a>validation_plots <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">&quot;../data/field_validation/Field_Data_Boundary.shp&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb129-25"><a href="field_valid.html#cb129-25" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename_with</span>(tolower) <span class="sc">%&gt;%</span> </span>
<span id="cb129-26"><a href="field_valid.html#cb129-26" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb129-27"><a href="field_valid.html#cb129-27" tabindex="-1"></a>    <span class="at">study_site =</span> site <span class="sc">%&gt;%</span> </span>
<span id="cb129-28"><a href="field_valid.html#cb129-28" tabindex="-1"></a>      <span class="fu">toupper</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb129-29"><a href="field_valid.html#cb129-29" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="at">pattern =</span> <span class="fu">paste</span>(study_site_list, <span class="at">collapse =</span> <span class="st">&quot;|&quot;</span>))</span>
<span id="cb129-30"><a href="field_valid.html#cb129-30" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb129-31"><a href="field_valid.html#cb129-31" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(study_site <span class="sc">%in%</span> study_site_list) <span class="sc">%&gt;%</span> </span>
<span id="cb129-32"><a href="field_valid.html#cb129-32" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(study_site) <span class="sc">%&gt;%</span> </span>
<span id="cb129-33"><a href="field_valid.html#cb129-33" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(dplyr<span class="sc">::</span><span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb129-34"><a href="field_valid.html#cb129-34" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span></code></pre></div>
<pre><code>## Reading layer `Field_Data_Boundary&#39; from data source 
##   `C:\Data\usfs\metashape_testing\data\field_validation\Field_Data_Boundary.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 5 features and 4 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: -157287.6 ymin: 4068511 xmax: 608828.5 ymax: 4892131
## Projected CRS: WGS 84 / UTM zone 13N</code></pre>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="field_valid.html#cb131-1" tabindex="-1"></a><span class="co"># where is the uas processed data?</span></span>
<span id="cb131-2"><a href="field_valid.html#cb131-2" tabindex="-1"></a>ptcld_processing_data <span class="ot">=</span></span>
<span id="cb131-3"><a href="field_valid.html#cb131-3" tabindex="-1"></a>  ptcld_processing_data <span class="sc">%&gt;%</span> </span>
<span id="cb131-4"><a href="field_valid.html#cb131-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb131-5"><a href="field_valid.html#cb131-5" tabindex="-1"></a>    <span class="at">processed_data_dir =</span> <span class="fu">dirname</span>(tracking_file_full_path)</span>
<span id="cb131-6"><a href="field_valid.html#cb131-6" tabindex="-1"></a>    , <span class="at">processing_id =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()</span>
<span id="cb131-7"><a href="field_valid.html#cb131-7" tabindex="-1"></a>  )</span></code></pre></div>
<p>where are these validation plots and what do they look like?</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="field_valid.html#cb132-1" tabindex="-1"></a><span class="co"># what?</span></span>
<span id="cb132-2"><a href="field_valid.html#cb132-2" tabindex="-1"></a>validation_plots <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 5
## Columns: 6
## $ id         &lt;dbl&gt; NA, NA, NA, NA, NA
## $ site       &lt;chr&gt; &quot;WA85_02&quot;, &quot;SQ09_02&quot;, &quot;N1&quot;, &quot;Kaibab_Low&quot;, &quot;Kaibab_High&quot;
## $ acres      &lt;dbl&gt; 2.476617, 2.476617, 3.911949, 5.059504, 4.264751
## $ hectares   &lt;dbl&gt; 1.002679, 1.002679, 1.583785, 2.048382, 1.726620
## $ geometry   &lt;POLYGON [m]&gt; POLYGON ((608678.6 4892131,..., POLYGON ((608720.2 4889252,…
## $ study_site &lt;chr&gt; &quot;WA85_02&quot;, &quot;SQ09_02&quot;, &quot;N1&quot;, &quot;KAIBAB_LOW&quot;, &quot;KAIBAB_HIGH&quot;</code></pre>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="field_valid.html#cb134-1" tabindex="-1"></a><span class="co"># where?</span></span>
<span id="cb134-2"><a href="field_valid.html#cb134-2" tabindex="-1"></a>mapview<span class="sc">::</span><span class="fu">mapviewOptions</span>(<span class="at">basemaps =</span> <span class="fu">c</span>(<span class="st">&quot;Stadia.StamenTonerLite&quot;</span>,<span class="st">&quot;Esri.WorldImagery&quot;</span>))</span>
<span id="cb134-3"><a href="field_valid.html#cb134-3" tabindex="-1"></a>validation_plots <span class="sc">%&gt;%</span> </span>
<span id="cb134-4"><a href="field_valid.html#cb134-4" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_buffer</span>(<span class="dv">2000</span>) <span class="sc">%&gt;%</span> <span class="co"># because they are small</span></span>
<span id="cb134-5"><a href="field_valid.html#cb134-5" tabindex="-1"></a>  mapview<span class="sc">::</span><span class="fu">mapview</span>(<span class="at">col.regions =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">layer.name =</span> <span class="st">&quot;plot&quot;</span>, <span class="at">alpha.regions =</span> <span class="fl">0.7</span>)</span></code></pre></div>
<div class="leaflet html-widget html-fill-item" id="htmlwidget-66d3adbc3cd9e8f6e8ca" style="width:1008px;height:672px;"></div>
<script type="application/json" data-for="htmlwidget-66d3adbc3cd9e8f6e8ca">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["Stadia.StamenTonerLite","Stadia.StamenTonerLite","Stadia.StamenTonerLite",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["polygon",420]},{"method":"addPolygons","args":[[[[{"lng":[-103.6654439198562,-103.6653215856702,-103.665131337244,-103.664873691641,-103.6645493503201,-103.6641591972508,-103.6637042965266,-103.6631858894854,-103.6626053913417,-103.6619643873413,-103.6612646284481,-103.6605080265751,-103.6596966493711,-103.6588327145793,-103.6579185839808,-103.6569567569414,-103.6559498635781,-103.6549006575643,-103.6538120085941,-103.6526868945245,-103.6515283932201,-103.6503396741192,-103.649123989548,-103.647884665804,-103.6466250940348,-103.6453487209382,-103.6440590393066,-103.6427595784452,-103.641453894488,-103.6401455606401,-103.6388381573722,-103.6375900262401,-103.6362859587889,-103.6349899842291,-103.6337056555114,-103.6324364935663,-103.6311859776277,-103.629957535671,-103.6287545349947,-103.6275802729699,-103.6264379679842,-103.6253307506051,-103.6242616549866,-103.6232336105433,-103.6222494339158,-103.621311821247,-103.6204233407936,-103.6195864258912,-103.6188033682922,-103.618076311896,-103.6174072468874,-103.6167980042994,-103.616250251016,-103.615765485227,-103.6153450323481,-103.614990041417,-103.6147014819749,-103.6144801414418,-103.6143266229921,-103.6142413439368,-103.6142245346153,-103.6142762377996,-103.6143584899702,-103.6144788398921,-103.6146674730526,-103.6149238677341,-103.6152473160526,-103.6156369259371,-103.6160916236135,-103.6166101565855,-103.6171910971056,-103.6178328461237,-103.618533637705,-103.6192915439032,-103.6201044800748,-103.6209702106225,-103.621886355148,-103.6228503950004,-103.6238596802007,-103.6249114367233,-103.6260027741146,-103.627130693429,-103.6282920954582,-103.6294837892343,-103.6307025007807,-103.6319448820892,-103.6332075202969,-103.6344869470405,-103.6357796479598,-103.6370820723261,-103.6383906427704,-103.6397017650819,-103.6410118380541,-103.642262115433,-103.6435656757592,-103.6448610325447,-103.6461446379675,-103.6474129762981,-103.6486625735045,-103.6498900067444,-103.651091913719,-103.6522650018633,-103.6534060573482,-103.6545119538688,-103.6555796611968,-103.6566062534721,-103.6575889172127,-103.6585249590191,-103.659411812954,-103.6602470475759,-103.6610283726078,-103.6617536452231,-103.6624208759301,-103.6630282340406,-103.6635740527053,-103.6640568335049,-103.6644752505807,-103.6648281542963,-103.6651145744173,-103.6653337228024,-103.6654849955962,-103.665567974919,-103.665582430047,-103.6655283180804,-103.6654439198562],"lat":[44.17551948552146,44.17645677261628,44.17738817577507,44.1783111480115,44.17922316527786,44.18012173337156,44.18100439476109,44.18186873531295,44.18271239090093,44.18353305387951,44.18432847940377,44.18509649157825,44.18583498941788,44.18654195260456,44.18721544702357,44.18785363006432,44.18845475567123,44.18901717913032,44.18953936157857,44.19001987422342,44.19045740226107,44.19085074848221,44.19119883655565,44.1915007139806,44.19175555469935,44.19196266136328,44.19212146724575,44.19223153779667,44.19229257183455,44.19230440237236,44.19226699707539,44.19220772554947,44.19212107208815,44.19198543390508,44.19180118290144,44.19156882424833,44.19128899499772,44.19096246233097,44.19059012144983,44.19017299311557,44.18971222084358,44.18920906776062,44.18866491313381,44.18808124858086,44.18745967397227,44.18680189303647,44.18610970868033,44.18538501803814,44.18462980726227,44.18384614607044,44.1830361820645,44.18220213483614,44.18134628987628,44.18047099230451,44.17957864043617,44.17867167920469,44.17775259345715,44.17682390114181,44.17588814640603,44.17494789262388,44.17400571537208,44.1730641953741,44.17216406106599,44.17122406206701,44.17028989488488,44.16936412732487,44.16844930398609,44.16754793927144,44.16666251048166,44.16579545101247,44.16494914367355,44.16412591414745,44.16332802460646,44.16255766750461,44.16181695956226,44.16110793595902,44.16043254475137,44.15979264152992,44.15918998433098,44.15862622881617,44.15810292373323,44.15762150667045,44.15718330011622,44.15678950783423,44.1564412115645,44.1561393680589,44.15588480645934,44.15567822602568,44.15552019421975,44.15541114515026,44.15535137838316,44.15534105812062,44.15538021275081,44.15544123866248,44.15552958412682,44.15566691354945,44.15585285084718,44.15608688680223,44.15636838045274,44.15669656084336,44.15707052913104,44.15748926104034,44.15795160966159,44.1584563085846,44.15900197535909,44.15958711527259,44.16021012543575,44.16086929916379,44.16156283064229,44.16228881986467,44.16304527782799,44.16383013197284,44.16464123185284,44.16547635501793,44.16633321309573,44.16720945805442,44.16810268862996,44.16901045690015,44.1699302749877,44.17085962187399,44.17179595030472,44.17273669376891,44.17367927353191,44.17462110570319,44.17551948552146]}]],[[{"lng":[-103.6655076423376,-103.6655613978918,-103.6655467948539,-103.6654638698963,-103.6653128465261,-103.6650941345089,-103.6648083287832,-103.6644562078672,-103.6640387317622,-103.6635570393579,-103.6630124453463,-103.662406436653,-103.6617406683946,-103.661016959373,-103.660237287119,-103.6594037824992,-103.6585187238991,-103.6575845310001,-103.6566037581659,-103.6555790874573,-103.6545133212938,-103.6534093747827,-103.6522702677365,-103.6510991164005,-103.6498991249133,-103.6486735765245,-103.6474258245927,-103.6461592833892,-103.6448774187339,-103.6435837384868,-103.6422817829245,-103.6410344499464,-103.6397265964286,-103.6384176087066,-103.6371110755216,-103.635810578861,-103.6345196841115,-103.6332419302582,-103.6319808201573,-103.6307398109091,-103.6295223043582,-103.6283316377473,-103.6271710745505,-103.6260437955111,-103.6249528899092,-103.6239013470831,-103.6228920482281,-103.6219277584941,-103.6210111194063,-103.6201446416268,-103.6193306980787,-103.6185715174526,-103.6178691781093,-103.6172256024005,-103.6166425514184,-103.6161216201912,-103.6156642333361,-103.6152716411823,-103.6149449163734,-103.6146849509595,-103.6144924539848,-103.6143679495794,-103.6142814343289,-103.6142252220896,-103.6142377410458,-103.6143189534991,-103.6144686329325,-103.614686364669,-103.6149715470461,-103.6153233931041,-103.6157409327818,-103.6162230156141,-103.6167683139224,-103.6173753264914,-103.6180423827184,-103.6187676472266,-103.6195491249272,-103.620384666518,-103.6212719744015,-103.6222086090076,-103.6231919955028,-103.6242194308672,-103.6252880913206,-103.6263950400762,-103.6275372354025,-103.6287115389686,-103.6299147244535,-103.6311434863934,-103.6323944492433,-103.6336641766298,-103.6349491807678,-103.6362459320177,-103.6375508685548,-103.6388006537946,-103.6401083085187,-103.6414169707299,-103.6427230562809,-103.6440229880561,-103.6453132057421,-103.646590175553,-103.6478503998838,-103.6490904268663,-103.6503068598016,-103.6514963664432,-103.652655688106,-103.6537816485766,-103.6548711628003,-103.655921245321,-103.6569290184529,-103.6578917201582,-103.6588067116134,-103.6596714844402,-103.6604836675835,-103.6612410338158,-103.6619415058515,-103.6625831620539,-103.6631642417188,-103.6636831499196,-103.6641384619022,-103.6645289270153,-103.6648534721662,-103.6651112047924,-103.6653014153397,-103.6654235792412,-103.6655076423376],"lat":[44.14717826896889,44.14811889061633,44.14906024942361,44.14999977149073,44.15093488781895,44.15186304133692,44.15278169389543,44.1536883332117,44.15458047974427,44.15545569347935,44.15631158061024,44.15714580009151,44.15795607004959,44.15874017403252,44.15949596708148,44.16022138160728,44.16091443305582,44.16157322534675,44.16219595607039,44.16278092142847,44.16332652090526,44.16383126165579,44.16429376259951,44.16471275820773,44.16508710197436,44.16541576956056,44.16569786160452,44.16593260618827,44.16611936095536,44.16625761487275,44.16634698963267,44.16640896430325,44.16644921518592,44.16644014307226,44.16638177287567,44.16627426466432,44.16611791322052,44.16591314723014,44.16566052810354,44.16536074843214,44.16501463008424,44.1646231219458,44.16418729731226,44.1637083509386,44.16318759575617,44.16262645926492,44.16202647961132,44.16138930136294,44.16071667099109,44.16001043207427,44.15927252023562,44.15850495782849,44.1577098483845,44.15688937083998,44.15604577355611,44.15518136814979,44.15429852315192,44.15339965751078,44.15248723395815,44.15156375225681,44.15063174234754,44.14969375741487,44.14879382826378,44.14785071100957,44.14690676855438,44.14596459588648,44.14502678300673,44.1440959078102,44.14317452900261,44.14226517907071,44.14137035732577,44.14049252303983,44.13963408869282,44.13879741334942,44.13798479618351,44.13719847016841,44.13644059594932,44.13571325591556,44.13501844848805,44.13435808263804,44.13373397265192,44.13314783315614,44.1326012744163,44.1320957979224,44.13163279227318,44.13121352936987,44.13083916093031,44.13051071533265,44.13022909479707,44.12999507291357,44.12980929252213,44.12967226395109,44.12958436361883,44.12952391948907,44.12948539439147,44.12949620294881,44.12955631559991,44.12966556774828,44.12982366021123,44.13003016003676,44.13028450168564,44.13058598857595,44.13093379498559,44.13132696830771,44.13176443165304,44.13224498679202,44.13276731742876,44.13332999279793,44.1339314715751,44.13457010608946,44.13524414682809,44.13595174721905,44.13669096868061,44.13745978592295,44.13825609248766,44.13907770651029,44.13992237669007,44.14078778845073,44.14167157027552,44.14257130019917,44.1434845124392,44.14440870414843,44.14534134227023,44.14627987047776,44.14717826896889]}]],[[{"lng":[-105.1373080722283,-105.1373610412824,-105.1373500870959,-105.1372752373705,-105.137136696376,-105.1369348444139,-105.1366702367943,-105.1363436023286,-105.1359558413408,-105.1355080232047,-105.1350013834119,-105.1344373201781,-105.1338173905988,-105.1331433063633,-105.1324169290381,-105.1316402649352,-105.130815459576,-105.1299447917687,-105.129030667314,-105.1280756123571,-105.1270822664038,-105.1260533750214,-105.1249917822422,-105.1239004226939,-105.1227823134754,-105.1216405458033,-105.1204782764512,-105.1192987190051,-105.1181051349612,-105.1169008246884,-105.1156891182834,-105.1141750107835,-105.1129746768253,-105.1117736358302,-105.1105751252995,-105.1093823758985,-105.1081986027277,-105.1070269966376,-105.1058707156081,-105.1047328762192,-105.103616545233,-105.1025247313124,-105.1014603768978,-105.100426350264,-105.0994254377794,-105.0984603363878,-105.0975336463338,-105.0966478641515,-105.0958053759344,-105.0950084509064,-105.0942592353102,-105.0935597466289,-105.0929118681586,-105.0923173439434,-105.0917777740896,-105.0912946104689,-105.0908691528241,-105.0905025452856,-105.0901957733102,-105.0899496610479,-105.0897648691458,-105.0896418929922,-105.0895351370175,-105.0894737363945,-105.0894771145719,-105.0895452594714,-105.0896779776582,-105.0898748949113,-105.0901354573009,-105.0904589327665,-105.0908444131942,-105.0912908169849,-105.0917968921064,-105.0923612196212,-105.0929822176797,-105.0936581459663,-105.0943871105876,-105.0951670693872,-105.0959958376731,-105.0968710943417,-105.0977903883795,-105.0987511457268,-105.0997506764822,-105.1007861824287,-105.10185476486,-105.1029534326854,-105.1040791107912,-105.1052286486336,-105.1063988290422,-105.1075863772062,-105.1087879698217,-105.1100002443722,-105.1112198085178,-105.1127436412672,-105.1139465701205,-105.1151499938376,-105.116350656786,-105.1175453107851,-105.1187307238744,-105.1199036890365,-105.1210610328553,-105.122199624083,-105.1233163820947,-105.1244082852077,-105.1254723788429,-105.1265057835065,-105.1275057025703,-105.1284694298312,-105.1293943568268,-105.1302779798902,-105.1311179069235,-105.1319118638717,-105.1326577008801,-105.1333533981182,-105.1339970712541,-105.1345869765653,-105.1351215156708,-105.1355992398721,-105.1360188540923,-105.1363792204,-105.1366793611108,-105.1369184614562,-105.137095871813,-105.1372111094868,-105.1373080722283],"lat":[39.12604448542826,39.12699093221924,39.12793823926054,39.12888378903305,39.12982496876969,39.13075917767594,39.13168383411853,39.13259638276229,39.13349430163533,39.1343751091031,39.135236370732,39.13607570602327,39.13689079499893,39.13767938462091,39.13843929502606,39.13916842555933,39.13986476058858,39.14052637508468,39.14115143995143,39.14173822709051,39.14228511418717,39.14279058920356,39.14325325456694,39.14367183104117,39.14404516127077,39.1443722129875,39.14465208187051,39.14488399405231,39.14506730826317,39.14520151760827,39.1452862509725,39.14536093817109,39.14539581334024,39.14538213596521,39.14531994291048,39.14520940181709,39.14505081064969,39.14484459689162,39.14459131639007,39.14429165185454,39.14394641101261,39.14355652442805,39.14312304298743,39.14264713506167,39.14213008335066,39.14157328141928,39.14097822993441,39.14034653261297,39.13967989189227,39.13898010433429,39.13824905577623,39.1374887162409,39.13670113462035,39.13588843314749,39.13505280167046,39.13419649174537,39.13332181056354,39.13243111472939,39.13152680390613,39.13061131434623,39.12968711232425,39.12875668748975,39.12767372126567,39.12672120228324,39.12576748693125,39.1248152459909,39.12386714600805,39.12292584182708,39.12199396915869,39.12107413720236,39.12016892134432,39.11928085595108,39.1184124272789,39.11756606651904,39.11674414299776,39.11594895755061,39.11518273608883,39.11444762337646,39.11374567703476,39.11307886179116,39.11244904398843,39.11185798636945,39.11130734315196,39.11079865540707,39.11033334675416,39.10991271938454,39.10953795042414,39.10921008864622,39.10893005154241,39.10869862276069,39.10851644991721,39.10838404278803,39.10830177188576,39.10823054458807,39.10819874339842,39.10821572151201,39.10828143299366,39.10839570006785,39.10855821359862,39.10876853392404,39.10902609204307,39.10933019115159,39.1096800085235,39.11007459773179,39.11051289120379,39.11099370310367,39.11151573253433,39.11207756705043,39.11267768647283,39.11331446699437,39.11398618556599,39.11469102455133,39.11542707663745,39.1161923499883,39.11698477362741,39.11780220303492,39.11864242594424,39.11950316832263,39.12038210051956,39.12127684356638,39.12218497561028,39.12310403846512,39.12403154426163,39.12496498217895,39.12604448542826]}]],[[{"lng":[-112.354176702856,-112.3535524291608,-112.3528783965851,-112.3521564274631,-112.3513884740126,-112.3505766130623,-112.3497230404399,-112.3488300650359,-112.3479001025591,-112.3469356690002,-112.3459393738222,-112.3449139128953,-112.3438620611958,-112.3427866652881,-112.3416906356123,-112.3405769385954,-112.33944858861,-112.3383086398019,-112.3371601778081,-112.3360063113884,-112.3348501639937,-112.333694865294,-112.3325435426881,-112.3313993128201,-112.3302652731249,-112.3291444934253,-112.3280400076049,-112.3269548053788,-112.3258918241844,-112.3248539412158,-112.3235111384153,-112.3224934096217,-112.3215068238171,-112.3205540928796,-112.3196378354675,-112.3187605698125,-112.3179247067924,-112.3171325433004,-112.3163862559304,-112.3156878949951,-112.3150393788943,-112.3144424888477,-112.3138988640073,-112.3134099969626,-112.3129772296508,-112.3126017496833,-112.3122845870984,-112.3120266115487,-112.3118285299307,-112.3116908844637,-112.3116140512221,-112.3115982391248,-112.3116434893858,-112.3117496754251,-112.3119165032411,-112.3121435122436,-112.3124300765433,-112.3127754066958,-112.3131785518935,-112.3136384026002,-112.3141536936203,-112.314936313306,-112.3155069055159,-112.3161301788269,-112.3168044121146,-112.3175277438406,-112.3182981772002,-112.319113585642,-112.3199717187424,-112.3208702084193,-112.3218065754682,-112.3227782364018,-112.3237825105757,-112.3248166275784,-112.3258777348673,-112.3269629056289,-112.3280691468415,-112.3291934075181,-112.3303325871083,-112.3314835440341,-112.3326431043381,-112.3338080704195,-112.3349752298343,-112.3361413641356,-112.3373032577296,-112.3384577067247,-112.3396015277464,-112.3407315666975,-112.3418447074373,-112.3429378803571,-112.3440080708279,-112.3450523274986,-112.3460677704203,-112.3474502137276,-112.3484324160288,-112.3493804119612,-112.3502915954946,-112.3511634616183,-112.3519936132212,-112.352779767678,-112.3535197631223,-112.354211564391,-112.3548532686224,-112.3554431104932,-112.3559794670795,-112.3564608623296,-112.3568859711337,-112.3572536229824,-112.357562805201,-112.3578126657524,-112.3580025155994,-112.3581318306202,-112.3582002530729,-112.3582075926015,-112.3581538267845,-112.3580391012203,-112.3578637291519,-112.3576281906307,-112.3573331312202,-112.3569793602455,-112.35656784859,-112.3560997260478,-112.3555762782379,-112.3549989430872,-112.354176702856],"lat":[36.54856553500423,36.54935061765315,36.55010844783715,36.55083697479727,36.55153422699336,36.55219831744589,36.55282744884959,36.55341991844491,36.55397412263375,36.55448856132735,36.55496184201399,36.55539268353572,36.55577991956361,36.55612250176215,36.556419502634,36.55667011803746,36.55687366936955,36.55702960540894,36.55713750381351,36.55719707226841,36.55720814928164,36.55717070462464,36.55708483941698,36.55695078585464,36.55676890658278,36.55653969371448,36.55626376749841,36.55594187463863,36.55557488627159,36.55516379560532,36.55459648115253,36.55413867674267,36.55363846766726,36.5530972289478,36.55251644839457,36.5518977225105,36.55124275209583,36.55055333756569,36.54983137399361,36.54907884589487,36.54829782176374,36.54749044838003,36.54665894490075,36.54580559675288,36.54493274934451,36.54404280161167,36.54313819941836,36.54222142882846,36.54129500926777,36.54036148659522,36.53942342610232,36.53848340546006,36.53754400763281,36.53660781377874,36.53567739615614,36.53475531105532,36.53384409177548,36.53294624166575,36.53206422724964,36.53120047145163,36.53035734694463,36.5291571387964,36.52833520514746,36.52753858557752,36.52676947758926,36.52603000270854,36.52532220063878,36.52464802364165,36.52400933115941,36.5234078846939,36.52284534295595,36.52232325729859,36.52184306744664,36.52140609753405,36.52101355246016,36.52066651457469,36.52036594070041,36.52011265950161,36.51990736920584,36.51975063568462,36.51964289089877,36.5195844317122,36.5195754190779,36.51961587759758,36.51970569545686,36.51984462473564,36.5200322820931,36.5202681498252,36.52055157729193,36.52088178271026,36.52125785530797,36.52167875783242,36.52214332940729,36.52281510240553,36.52332115198296,36.52386805482663,36.52445430769138,36.52507829916809,36.52573831410619,36.52643253832078,36.52715906357206,36.52791589280297,36.52870094562082,36.52951206400846,36.53034701824857,36.53120351304565,36.53207919382847,36.53297165321607,36.53387843762938,36.53479705403064,36.53572497677193,36.53665965453416,36.53759851733761,36.53853898360465,36.53947846725531,36.54041438481625,36.54134416252368,36.54226524340059,36.54317509428886,36.54407121281709,36.54495113428467,36.54581243844336,36.54665275615758,36.54746977592517,36.54856553500423]}]],[[{"lng":[-112.3555214874187,-112.3549157371102,-112.3542594953469,-112.3535545393542,-112.3528027785714,-112.352006249487,-112.351167110127,-112.3502876342119,-112.3493702049969,-112.3484173088138,-112.3474315283304,-112.3464155355466,-112.3453720845459,-112.3443040040222,-112.3432141896024,-112.3421055959854,-112.3409812289189,-112.3398441370363,-112.3386974035761,-112.3375441380056,-112.3363874675731,-112.3352305288104,-112.3340764590098,-112.3329283876991,-112.3317894281366,-112.3306626688514,-112.3295511652502,-112.3284579313149,-112.3273859314139,-112.326338072248,-112.3253171949548,-112.3241069551166,-112.3231056400146,-112.3221374725005,-112.321205132419,-112.3203112002732,-112.3194581500739,-112.3186483424877,-112.3178840183003,-112.3171672922138,-112.316500146997,-112.3158844280014,-112.315321838062,-112.3148139327931,-112.3143621162957,-112.3139676372848,-112.3136315856504,-112.3133548894583,-112.3131383124021,-112.3129824517106,-112.3128877365175,-112.3128544266971,-112.3128826121699,-112.3129722126783,-112.3131229780337,-112.3133344888343,-112.3136061576501,-112.3139372306732,-112.3143267898272,-112.3147737553298,-112.3152768887023,-112.315959860324,-112.3165121595937,-112.3171166886659,-112.3177718055253,-112.3184757310524,-112.3192265538645,-112.3200222355118,-112.3208606160179,-112.321739419746,-112.3226562615777,-112.3236086533857,-112.3245940107841,-112.3256096601373,-112.3266528458087,-112.3277207376294,-112.3288104385679,-112.3299189925778,-112.3310433926048,-112.3321805887302,-112.3333274964291,-112.3344810049207,-112.3356379855898,-112.336795300455,-112.337949810662,-112.3390983849785,-112.3402379082695,-112.3413652899271,-112.3424774722361,-112.3435714386498,-112.3446442219555,-112.3456929123065,-112.3467146651012,-112.347995900721,-112.348998871817,-112.349968684429,-112.3509026483621,-112.3517981726903,-112.3526527729357,-112.3534640779557,-112.3542298365182,-112.3549479235459,-112.3556163460146,-112.3562332484861,-112.3567969182631,-112.3573057901501,-112.3577584508075,-112.3581536426864,-112.3584902675341,-112.3587673894586,-112.3589842375452,-112.3591402080161,-112.3592348659289,-112.3592679464063,-112.3592393553958,-112.3591491699555,-112.3589976380659,-112.3587851779668,-112.358512377022,-112.3581799901143,-112.3577889375746,-112.357340302651,-112.3568353285242,-112.3562754148784,-112.3555214874187],"lat":[36.54648576054278,36.5472811775154,36.54805008058602,36.54879038543402,36.54950008518201,36.55017725584271,36.55082006154156,36.55142675950111,36.55199570477328,36.5525253547067,36.55301427313702,36.55346113428851,36.55386472637644,36.55422395490022,36.55453784561854,36.55480554719792,36.5550263335279,36.55519960569605,36.55532489361779,36.55540185731609,36.55543028784783,36.55541010787428,36.55534137187384,36.55522426599664,36.5550591075613,36.55484634419524,36.55458655262088,36.55428043709083,36.55392882747671,36.55353267701643,36.55309305972627,36.55253875222456,36.55205158810561,36.55152260897335,36.55095327915484,36.55034517467482,36.54969997888625,36.54901947780331,36.54830555515005,36.54756018713826,36.54678543698935,36.54598344921543,36.54515644367537,36.54430670942277,36.54343659836262,36.54254851873437,36.54164492843987,36.54072832823415,36.53980125479871,36.53886627371579,36.53792597236382,36.5369829527533,36.5360398243233,36.53509919671828,36.53416367256557,36.53323584027318,36.53231826686817,36.53141349089524,36.53052401539519,36.52965230098268,36.52880075904235,36.52771900353725,36.52689780845409,36.52610094020563,36.52533056088986,36.52458876065059,36.52387755201273,36.52319886442861,36.52255453905025,36.52194632374189,36.5213758683456,36.52084472021351,36.520354320018,36.51990599785147,36.51950096962608,36.51914033378321,36.51882506832125,36.51855602814989,36.51833394277797,36.51815941434099,36.51803291597369,36.51795479053179,36.51792524966663,36.51794437325496,36.51801210918534,36.51812827350187,36.51829255090471,36.51850449560602,36.5187635325391,36.51906895891724,36.51941994613838,36.5198155420302,36.52025467342953,36.52084037818057,36.5213274586637,36.52185648457314,36.52242598855939,36.52303439099837,36.52368000436614,36.52436103791239,36.5250756026201,36.52582171643754,36.52659730976819,36.5274002312036,36.52822825348333,36.52907907966546,36.52995034949082,36.53083964592315,36.53174450184763,36.53266240690855,36.53359081446798,36.53452714866578,36.53546881156151,36.53641319033861,36.53735766455082,36.5382996133908,36.5392364229608,36.54016549352525,36.54108424672526,36.54199013273468,36.54288063733836,36.54375328891242,36.5446056652875,36.54543540047575,36.54648576054278]}]]],null,"plot",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"polygon","stroke":true,"color":"#333333","weight":0.5,"opacity":0.9,"fill":true,"fillColor":"#0000FF","fillOpacity":0.7,"smoothFactor":1,"noClip":false},["<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>1&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>2<\/td><th>site&emsp;<\/th><td>WA85_02&emsp;<\/td><\/tr><tr><td>3<\/td><th>acres&emsp;<\/th><td>2.476617&emsp;<\/td><\/tr><tr><td>4<\/td><th>hectares&emsp;<\/th><td>1.002679&emsp;<\/td><\/tr><tr><td>5<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><tr><td>6<\/td><th>study_site&emsp;<\/th><td>WA85_02&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>2&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>2<\/td><th>site&emsp;<\/th><td>SQ09_02&emsp;<\/td><\/tr><tr><td>3<\/td><th>acres&emsp;<\/th><td>2.476617&emsp;<\/td><\/tr><tr><td>4<\/td><th>hectares&emsp;<\/th><td>1.002679&emsp;<\/td><\/tr><tr><td>5<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><tr><td>6<\/td><th>study_site&emsp;<\/th><td>SQ09_02&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>3&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>2<\/td><th>site&emsp;<\/th><td>N1&emsp;<\/td><\/tr><tr><td>3<\/td><th>acres&emsp;<\/th><td>3.911949&emsp;<\/td><\/tr><tr><td>4<\/td><th>hectares&emsp;<\/th><td>1.583785&emsp;<\/td><\/tr><tr><td>5<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><tr><td>6<\/td><th>study_site&emsp;<\/th><td>N1&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>4&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>2<\/td><th>site&emsp;<\/th><td>Kaibab_Low&emsp;<\/td><\/tr><tr><td>3<\/td><th>acres&emsp;<\/th><td>5.059504&emsp;<\/td><\/tr><tr><td>4<\/td><th>hectares&emsp;<\/th><td>2.048382&emsp;<\/td><\/tr><tr><td>5<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><tr><td>6<\/td><th>study_site&emsp;<\/th><td>KAIBAB_LOW&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>5&emsp;<\/td><\/tr><tr><td>1<\/td><th>id&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>2<\/td><th>site&emsp;<\/th><td>Kaibab_High&emsp;<\/td><\/tr><tr><td>3<\/td><th>acres&emsp;<\/th><td>4.264751&emsp;<\/td><\/tr><tr><td>4<\/td><th>hectares&emsp;<\/th><td>1.726620&emsp;<\/td><\/tr><tr><td>5<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><tr><td>6<\/td><th>study_site&emsp;<\/th><td>KAIBAB_HIGH&emsp;<\/td><\/tr><\/table><\/div>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["1","2","3","4","5"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":1,"opacity":0.9,"fillOpacity":0.9799999999999999,"bringToFront":false,"sendToBack":false}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addLayersControl","args":[["Stadia.StamenTonerLite","Esri.WorldImagery"],"plot",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#0000FF"],"labels":["plot"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"","extra":null,"layerId":null,"className":"info legend","group":"plot"}]}],"limits":{"lat":[36.51792524966663,44.19230440237236],"lng":[-112.3592679464063,-103.6142245346153]},"fitBounds":[36.51792524966663,-112.3592679464063,44.19230440237236,-103.6142245346153,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
</div>
<div id="data-load-functions" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Data Load Functions<a href="field_valid.html#data-load-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>field validation data</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="field_valid.html#cb135-1" tabindex="-1"></a><span class="co"># function to read field data once per site</span></span>
<span id="cb135-2"><a href="field_valid.html#cb135-2" tabindex="-1"></a>read_field_data <span class="ot">&lt;-</span> <span class="cf">function</span>(my_study_site) {</span>
<span id="cb135-3"><a href="field_valid.html#cb135-3" tabindex="-1"></a>  d <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_read</span>(</span>
<span id="cb135-4"><a href="field_valid.html#cb135-4" tabindex="-1"></a>    validation_data <span class="sc">%&gt;%</span> </span>
<span id="cb135-5"><a href="field_valid.html#cb135-5" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(study_site <span class="sc">==</span> my_study_site) <span class="sc">%&gt;%</span> </span>
<span id="cb135-6"><a href="field_valid.html#cb135-6" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">pull</span>(validation_file_full_path)</span>
<span id="cb135-7"><a href="field_valid.html#cb135-7" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb135-8"><a href="field_valid.html#cb135-8" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb135-9"><a href="field_valid.html#cb135-9" tabindex="-1"></a>      <span class="at">study_site =</span> my_study_site</span>
<span id="cb135-10"><a href="field_valid.html#cb135-10" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb135-11"><a href="field_valid.html#cb135-11" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename_with</span>(tolower) <span class="sc">%&gt;%</span> </span>
<span id="cb135-12"><a href="field_valid.html#cb135-12" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb135-13"><a href="field_valid.html#cb135-13" tabindex="-1"></a>      <span class="at">field_dbh_cm =</span> dbh_cm</span>
<span id="cb135-14"><a href="field_valid.html#cb135-14" tabindex="-1"></a>      , <span class="at">field_tree_height_m =</span> ht_m</span>
<span id="cb135-15"><a href="field_valid.html#cb135-15" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb135-16"><a href="field_valid.html#cb135-16" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="st">&quot;geometry&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb135-17"><a href="field_valid.html#cb135-17" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb135-18"><a href="field_valid.html#cb135-18" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(field_dbh_cm)</span>
<span id="cb135-19"><a href="field_valid.html#cb135-19" tabindex="-1"></a>      <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(field_tree_height_m)</span>
<span id="cb135-20"><a href="field_valid.html#cb135-20" tabindex="-1"></a>      <span class="sc">&amp;</span> sf<span class="sc">::</span><span class="fu">st_is_valid</span>(geometry)</span>
<span id="cb135-21"><a href="field_valid.html#cb135-21" tabindex="-1"></a>      <span class="co"># only keep trees that are above height threshold used for uas processing</span></span>
<span id="cb135-22"><a href="field_valid.html#cb135-22" tabindex="-1"></a>      <span class="sc">&amp;</span> field_tree_height_m <span class="sc">&gt;=</span> <span class="fu">min</span>(ptcld_processing_data<span class="sc">$</span>sttng_minimum_tree_height_m)</span>
<span id="cb135-23"><a href="field_valid.html#cb135-23" tabindex="-1"></a>      <span class="co"># &amp; field_dbh_cm &gt;= min_tree_dbh_cm # if know min field dbh for field sampling</span></span>
<span id="cb135-24"><a href="field_valid.html#cb135-24" tabindex="-1"></a>    )</span>
<span id="cb135-25"><a href="field_valid.html#cb135-25" tabindex="-1"></a>  <span class="co"># keep only trees within sampling plot</span></span>
<span id="cb135-26"><a href="field_valid.html#cb135-26" tabindex="-1"></a>  d <span class="sc">%&gt;%</span> </span>
<span id="cb135-27"><a href="field_valid.html#cb135-27" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_intersection</span>(</span>
<span id="cb135-28"><a href="field_valid.html#cb135-28" tabindex="-1"></a>      validation_plots <span class="sc">%&gt;%</span> </span>
<span id="cb135-29"><a href="field_valid.html#cb135-29" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(study_site <span class="sc">==</span> my_study_site) <span class="sc">%&gt;%</span> </span>
<span id="cb135-30"><a href="field_valid.html#cb135-30" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">intersected_with_plot_geom =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb135-31"><a href="field_valid.html#cb135-31" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(intersected_with_plot_geom) <span class="sc">%&gt;%</span> </span>
<span id="cb135-32"><a href="field_valid.html#cb135-32" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_transform</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(d))</span>
<span id="cb135-33"><a href="field_valid.html#cb135-33" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb135-34"><a href="field_valid.html#cb135-34" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb135-35"><a href="field_valid.html#cb135-35" tabindex="-1"></a>      <span class="at">field_tree_id =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()</span>
<span id="cb135-36"><a href="field_valid.html#cb135-36" tabindex="-1"></a>      , <span class="at">tree_utm_x =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(geometry)[,<span class="dv">1</span>] <span class="co">#lon</span></span>
<span id="cb135-37"><a href="field_valid.html#cb135-37" tabindex="-1"></a>      , <span class="at">tree_utm_y =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(geometry)[,<span class="dv">2</span>] <span class="co">#lat</span></span>
<span id="cb135-38"><a href="field_valid.html#cb135-38" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb135-39"><a href="field_valid.html#cb135-39" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">relocate</span>(field_tree_id)</span>
<span id="cb135-40"><a href="field_valid.html#cb135-40" tabindex="-1"></a>    </span>
<span id="cb135-41"><a href="field_valid.html#cb135-41" tabindex="-1"></a>}</span></code></pre></div>
<p>uas data</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="field_valid.html#cb136-1" tabindex="-1"></a><span class="co"># function finds uas tree list</span></span>
<span id="cb136-2"><a href="field_valid.html#cb136-2" tabindex="-1"></a><span class="co"># reads it</span></span>
<span id="cb136-3"><a href="field_valid.html#cb136-3" tabindex="-1"></a><span class="co"># estimates linear model if not already used for DBH</span></span>
<span id="cb136-4"><a href="field_valid.html#cb136-4" tabindex="-1"></a>read_uas_data <span class="ot">=</span> <span class="cf">function</span>(my_processing_id, <span class="at">my_crs =</span> <span class="cn">NULL</span>) {</span>
<span id="cb136-5"><a href="field_valid.html#cb136-5" tabindex="-1"></a>  <span class="co"># where is this file?</span></span>
<span id="cb136-6"><a href="field_valid.html#cb136-6" tabindex="-1"></a>  fnm <span class="ot">=</span> ptcld_processing_data <span class="sc">%&gt;%</span> </span>
<span id="cb136-7"><a href="field_valid.html#cb136-7" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb136-8"><a href="field_valid.html#cb136-8" tabindex="-1"></a>      processing_id <span class="sc">==</span> my_processing_id</span>
<span id="cb136-9"><a href="field_valid.html#cb136-9" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb136-10"><a href="field_valid.html#cb136-10" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb136-11"><a href="field_valid.html#cb136-11" tabindex="-1"></a>      <span class="at">fnm =</span> <span class="fu">paste0</span>(</span>
<span id="cb136-12"><a href="field_valid.html#cb136-12" tabindex="-1"></a>        processed_data_dir</span>
<span id="cb136-13"><a href="field_valid.html#cb136-13" tabindex="-1"></a>        , <span class="st">&quot;/&quot;</span></span>
<span id="cb136-14"><a href="field_valid.html#cb136-14" tabindex="-1"></a>        , file_name</span>
<span id="cb136-15"><a href="field_valid.html#cb136-15" tabindex="-1"></a>        , <span class="st">&quot;_final_detected_tree_tops.gpkg&quot;</span></span>
<span id="cb136-16"><a href="field_valid.html#cb136-16" tabindex="-1"></a>      )</span>
<span id="cb136-17"><a href="field_valid.html#cb136-17" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb136-18"><a href="field_valid.html#cb136-18" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(fnm)</span>
<span id="cb136-19"><a href="field_valid.html#cb136-19" tabindex="-1"></a>  </span>
<span id="cb136-20"><a href="field_valid.html#cb136-20" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">file.exists</span>(fnm)){</span>
<span id="cb136-21"><a href="field_valid.html#cb136-21" tabindex="-1"></a>    <span class="co"># read it</span></span>
<span id="cb136-22"><a href="field_valid.html#cb136-22" tabindex="-1"></a>    dta <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_read</span>(fnm) <span class="sc">%&gt;%</span> </span>
<span id="cb136-23"><a href="field_valid.html#cb136-23" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb136-24"><a href="field_valid.html#cb136-24" tabindex="-1"></a>        <span class="at">processing_id =</span> my_processing_id</span>
<span id="cb136-25"><a href="field_valid.html#cb136-25" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb136-26"><a href="field_valid.html#cb136-26" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">rename_with</span>(tolower) <span class="sc">%&gt;%</span> </span>
<span id="cb136-27"><a href="field_valid.html#cb136-27" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="st">&quot;geometry&quot;</span>)</span>
<span id="cb136-28"><a href="field_valid.html#cb136-28" tabindex="-1"></a>    </span>
<span id="cb136-29"><a href="field_valid.html#cb136-29" tabindex="-1"></a>    <span class="co"># transform</span></span>
<span id="cb136-30"><a href="field_valid.html#cb136-30" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(my_crs)){</span>
<span id="cb136-31"><a href="field_valid.html#cb136-31" tabindex="-1"></a>      tcrs <span class="ot">=</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(dta)</span>
<span id="cb136-32"><a href="field_valid.html#cb136-32" tabindex="-1"></a>    }<span class="cf">else</span>{tcrs <span class="ot">=</span> my_crs}</span>
<span id="cb136-33"><a href="field_valid.html#cb136-33" tabindex="-1"></a>    </span>
<span id="cb136-34"><a href="field_valid.html#cb136-34" tabindex="-1"></a>    dta <span class="ot">=</span> dta <span class="sc">%&gt;%</span> </span>
<span id="cb136-35"><a href="field_valid.html#cb136-35" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_transform</span>(tcrs)</span>
<span id="cb136-36"><a href="field_valid.html#cb136-36" tabindex="-1"></a>    </span>
<span id="cb136-37"><a href="field_valid.html#cb136-37" tabindex="-1"></a>    <span class="do">#################</span></span>
<span id="cb136-38"><a href="field_valid.html#cb136-38" tabindex="-1"></a>    <span class="co"># estimate linear model if not already used for DBH</span></span>
<span id="cb136-39"><a href="field_valid.html#cb136-39" tabindex="-1"></a>    <span class="do">#################</span></span>
<span id="cb136-40"><a href="field_valid.html#cb136-40" tabindex="-1"></a>    <span class="cf">if</span>(</span>
<span id="cb136-41"><a href="field_valid.html#cb136-41" tabindex="-1"></a>      <span class="co"># is there sufficient training data?</span></span>
<span id="cb136-42"><a href="field_valid.html#cb136-42" tabindex="-1"></a>      dta <span class="sc">%&gt;%</span> </span>
<span id="cb136-43"><a href="field_valid.html#cb136-43" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(is_training_data <span class="sc">==</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb136-44"><a href="field_valid.html#cb136-44" tabindex="-1"></a>        <span class="fu">nrow</span>() <span class="sc">&gt;</span> <span class="dv">10</span> <span class="sc">&amp;</span> </span>
<span id="cb136-45"><a href="field_valid.html#cb136-45" tabindex="-1"></a>      <span class="co"># was rf model used?</span></span>
<span id="cb136-46"><a href="field_valid.html#cb136-46" tabindex="-1"></a>      ptcld_processing_data <span class="sc">%&gt;%</span> </span>
<span id="cb136-47"><a href="field_valid.html#cb136-47" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(processing_id <span class="sc">==</span> my_processing_id) <span class="sc">%&gt;%</span> </span>
<span id="cb136-48"><a href="field_valid.html#cb136-48" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">pull</span>(sttng_local_dbh_model) <span class="sc">%&gt;%</span> </span>
<span id="cb136-49"><a href="field_valid.html#cb136-49" tabindex="-1"></a>        <span class="fu">tolower</span>() <span class="sc">==</span> <span class="st">&quot;rf&quot;</span></span>
<span id="cb136-50"><a href="field_valid.html#cb136-50" tabindex="-1"></a>    ){</span>
<span id="cb136-51"><a href="field_valid.html#cb136-51" tabindex="-1"></a>        <span class="co"># Gamma distribution for strictly positive response variable dbh</span></span>
<span id="cb136-52"><a href="field_valid.html#cb136-52" tabindex="-1"></a>        stem_prediction_model <span class="ot">=</span> brms<span class="sc">::</span><span class="fu">brm</span>(</span>
<span id="cb136-53"><a href="field_valid.html#cb136-53" tabindex="-1"></a>          <span class="at">formula =</span> dbh_cm <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> tree_height_m</span>
<span id="cb136-54"><a href="field_valid.html#cb136-54" tabindex="-1"></a>          , <span class="at">data =</span> dta <span class="sc">%&gt;%</span></span>
<span id="cb136-55"><a href="field_valid.html#cb136-55" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">filter</span>(is_training_data<span class="sc">==</span>T) <span class="sc">%&gt;%</span> </span>
<span id="cb136-56"><a href="field_valid.html#cb136-56" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">select</span>(dbh_cm, tree_height_m)</span>
<span id="cb136-57"><a href="field_valid.html#cb136-57" tabindex="-1"></a>          , <span class="at">family =</span> brms<span class="sc">::</span><span class="fu">brmsfamily</span>(<span class="st">&quot;Gamma&quot;</span>, <span class="at">link =</span> <span class="st">&quot;log&quot;</span>)</span>
<span id="cb136-58"><a href="field_valid.html#cb136-58" tabindex="-1"></a>          , <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">gamma</span>(<span class="fl">0.01</span>, <span class="fl">0.01</span>), <span class="at">class =</span> shape))</span>
<span id="cb136-59"><a href="field_valid.html#cb136-59" tabindex="-1"></a>          , <span class="at">iter =</span> <span class="dv">4000</span>, <span class="at">warmup =</span> <span class="dv">2000</span>, <span class="at">chains =</span> <span class="dv">4</span></span>
<span id="cb136-60"><a href="field_valid.html#cb136-60" tabindex="-1"></a>          , <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()</span>
<span id="cb136-61"><a href="field_valid.html#cb136-61" tabindex="-1"></a>          , <span class="at">file =</span> ptcld_processing_data <span class="sc">%&gt;%</span></span>
<span id="cb136-62"><a href="field_valid.html#cb136-62" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">filter</span>(processing_id <span class="sc">==</span> my_processing_id) <span class="sc">%&gt;%</span></span>
<span id="cb136-63"><a href="field_valid.html#cb136-63" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb136-64"><a href="field_valid.html#cb136-64" tabindex="-1"></a>                <span class="at">fff =</span> <span class="fu">paste0</span>(</span>
<span id="cb136-65"><a href="field_valid.html#cb136-65" tabindex="-1"></a>                  processed_data_dir</span>
<span id="cb136-66"><a href="field_valid.html#cb136-66" tabindex="-1"></a>                  , <span class="st">&quot;/&quot;</span></span>
<span id="cb136-67"><a href="field_valid.html#cb136-67" tabindex="-1"></a>                  , file_name</span>
<span id="cb136-68"><a href="field_valid.html#cb136-68" tabindex="-1"></a>                  , <span class="st">&quot;_local_dbh_height_model&quot;</span></span>
<span id="cb136-69"><a href="field_valid.html#cb136-69" tabindex="-1"></a>                )</span>
<span id="cb136-70"><a href="field_valid.html#cb136-70" tabindex="-1"></a>              ) <span class="sc">%&gt;%</span></span>
<span id="cb136-71"><a href="field_valid.html#cb136-71" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">pull</span>(fff)</span>
<span id="cb136-72"><a href="field_valid.html#cb136-72" tabindex="-1"></a>          <span class="co"># , file_refit = &quot;on_change&quot;</span></span>
<span id="cb136-73"><a href="field_valid.html#cb136-73" tabindex="-1"></a>        )</span>
<span id="cb136-74"><a href="field_valid.html#cb136-74" tabindex="-1"></a>      <span class="do">#################</span></span>
<span id="cb136-75"><a href="field_valid.html#cb136-75" tabindex="-1"></a>      <span class="co"># prediction data</span></span>
<span id="cb136-76"><a href="field_valid.html#cb136-76" tabindex="-1"></a>      <span class="do">#################</span></span>
<span id="cb136-77"><a href="field_valid.html#cb136-77" tabindex="-1"></a>        pred_temp <span class="ot">=</span> <span class="fu">predict</span>(stem_prediction_model, dta) <span class="sc">%&gt;%</span> </span>
<span id="cb136-78"><a href="field_valid.html#cb136-78" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb136-79"><a href="field_valid.html#cb136-79" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">pull</span>(<span class="dv">1</span>)</span>
<span id="cb136-80"><a href="field_valid.html#cb136-80" tabindex="-1"></a>        </span>
<span id="cb136-81"><a href="field_valid.html#cb136-81" tabindex="-1"></a>        <span class="co"># add to data</span></span>
<span id="cb136-82"><a href="field_valid.html#cb136-82" tabindex="-1"></a>        dta <span class="ot">=</span> dta <span class="sc">%&gt;%</span> </span>
<span id="cb136-83"><a href="field_valid.html#cb136-83" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb136-84"><a href="field_valid.html#cb136-84" tabindex="-1"></a>            <span class="at">rf_dbh_cm =</span> dbh_cm</span>
<span id="cb136-85"><a href="field_valid.html#cb136-85" tabindex="-1"></a>            , <span class="at">pred_dbh_cm =</span> pred_temp</span>
<span id="cb136-86"><a href="field_valid.html#cb136-86" tabindex="-1"></a>            , <span class="at">lin_dbh_cm =</span> <span class="fu">ifelse</span>(is_training_data<span class="sc">==</span>T, dbh_cm, pred_dbh_cm)</span>
<span id="cb136-87"><a href="field_valid.html#cb136-87" tabindex="-1"></a>          ) <span class="sc">%&gt;%</span> </span>
<span id="cb136-88"><a href="field_valid.html#cb136-88" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(pred_dbh_cm)) <span class="sc">%&gt;%</span> </span>
<span id="cb136-89"><a href="field_valid.html#cb136-89" tabindex="-1"></a>          <span class="co"># pick a dbh to use</span></span>
<span id="cb136-90"><a href="field_valid.html#cb136-90" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb136-91"><a href="field_valid.html#cb136-91" tabindex="-1"></a>            <span class="at">dbh_cm =</span> lin_dbh_cm</span>
<span id="cb136-92"><a href="field_valid.html#cb136-92" tabindex="-1"></a>            , <span class="at">dbh_m =</span> dbh_cm<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb136-93"><a href="field_valid.html#cb136-93" tabindex="-1"></a>            , <span class="at">radius_m =</span> dbh_m<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb136-94"><a href="field_valid.html#cb136-94" tabindex="-1"></a>            , <span class="at">basal_area_m2 =</span> pi <span class="sc">*</span> (radius_m)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb136-95"><a href="field_valid.html#cb136-95" tabindex="-1"></a>            , <span class="at">basal_area_ft2 =</span> basal_area_m2 <span class="sc">*</span> <span class="fl">10.764</span></span>
<span id="cb136-96"><a href="field_valid.html#cb136-96" tabindex="-1"></a>          )</span>
<span id="cb136-97"><a href="field_valid.html#cb136-97" tabindex="-1"></a>    }<span class="cf">else</span> <span class="cf">if</span>(<span class="co"># is there sufficient training data?</span></span>
<span id="cb136-98"><a href="field_valid.html#cb136-98" tabindex="-1"></a>      dta <span class="sc">%&gt;%</span> </span>
<span id="cb136-99"><a href="field_valid.html#cb136-99" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(is_training_data <span class="sc">==</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb136-100"><a href="field_valid.html#cb136-100" tabindex="-1"></a>        <span class="fu">nrow</span>() <span class="sc">&lt;=</span> <span class="dv">10</span></span>
<span id="cb136-101"><a href="field_valid.html#cb136-101" tabindex="-1"></a>    ){</span>
<span id="cb136-102"><a href="field_valid.html#cb136-102" tabindex="-1"></a>      <span class="co"># the regional model was used which would result in the same est for rf and lin</span></span>
<span id="cb136-103"><a href="field_valid.html#cb136-103" tabindex="-1"></a>      dta <span class="ot">=</span> dta <span class="sc">%&gt;%</span> </span>
<span id="cb136-104"><a href="field_valid.html#cb136-104" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb136-105"><a href="field_valid.html#cb136-105" tabindex="-1"></a>          <span class="at">rf_dbh_cm =</span> dbh_cm</span>
<span id="cb136-106"><a href="field_valid.html#cb136-106" tabindex="-1"></a>          , <span class="at">lin_dbh_cm =</span> dbh_cm</span>
<span id="cb136-107"><a href="field_valid.html#cb136-107" tabindex="-1"></a>        )</span>
<span id="cb136-108"><a href="field_valid.html#cb136-108" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb136-109"><a href="field_valid.html#cb136-109" tabindex="-1"></a>      <span class="co"># linear model was already used and no rf pred</span></span>
<span id="cb136-110"><a href="field_valid.html#cb136-110" tabindex="-1"></a>      <span class="co"># could update this to estimate rf model if missing...#nextyear</span></span>
<span id="cb136-111"><a href="field_valid.html#cb136-111" tabindex="-1"></a>      dta <span class="ot">=</span> dta <span class="sc">%&gt;%</span> </span>
<span id="cb136-112"><a href="field_valid.html#cb136-112" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb136-113"><a href="field_valid.html#cb136-113" tabindex="-1"></a>          <span class="at">rf_dbh_cm =</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>)</span>
<span id="cb136-114"><a href="field_valid.html#cb136-114" tabindex="-1"></a>          , <span class="at">lin_dbh_cm =</span> dbh_cm</span>
<span id="cb136-115"><a href="field_valid.html#cb136-115" tabindex="-1"></a>        )</span>
<span id="cb136-116"><a href="field_valid.html#cb136-116" tabindex="-1"></a>    }</span>
<span id="cb136-117"><a href="field_valid.html#cb136-117" tabindex="-1"></a>    <span class="fu">return</span>(dta)</span>
<span id="cb136-118"><a href="field_valid.html#cb136-118" tabindex="-1"></a>  }<span class="cf">else</span>{<span class="fu">stop</span>(<span class="st">&quot;could not find file: &quot;</span>, fnm)}</span>
<span id="cb136-119"><a href="field_valid.html#cb136-119" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="validation-data-functions" class="section level2 hasAnchor" number="5.3">
<h2><span class="header-section-number">5.3</span> Validation Data Functions<a href="field_valid.html#validation-data-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="true-positive-identification" class="section level3 hasAnchor" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> True Positive Identification<a href="field_valid.html#true-positive-identification" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The UAS detected and stem-mapped tree pairs identified in this filtering process (detailed above) were considered true positive (<span class="math inline">\(TP\)</span>) detections.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="field_valid.html#cb137-1" tabindex="-1"></a><span class="do">## BUFFER THE UAS TREES AND SPATIALLY MATCH FIELD TREES BASED ON THAT BUFFER</span></span>
<span id="cb137-2"><a href="field_valid.html#cb137-2" tabindex="-1"></a>true_positive_trees_fn <span class="ot">=</span> <span class="cf">function</span>(uas_data, field_data, <span class="at">max_dist_m =</span> <span class="dv">3</span>, <span class="at">max_height_error_m =</span> <span class="dv">2</span>){</span>
<span id="cb137-3"><a href="field_valid.html#cb137-3" tabindex="-1"></a>  <span class="do">## get FIELD trees within radius OF UAS TREES</span></span>
<span id="cb137-4"><a href="field_valid.html#cb137-4" tabindex="-1"></a>    potential_tree_pairs_temp <span class="ot">=</span> uas_data <span class="sc">%&gt;%</span> </span>
<span id="cb137-5"><a href="field_valid.html#cb137-5" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(treeid, tree_height_m) <span class="sc">%&gt;%</span> </span>
<span id="cb137-6"><a href="field_valid.html#cb137-6" tabindex="-1"></a>      <span class="co"># buffer point</span></span>
<span id="cb137-7"><a href="field_valid.html#cb137-7" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_buffer</span>(max_dist_m) <span class="sc">%&gt;%</span> </span>
<span id="cb137-8"><a href="field_valid.html#cb137-8" tabindex="-1"></a>      <span class="co"># spatial join with all FIELD tree points</span></span>
<span id="cb137-9"><a href="field_valid.html#cb137-9" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_join</span>(</span>
<span id="cb137-10"><a href="field_valid.html#cb137-10" tabindex="-1"></a>        field_data <span class="sc">%&gt;%</span> </span>
<span id="cb137-11"><a href="field_valid.html#cb137-11" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb137-12"><a href="field_valid.html#cb137-12" tabindex="-1"></a>            field_tree_id, field_tree_height_m</span>
<span id="cb137-13"><a href="field_valid.html#cb137-13" tabindex="-1"></a>            , tree_utm_x, tree_utm_y</span>
<span id="cb137-14"><a href="field_valid.html#cb137-14" tabindex="-1"></a>          )</span>
<span id="cb137-15"><a href="field_valid.html#cb137-15" tabindex="-1"></a>        , <span class="at">join =</span> sf<span class="sc">::</span>st_intersects</span>
<span id="cb137-16"><a href="field_valid.html#cb137-16" tabindex="-1"></a>        , <span class="at">left =</span> F <span class="co"># performs inner join to only keep uas trees with a match</span></span>
<span id="cb137-17"><a href="field_valid.html#cb137-17" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb137-18"><a href="field_valid.html#cb137-18" tabindex="-1"></a>      <span class="co"># calculate height difference</span></span>
<span id="cb137-19"><a href="field_valid.html#cb137-19" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb137-20"><a href="field_valid.html#cb137-20" tabindex="-1"></a>        <span class="at">height_diff_m =</span> <span class="fu">abs</span>(tree_height_m<span class="sc">-</span>field_tree_height_m)</span>
<span id="cb137-21"><a href="field_valid.html#cb137-21" tabindex="-1"></a>        , <span class="at">height_diff_pct =</span> height_diff_m<span class="sc">/</span>field_tree_height_m</span>
<span id="cb137-22"><a href="field_valid.html#cb137-22" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb137-23"><a href="field_valid.html#cb137-23" tabindex="-1"></a>      <span class="co"># removes tree pairs that are outside of the allowable error</span></span>
<span id="cb137-24"><a href="field_valid.html#cb137-24" tabindex="-1"></a>      <span class="co"># dplyr::filter(height_diff_pct &lt;= max_height_error_pct) %&gt;% </span></span>
<span id="cb137-25"><a href="field_valid.html#cb137-25" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(height_diff_m <span class="sc">&lt;=</span> max_height_error_m) <span class="sc">%&gt;%</span> </span>
<span id="cb137-26"><a href="field_valid.html#cb137-26" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(height_diff_m)) <span class="sc">%&gt;%</span> </span>
<span id="cb137-27"><a href="field_valid.html#cb137-27" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">relocate</span>(treeid, field_tree_id)</span>
<span id="cb137-28"><a href="field_valid.html#cb137-28" tabindex="-1"></a>  </span>
<span id="cb137-29"><a href="field_valid.html#cb137-29" tabindex="-1"></a>  <span class="do">## apply pair selection criteria if there are potential tree pairs</span></span>
<span id="cb137-30"><a href="field_valid.html#cb137-30" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">nrow</span>(potential_tree_pairs_temp)<span class="sc">&gt;</span><span class="dv">0</span>){</span>
<span id="cb137-31"><a href="field_valid.html#cb137-31" tabindex="-1"></a>      <span class="do">## calculate row by row distances and height differences</span></span>
<span id="cb137-32"><a href="field_valid.html#cb137-32" tabindex="-1"></a>        potential_tree_pairs_temp <span class="ot">=</span> potential_tree_pairs_temp <span class="sc">%&gt;%</span> </span>
<span id="cb137-33"><a href="field_valid.html#cb137-33" tabindex="-1"></a>          <span class="co"># this is the position of the uas tree</span></span>
<span id="cb137-34"><a href="field_valid.html#cb137-34" tabindex="-1"></a>          sf<span class="sc">::</span><span class="fu">st_centroid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb137-35"><a href="field_valid.html#cb137-35" tabindex="-1"></a>          sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="st">&quot;geom1&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb137-36"><a href="field_valid.html#cb137-36" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(</span>
<span id="cb137-37"><a href="field_valid.html#cb137-37" tabindex="-1"></a>            potential_tree_pairs_temp <span class="sc">%&gt;%</span> </span>
<span id="cb137-38"><a href="field_valid.html#cb137-38" tabindex="-1"></a>              sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb137-39"><a href="field_valid.html#cb137-39" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">&quot;tree_utm_x&quot;</span>, <span class="st">&quot;tree_utm_y&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb137-40"><a href="field_valid.html#cb137-40" tabindex="-1"></a>              <span class="co"># this is the position of the field tree</span></span>
<span id="cb137-41"><a href="field_valid.html#cb137-41" tabindex="-1"></a>              sf<span class="sc">::</span><span class="fu">st_as_sf</span>(</span>
<span id="cb137-42"><a href="field_valid.html#cb137-42" tabindex="-1"></a>                <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;tree_utm_x&quot;</span>, <span class="st">&quot;tree_utm_y&quot;</span>), <span class="at">crs =</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(uas_data)</span>
<span id="cb137-43"><a href="field_valid.html#cb137-43" tabindex="-1"></a>              ) <span class="sc">%&gt;%</span> </span>
<span id="cb137-44"><a href="field_valid.html#cb137-44" tabindex="-1"></a>              sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="st">&quot;geom2&quot;</span>)</span>
<span id="cb137-45"><a href="field_valid.html#cb137-45" tabindex="-1"></a>          ) <span class="sc">%&gt;%</span> </span>
<span id="cb137-46"><a href="field_valid.html#cb137-46" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb137-47"><a href="field_valid.html#cb137-47" tabindex="-1"></a>            <span class="at">distance_m =</span> sf<span class="sc">::</span><span class="fu">st_distance</span>(geom1, geom2, <span class="at">by_element =</span> T) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()</span>
<span id="cb137-48"><a href="field_valid.html#cb137-48" tabindex="-1"></a>          ) <span class="sc">%&gt;%</span> </span>
<span id="cb137-49"><a href="field_valid.html#cb137-49" tabindex="-1"></a>          sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb137-50"><a href="field_valid.html#cb137-50" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(tree_utm_x, tree_utm_y, geom2))</span>
<span id="cb137-51"><a href="field_valid.html#cb137-51" tabindex="-1"></a>      </span>
<span id="cb137-52"><a href="field_valid.html#cb137-52" tabindex="-1"></a>      <span class="do">## define function to select the best tree pair</span></span>
<span id="cb137-53"><a href="field_valid.html#cb137-53" tabindex="-1"></a>        select_best_tree_pair_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb137-54"><a href="field_valid.html#cb137-54" tabindex="-1"></a>         df <span class="sc">%&gt;%</span> </span>
<span id="cb137-55"><a href="field_valid.html#cb137-55" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">group_by</span>(field_tree_id) <span class="sc">%&gt;%</span> </span>
<span id="cb137-56"><a href="field_valid.html#cb137-56" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">arrange</span>(field_tree_id, height_diff_pct, distance_m, <span class="fu">desc</span>(tree_height_m), treeid) <span class="sc">%&gt;%</span> </span>
<span id="cb137-57"><a href="field_valid.html#cb137-57" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb137-58"><a href="field_valid.html#cb137-58" tabindex="-1"></a>            <span class="co"># at the field tree level...the number of uas trees</span></span>
<span id="cb137-59"><a href="field_valid.html#cb137-59" tabindex="-1"></a>            <span class="at">n_uas_trees =</span> dplyr<span class="sc">::</span><span class="fu">n</span>()</span>
<span id="cb137-60"><a href="field_valid.html#cb137-60" tabindex="-1"></a>            <span class="co"># at the field tree level...</span></span>
<span id="cb137-61"><a href="field_valid.html#cb137-61" tabindex="-1"></a>              <span class="co"># the closest uas tree in height tie breaker distance, uas_tree_height_m, id</span></span>
<span id="cb137-62"><a href="field_valid.html#cb137-62" tabindex="-1"></a>            , <span class="at">rank_within_field_tree =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()</span>
<span id="cb137-63"><a href="field_valid.html#cb137-63" tabindex="-1"></a>          ) <span class="sc">%&gt;%</span> </span>
<span id="cb137-64"><a href="field_valid.html#cb137-64" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">group_by</span>(treeid) <span class="sc">%&gt;%</span> </span>
<span id="cb137-65"><a href="field_valid.html#cb137-65" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">arrange</span>(treeid, height_diff_pct, distance_m, <span class="fu">desc</span>(field_tree_height_m), field_tree_id) <span class="sc">%&gt;%</span> </span>
<span id="cb137-66"><a href="field_valid.html#cb137-66" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb137-67"><a href="field_valid.html#cb137-67" tabindex="-1"></a>            <span class="co"># at the uas tree level...the number of field trees</span></span>
<span id="cb137-68"><a href="field_valid.html#cb137-68" tabindex="-1"></a>            <span class="at">n_field_trees =</span> dplyr<span class="sc">::</span><span class="fu">n</span>()</span>
<span id="cb137-69"><a href="field_valid.html#cb137-69" tabindex="-1"></a>            <span class="co"># at the field tree level...</span></span>
<span id="cb137-70"><a href="field_valid.html#cb137-70" tabindex="-1"></a>              <span class="co"># the closest field tree in height tie breaker distance, uas_tree_height_m, id</span></span>
<span id="cb137-71"><a href="field_valid.html#cb137-71" tabindex="-1"></a>            , <span class="at">rank_within_uas_tree =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()</span>
<span id="cb137-72"><a href="field_valid.html#cb137-72" tabindex="-1"></a>          ) <span class="sc">%&gt;%</span> </span>
<span id="cb137-73"><a href="field_valid.html#cb137-73" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb137-74"><a href="field_valid.html#cb137-74" tabindex="-1"></a>          <span class="co"># select the uas-field tree pair with the minimum height difference</span></span>
<span id="cb137-75"><a href="field_valid.html#cb137-75" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb137-76"><a href="field_valid.html#cb137-76" tabindex="-1"></a>            rank_within_field_tree <span class="sc">==</span> <span class="dv">1</span></span>
<span id="cb137-77"><a href="field_valid.html#cb137-77" tabindex="-1"></a>            <span class="sc">&amp;</span> rank_within_uas_tree <span class="sc">==</span> <span class="dv">1</span></span>
<span id="cb137-78"><a href="field_valid.html#cb137-78" tabindex="-1"></a>          ) <span class="sc">%&gt;%</span> </span>
<span id="cb137-79"><a href="field_valid.html#cb137-79" tabindex="-1"></a>          <span class="co"># remove columns</span></span>
<span id="cb137-80"><a href="field_valid.html#cb137-80" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb137-81"><a href="field_valid.html#cb137-81" tabindex="-1"></a>            <span class="sc">-</span><span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;rank_&quot;</span>), tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;n_&quot;</span>))</span>
<span id="cb137-82"><a href="field_valid.html#cb137-82" tabindex="-1"></a>          )</span>
<span id="cb137-83"><a href="field_valid.html#cb137-83" tabindex="-1"></a>        }</span>
<span id="cb137-84"><a href="field_valid.html#cb137-84" tabindex="-1"></a>      </span>
<span id="cb137-85"><a href="field_valid.html#cb137-85" tabindex="-1"></a>      <span class="do">## first filter for tree pairs</span></span>
<span id="cb137-86"><a href="field_valid.html#cb137-86" tabindex="-1"></a>        true_positive_trees <span class="ot">=</span> <span class="fu">select_best_tree_pair_fn</span>(potential_tree_pairs_temp)</span>
<span id="cb137-87"><a href="field_valid.html#cb137-87" tabindex="-1"></a>      </span>
<span id="cb137-88"><a href="field_valid.html#cb137-88" tabindex="-1"></a>      <span class="do">##remove matches from potential tree pairs </span></span>
<span id="cb137-89"><a href="field_valid.html#cb137-89" tabindex="-1"></a>        potential_tree_pairs_temp <span class="ot">=</span> potential_tree_pairs_temp <span class="sc">%&gt;%</span> </span>
<span id="cb137-90"><a href="field_valid.html#cb137-90" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb137-91"><a href="field_valid.html#cb137-91" tabindex="-1"></a>            <span class="sc">!</span>(treeid <span class="sc">%in%</span> true_positive_trees<span class="sc">$</span>treeid)</span>
<span id="cb137-92"><a href="field_valid.html#cb137-92" tabindex="-1"></a>            <span class="sc">&amp;</span> <span class="sc">!</span>(field_tree_id <span class="sc">%in%</span> true_positive_trees<span class="sc">$</span>field_tree_id)</span>
<span id="cb137-93"><a href="field_valid.html#cb137-93" tabindex="-1"></a>          )</span>
<span id="cb137-94"><a href="field_valid.html#cb137-94" tabindex="-1"></a>        </span>
<span id="cb137-95"><a href="field_valid.html#cb137-95" tabindex="-1"></a>      <span class="do">## keep filtering for best pair until no unique pairs remain</span></span>
<span id="cb137-96"><a href="field_valid.html#cb137-96" tabindex="-1"></a>        <span class="cf">while</span>(<span class="fu">nrow</span>(potential_tree_pairs_temp)<span class="sc">&gt;</span><span class="dv">0</span>) {</span>
<span id="cb137-97"><a href="field_valid.html#cb137-97" tabindex="-1"></a>          <span class="co"># keep filtering for best pair until no unique pairs remain</span></span>
<span id="cb137-98"><a href="field_valid.html#cb137-98" tabindex="-1"></a>          true_positive_trees <span class="ot">=</span> true_positive_trees <span class="sc">%&gt;%</span> </span>
<span id="cb137-99"><a href="field_valid.html#cb137-99" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb137-100"><a href="field_valid.html#cb137-100" tabindex="-1"></a>              <span class="fu">select_best_tree_pair_fn</span>(potential_tree_pairs_temp)</span>
<span id="cb137-101"><a href="field_valid.html#cb137-101" tabindex="-1"></a>            )</span>
<span id="cb137-102"><a href="field_valid.html#cb137-102" tabindex="-1"></a>          <span class="co">#remove matches from potential tree pairs </span></span>
<span id="cb137-103"><a href="field_valid.html#cb137-103" tabindex="-1"></a>          potential_tree_pairs_temp <span class="ot">=</span> potential_tree_pairs_temp <span class="sc">%&gt;%</span> </span>
<span id="cb137-104"><a href="field_valid.html#cb137-104" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb137-105"><a href="field_valid.html#cb137-105" tabindex="-1"></a>              <span class="sc">!</span>(treeid <span class="sc">%in%</span> true_positive_trees<span class="sc">$</span>treeid)</span>
<span id="cb137-106"><a href="field_valid.html#cb137-106" tabindex="-1"></a>              <span class="sc">&amp;</span> <span class="sc">!</span>(field_tree_id <span class="sc">%in%</span> true_positive_trees<span class="sc">$</span>field_tree_id)</span>
<span id="cb137-107"><a href="field_valid.html#cb137-107" tabindex="-1"></a>            )</span>
<span id="cb137-108"><a href="field_valid.html#cb137-108" tabindex="-1"></a>        }</span>
<span id="cb137-109"><a href="field_valid.html#cb137-109" tabindex="-1"></a>      <span class="do">## rename columns and flag</span></span>
<span id="cb137-110"><a href="field_valid.html#cb137-110" tabindex="-1"></a>        true_positive_trees <span class="ot">=</span> true_positive_trees <span class="sc">%&gt;%</span> </span>
<span id="cb137-111"><a href="field_valid.html#cb137-111" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb137-112"><a href="field_valid.html#cb137-112" tabindex="-1"></a>            <span class="at">uas_tree_height_m =</span> tree_height_m</span>
<span id="cb137-113"><a href="field_valid.html#cb137-113" tabindex="-1"></a>            , <span class="at">uas_tree_id =</span> treeid</span>
<span id="cb137-114"><a href="field_valid.html#cb137-114" tabindex="-1"></a>            , <span class="at">field_uas_distance_m =</span> distance_m</span>
<span id="cb137-115"><a href="field_valid.html#cb137-115" tabindex="-1"></a>          ) <span class="sc">%&gt;%</span> </span>
<span id="cb137-116"><a href="field_valid.html#cb137-116" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb137-117"><a href="field_valid.html#cb137-117" tabindex="-1"></a>            <span class="at">field_uas_group =</span> <span class="st">&quot;true positive&quot;</span></span>
<span id="cb137-118"><a href="field_valid.html#cb137-118" tabindex="-1"></a>          ) </span>
<span id="cb137-119"><a href="field_valid.html#cb137-119" tabindex="-1"></a>    }<span class="cf">else</span>{ <span class="co"># if there are spatially matched trees</span></span>
<span id="cb137-120"><a href="field_valid.html#cb137-120" tabindex="-1"></a>      true_positive_trees <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb137-121"><a href="field_valid.html#cb137-121" tabindex="-1"></a>        <span class="at">uas_tree_id =</span> <span class="fu">as.character</span>(<span class="cn">NA</span>)</span>
<span id="cb137-122"><a href="field_valid.html#cb137-122" tabindex="-1"></a>        , <span class="at">field_tree_id =</span> <span class="fu">as.character</span>(<span class="cn">NA</span>)</span>
<span id="cb137-123"><a href="field_valid.html#cb137-123" tabindex="-1"></a>        , <span class="at">uas_tree_height_m =</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>)</span>
<span id="cb137-124"><a href="field_valid.html#cb137-124" tabindex="-1"></a>        , <span class="at">field_tree_height_m =</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>)</span>
<span id="cb137-125"><a href="field_valid.html#cb137-125" tabindex="-1"></a>        , <span class="at">height_diff_pct =</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>)</span>
<span id="cb137-126"><a href="field_valid.html#cb137-126" tabindex="-1"></a>        , <span class="at">field_uas_distance_m =</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>)</span>
<span id="cb137-127"><a href="field_valid.html#cb137-127" tabindex="-1"></a>        , <span class="at">field_uas_group =</span> <span class="fu">as.character</span>(<span class="cn">NA</span>)</span>
<span id="cb137-128"><a href="field_valid.html#cb137-128" tabindex="-1"></a>      )</span>
<span id="cb137-129"><a href="field_valid.html#cb137-129" tabindex="-1"></a>    }</span>
<span id="cb137-130"><a href="field_valid.html#cb137-130" tabindex="-1"></a>  <span class="co"># return</span></span>
<span id="cb137-131"><a href="field_valid.html#cb137-131" tabindex="-1"></a>    <span class="fu">return</span>(true_positive_trees)</span>
<span id="cb137-132"><a href="field_valid.html#cb137-132" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="combine-with-commission-and-omission" class="section level3 hasAnchor" number="5.3.2">
<h3><span class="header-section-number">5.3.2</span> Combine with Commission and Omission<a href="field_valid.html#combine-with-commission-and-omission" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To determine UAS detected tree commissions (i.e. UAS detected trees within the overstory plot for which there was no stem-mapped tree pair; <span class="math inline">\(Co\)</span>) this analysis used the 2023-06 BHEF overstory field survey plot center and plot radius of 11.35 m. UAS detected trees within this radius with an <a href="#local_mod">estimated DBH</a> over 5 in (12.69 cm) that did not have a matched stem-mapped tree pair were considered commissions (<span class="math inline">\(Co\)</span>).</p>
<p>Omissions (<span class="math inline">\(Om\)</span>) are stem-mapped trees without a UAS detected tree match.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="field_valid.html#cb138-1" tabindex="-1"></a>field_uas_comparison_fn <span class="ot">=</span> <span class="cf">function</span>(uas_data, field_data, true_positive_trees, plot_data, <span class="at">overstory_ht_m =</span> <span class="dv">7</span>){</span>
<span id="cb138-2"><a href="field_valid.html#cb138-2" tabindex="-1"></a>  field_uas_comparison <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb138-3"><a href="field_valid.html#cb138-3" tabindex="-1"></a>    <span class="do">## true positive</span></span>
<span id="cb138-4"><a href="field_valid.html#cb138-4" tabindex="-1"></a>      true_positive_trees <span class="sc">%&gt;%</span> </span>
<span id="cb138-5"><a href="field_valid.html#cb138-5" tabindex="-1"></a>         dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">field_tree_id =</span> <span class="fu">as.numeric</span>(field_tree_id))</span>
<span id="cb138-6"><a href="field_valid.html#cb138-6" tabindex="-1"></a>    <span class="do">## omission</span></span>
<span id="cb138-7"><a href="field_valid.html#cb138-7" tabindex="-1"></a>      , field_data <span class="sc">%&gt;%</span> </span>
<span id="cb138-8"><a href="field_valid.html#cb138-8" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb138-9"><a href="field_valid.html#cb138-9" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb138-10"><a href="field_valid.html#cb138-10" tabindex="-1"></a>          field_tree_id, field_tree_height_m</span>
<span id="cb138-11"><a href="field_valid.html#cb138-11" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb138-12"><a href="field_valid.html#cb138-12" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">anti_join</span>(</span>
<span id="cb138-13"><a href="field_valid.html#cb138-13" tabindex="-1"></a>          true_positive_trees <span class="sc">%&gt;%</span> </span>
<span id="cb138-14"><a href="field_valid.html#cb138-14" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">field_tree_id =</span> <span class="fu">as.numeric</span>(field_tree_id))</span>
<span id="cb138-15"><a href="field_valid.html#cb138-15" tabindex="-1"></a>          , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(field_tree_id)</span>
<span id="cb138-16"><a href="field_valid.html#cb138-16" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb138-17"><a href="field_valid.html#cb138-17" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb138-18"><a href="field_valid.html#cb138-18" tabindex="-1"></a>          <span class="at">field_uas_group =</span> <span class="st">&quot;omission&quot;</span></span>
<span id="cb138-19"><a href="field_valid.html#cb138-19" tabindex="-1"></a>        )</span>
<span id="cb138-20"><a href="field_valid.html#cb138-20" tabindex="-1"></a>    <span class="do">## commission</span></span>
<span id="cb138-21"><a href="field_valid.html#cb138-21" tabindex="-1"></a>      , plot_data <span class="sc">%&gt;%</span> </span>
<span id="cb138-22"><a href="field_valid.html#cb138-22" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_transform</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(uas_data)) <span class="sc">%&gt;%</span> </span>
<span id="cb138-23"><a href="field_valid.html#cb138-23" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(study_site) <span class="sc">%&gt;%</span> </span>
<span id="cb138-24"><a href="field_valid.html#cb138-24" tabindex="-1"></a>        <span class="co"># join with uas tree points</span></span>
<span id="cb138-25"><a href="field_valid.html#cb138-25" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_join</span>(</span>
<span id="cb138-26"><a href="field_valid.html#cb138-26" tabindex="-1"></a>          uas_data <span class="sc">%&gt;%</span> </span>
<span id="cb138-27"><a href="field_valid.html#cb138-27" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb138-28"><a href="field_valid.html#cb138-28" tabindex="-1"></a>              <span class="sc">!</span>treeid <span class="sc">%in%</span> true_positive_trees<span class="sc">$</span>uas_tree_id</span>
<span id="cb138-29"><a href="field_valid.html#cb138-29" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span> </span>
<span id="cb138-30"><a href="field_valid.html#cb138-30" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">select</span>(treeid) <span class="sc">%&gt;%</span> </span>
<span id="cb138-31"><a href="field_valid.html#cb138-31" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">uas_tree_id=</span>treeid)</span>
<span id="cb138-32"><a href="field_valid.html#cb138-32" tabindex="-1"></a>          , <span class="at">join =</span> sf<span class="sc">::</span>st_intersects</span>
<span id="cb138-33"><a href="field_valid.html#cb138-33" tabindex="-1"></a>          , <span class="at">left =</span> F <span class="co"># performs inner join to only keep uas trees and plots with a match</span></span>
<span id="cb138-34"><a href="field_valid.html#cb138-34" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb138-35"><a href="field_valid.html#cb138-35" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(study_site)) <span class="sc">%&gt;%</span> </span>
<span id="cb138-36"><a href="field_valid.html#cb138-36" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb138-37"><a href="field_valid.html#cb138-37" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb138-38"><a href="field_valid.html#cb138-38" tabindex="-1"></a>          <span class="at">field_uas_group =</span> <span class="st">&quot;commission&quot;</span></span>
<span id="cb138-39"><a href="field_valid.html#cb138-39" tabindex="-1"></a>        )</span>
<span id="cb138-40"><a href="field_valid.html#cb138-40" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb138-41"><a href="field_valid.html#cb138-41" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(field_uas_group) <span class="sc">&amp;</span> field_uas_group<span class="sc">!=</span><span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb138-42"><a href="field_valid.html#cb138-42" tabindex="-1"></a>    <span class="co"># attach uas data</span></span>
<span id="cb138-43"><a href="field_valid.html#cb138-43" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb138-44"><a href="field_valid.html#cb138-44" tabindex="-1"></a>      uas_data <span class="sc">%&gt;%</span></span>
<span id="cb138-45"><a href="field_valid.html#cb138-45" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="st">&quot;geometry&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb138-46"><a href="field_valid.html#cb138-46" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb138-47"><a href="field_valid.html#cb138-47" tabindex="-1"></a>          <span class="at">uas_tree_utm_x =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(geometry)[,<span class="dv">1</span>] <span class="co">#lon</span></span>
<span id="cb138-48"><a href="field_valid.html#cb138-48" tabindex="-1"></a>          , <span class="at">uas_tree_utm_y =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(geometry)[,<span class="dv">2</span>] <span class="co">#lat</span></span>
<span id="cb138-49"><a href="field_valid.html#cb138-49" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb138-50"><a href="field_valid.html#cb138-50" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb138-51"><a href="field_valid.html#cb138-51" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(treeid, tree_height_m, dbh_cm, uas_tree_utm_x, uas_tree_utm_y) <span class="sc">%&gt;%</span> </span>
<span id="cb138-52"><a href="field_valid.html#cb138-52" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb138-53"><a href="field_valid.html#cb138-53" tabindex="-1"></a>          <span class="at">uas_tree_id =</span> treeid</span>
<span id="cb138-54"><a href="field_valid.html#cb138-54" tabindex="-1"></a>          , <span class="at">uas_tree_height_m =</span> tree_height_m</span>
<span id="cb138-55"><a href="field_valid.html#cb138-55" tabindex="-1"></a>          , <span class="at">uas_dbh_cm =</span> dbh_cm</span>
<span id="cb138-56"><a href="field_valid.html#cb138-56" tabindex="-1"></a>        )</span>
<span id="cb138-57"><a href="field_valid.html#cb138-57" tabindex="-1"></a>      , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(uas_tree_id)</span>
<span id="cb138-58"><a href="field_valid.html#cb138-58" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb138-59"><a href="field_valid.html#cb138-59" tabindex="-1"></a>    <span class="co"># attach field data</span></span>
<span id="cb138-60"><a href="field_valid.html#cb138-60" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb138-61"><a href="field_valid.html#cb138-61" tabindex="-1"></a>      field_data <span class="sc">%&gt;%</span> </span>
<span id="cb138-62"><a href="field_valid.html#cb138-62" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb138-63"><a href="field_valid.html#cb138-63" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb138-64"><a href="field_valid.html#cb138-64" tabindex="-1"></a>          field_tree_id, field_tree_height_m, field_dbh_cm</span>
<span id="cb138-65"><a href="field_valid.html#cb138-65" tabindex="-1"></a>          , tree_utm_x, tree_utm_y</span>
<span id="cb138-66"><a href="field_valid.html#cb138-66" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb138-67"><a href="field_valid.html#cb138-67" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb138-68"><a href="field_valid.html#cb138-68" tabindex="-1"></a>          <span class="at">field_tree_utm_x =</span> tree_utm_x</span>
<span id="cb138-69"><a href="field_valid.html#cb138-69" tabindex="-1"></a>          , <span class="at">field_tree_utm_y =</span> tree_utm_y</span>
<span id="cb138-70"><a href="field_valid.html#cb138-70" tabindex="-1"></a>        )</span>
<span id="cb138-71"><a href="field_valid.html#cb138-71" tabindex="-1"></a>      , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(field_tree_id)</span>
<span id="cb138-72"><a href="field_valid.html#cb138-72" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb138-73"><a href="field_valid.html#cb138-73" tabindex="-1"></a>    <span class="co"># update data</span></span>
<span id="cb138-74"><a href="field_valid.html#cb138-74" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb138-75"><a href="field_valid.html#cb138-75" tabindex="-1"></a>      <span class="at">uas_tree_height_m =</span> uas_tree_height_m.y</span>
<span id="cb138-76"><a href="field_valid.html#cb138-76" tabindex="-1"></a>      , <span class="at">field_tree_height_m =</span> field_tree_height_m.y</span>
<span id="cb138-77"><a href="field_valid.html#cb138-77" tabindex="-1"></a>      , <span class="at">field_uas_group =</span> <span class="fu">factor</span>(</span>
<span id="cb138-78"><a href="field_valid.html#cb138-78" tabindex="-1"></a>        field_uas_group</span>
<span id="cb138-79"><a href="field_valid.html#cb138-79" tabindex="-1"></a>        , <span class="at">ordered =</span> T</span>
<span id="cb138-80"><a href="field_valid.html#cb138-80" tabindex="-1"></a>        , <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb138-81"><a href="field_valid.html#cb138-81" tabindex="-1"></a>          <span class="st">&quot;true positive&quot;</span></span>
<span id="cb138-82"><a href="field_valid.html#cb138-82" tabindex="-1"></a>          , <span class="st">&quot;commission&quot;</span></span>
<span id="cb138-83"><a href="field_valid.html#cb138-83" tabindex="-1"></a>          , <span class="st">&quot;omission&quot;</span></span>
<span id="cb138-84"><a href="field_valid.html#cb138-84" tabindex="-1"></a>        )</span>
<span id="cb138-85"><a href="field_valid.html#cb138-85" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> forcats<span class="sc">::</span><span class="fu">fct_rev</span>()</span>
<span id="cb138-86"><a href="field_valid.html#cb138-86" tabindex="-1"></a>      , <span class="at">dbh_diff_cm =</span> uas_dbh_cm <span class="sc">-</span> field_dbh_cm</span>
<span id="cb138-87"><a href="field_valid.html#cb138-87" tabindex="-1"></a>      , <span class="at">tree_height_diff_m =</span> uas_tree_height_m <span class="sc">-</span> field_tree_height_m</span>
<span id="cb138-88"><a href="field_valid.html#cb138-88" tabindex="-1"></a>      , <span class="at">dbh_diff_pct =</span> dbh_diff_cm<span class="sc">/</span>field_dbh_cm</span>
<span id="cb138-89"><a href="field_valid.html#cb138-89" tabindex="-1"></a>      , <span class="at">height_diff_pct =</span> tree_height_diff_m<span class="sc">/</span>field_tree_height_m</span>
<span id="cb138-90"><a href="field_valid.html#cb138-90" tabindex="-1"></a>      , <span class="at">abs_dbh_diff_pct =</span> <span class="fu">abs</span>(dbh_diff_pct)</span>
<span id="cb138-91"><a href="field_valid.html#cb138-91" tabindex="-1"></a>      , <span class="at">abs_height_diff_pct =</span> <span class="fu">abs</span>(height_diff_pct)</span>
<span id="cb138-92"><a href="field_valid.html#cb138-92" tabindex="-1"></a>      <span class="co"># determine overstory/understory</span></span>
<span id="cb138-93"><a href="field_valid.html#cb138-93" tabindex="-1"></a>      , <span class="at">overstory_understory_grp =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb138-94"><a href="field_valid.html#cb138-94" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">coalesce</span>(field_tree_height_m, uas_tree_height_m) <span class="sc">&gt;=</span> overstory_ht_m <span class="sc">~</span> <span class="st">&quot;overstory&quot;</span></span>
<span id="cb138-95"><a href="field_valid.html#cb138-95" tabindex="-1"></a>        , dplyr<span class="sc">::</span><span class="fu">coalesce</span>(field_tree_height_m, uas_tree_height_m) <span class="sc">&lt;</span> overstory_ht_m <span class="sc">~</span> <span class="st">&quot;understory&quot;</span></span>
<span id="cb138-96"><a href="field_valid.html#cb138-96" tabindex="-1"></a>        , T <span class="sc">~</span> <span class="st">&quot;error&quot;</span></span>
<span id="cb138-97"><a href="field_valid.html#cb138-97" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> <span class="fu">factor</span>()</span>
<span id="cb138-98"><a href="field_valid.html#cb138-98" tabindex="-1"></a>      <span class="co"># attach identifying data</span></span>
<span id="cb138-99"><a href="field_valid.html#cb138-99" tabindex="-1"></a>      , <span class="at">study_site =</span> uas_data<span class="sc">$</span>study_site[<span class="dv">1</span>]</span>
<span id="cb138-100"><a href="field_valid.html#cb138-100" tabindex="-1"></a>      , <span class="at">file_name =</span> uas_data<span class="sc">$</span>file_name[<span class="dv">1</span>]</span>
<span id="cb138-101"><a href="field_valid.html#cb138-101" tabindex="-1"></a>      , <span class="at">software =</span> uas_data<span class="sc">$</span>software[<span class="dv">1</span>]</span>
<span id="cb138-102"><a href="field_valid.html#cb138-102" tabindex="-1"></a>      , <span class="at">overstory_ht_m =</span> overstory_ht_m</span>
<span id="cb138-103"><a href="field_valid.html#cb138-103" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb138-104"><a href="field_valid.html#cb138-104" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">relocate</span>(field_uas_group) <span class="sc">%&gt;%</span> </span>
<span id="cb138-105"><a href="field_valid.html#cb138-105" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;.x&quot;</span>), tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;.y&quot;</span>)))</span>
<span id="cb138-106"><a href="field_valid.html#cb138-106" tabindex="-1"></a>    <span class="co"># # convert to imperial units</span></span>
<span id="cb138-107"><a href="field_valid.html#cb138-107" tabindex="-1"></a>    <span class="co"># calc_imperial_units_fn()</span></span>
<span id="cb138-108"><a href="field_valid.html#cb138-108" tabindex="-1"></a>  <span class="co"># return</span></span>
<span id="cb138-109"><a href="field_valid.html#cb138-109" tabindex="-1"></a>  <span class="fu">return</span>(field_uas_comparison)</span>
<span id="cb138-110"><a href="field_valid.html#cb138-110" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="full-validation-function" class="section level3 hasAnchor" number="5.3.3">
<h3><span class="header-section-number">5.3.3</span> Full validation function<a href="field_valid.html#full-validation-function" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>function to write comparison data and return aggregate metrics when passed a <code>ptcld_processing_data$processing_id</code></p>
<p>function returns:</p>
<ol style="list-style-type: decimal">
<li>write full validation tree list to disk</li>
<li>update ptcld_processing_data with metrics for testing:</li>
</ol>
<ul>
<li>f-score</li>
<li>height comparison metrics (mae, mape, smape, mse, rmse)</li>
<li>dbh comparison metrics (mae, mape, smape, mse, rmse)</li>
<li>path to full validation tree list written to disk</li>
</ul>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="field_valid.html#cb139-1" tabindex="-1"></a><span class="do">#####################################################</span></span>
<span id="cb139-2"><a href="field_valid.html#cb139-2" tabindex="-1"></a><span class="co"># function to map over each file for a particular study site</span></span>
<span id="cb139-3"><a href="field_valid.html#cb139-3" tabindex="-1"></a><span class="do">#####################################################</span></span>
<span id="cb139-4"><a href="field_valid.html#cb139-4" tabindex="-1"></a>  <span class="co"># function for a file name identified by processing_id in ptcld_processing_data</span></span>
<span id="cb139-5"><a href="field_valid.html#cb139-5" tabindex="-1"></a>  validate_file_fn <span class="ot">=</span> <span class="cf">function</span>(p_id, fld_dta, plt_dta){</span>
<span id="cb139-6"><a href="field_valid.html#cb139-6" tabindex="-1"></a>    <span class="co"># tree list file name</span></span>
<span id="cb139-7"><a href="field_valid.html#cb139-7" tabindex="-1"></a>      tl_fnm <span class="ot">=</span> <span class="fu">paste0</span>(</span>
<span id="cb139-8"><a href="field_valid.html#cb139-8" tabindex="-1"></a>          ptcld_processing_data <span class="sc">%&gt;%</span> </span>
<span id="cb139-9"><a href="field_valid.html#cb139-9" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">filter</span>(processing_id <span class="sc">==</span> p_id) <span class="sc">%&gt;%</span> </span>
<span id="cb139-10"><a href="field_valid.html#cb139-10" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">pull</span>(processed_data_dir)</span>
<span id="cb139-11"><a href="field_valid.html#cb139-11" tabindex="-1"></a>          , <span class="st">&quot;/&quot;</span></span>
<span id="cb139-12"><a href="field_valid.html#cb139-12" tabindex="-1"></a>          , ptcld_processing_data <span class="sc">%&gt;%</span> </span>
<span id="cb139-13"><a href="field_valid.html#cb139-13" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">filter</span>(processing_id <span class="sc">==</span> p_id) <span class="sc">%&gt;%</span> </span>
<span id="cb139-14"><a href="field_valid.html#cb139-14" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">pull</span>(file_name)</span>
<span id="cb139-15"><a href="field_valid.html#cb139-15" tabindex="-1"></a>          , <span class="st">&quot;_field_uas_comparison_data.csv&quot;</span></span>
<span id="cb139-16"><a href="field_valid.html#cb139-16" tabindex="-1"></a>        )</span>
<span id="cb139-17"><a href="field_valid.html#cb139-17" tabindex="-1"></a>    <span class="co"># brms model</span></span>
<span id="cb139-18"><a href="field_valid.html#cb139-18" tabindex="-1"></a>      brms_fnm <span class="ot">=</span> <span class="fu">paste0</span>(</span>
<span id="cb139-19"><a href="field_valid.html#cb139-19" tabindex="-1"></a>          ptcld_processing_data <span class="sc">%&gt;%</span> </span>
<span id="cb139-20"><a href="field_valid.html#cb139-20" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">filter</span>(processing_id <span class="sc">==</span> p_id) <span class="sc">%&gt;%</span> </span>
<span id="cb139-21"><a href="field_valid.html#cb139-21" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">pull</span>(processed_data_dir)</span>
<span id="cb139-22"><a href="field_valid.html#cb139-22" tabindex="-1"></a>          , <span class="st">&quot;/&quot;</span></span>
<span id="cb139-23"><a href="field_valid.html#cb139-23" tabindex="-1"></a>          , ptcld_processing_data <span class="sc">%&gt;%</span> </span>
<span id="cb139-24"><a href="field_valid.html#cb139-24" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">filter</span>(processing_id <span class="sc">==</span> p_id) <span class="sc">%&gt;%</span> </span>
<span id="cb139-25"><a href="field_valid.html#cb139-25" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">pull</span>(file_name)</span>
<span id="cb139-26"><a href="field_valid.html#cb139-26" tabindex="-1"></a>          , <span class="st">&quot;_local_dbh_height_model.rds&quot;</span></span>
<span id="cb139-27"><a href="field_valid.html#cb139-27" tabindex="-1"></a>        )</span>
<span id="cb139-28"><a href="field_valid.html#cb139-28" tabindex="-1"></a>    <span class="co"># check it</span></span>
<span id="cb139-29"><a href="field_valid.html#cb139-29" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">file.exists</span>(tl_fnm) <span class="sc">&amp;</span> <span class="fu">file.exists</span>(brms_fnm)){</span>
<span id="cb139-30"><a href="field_valid.html#cb139-30" tabindex="-1"></a>      <span class="co"># read it</span></span>
<span id="cb139-31"><a href="field_valid.html#cb139-31" tabindex="-1"></a>      field_uas_comparison <span class="ot">=</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(tl_fnm)</span>
<span id="cb139-32"><a href="field_valid.html#cb139-32" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb139-33"><a href="field_valid.html#cb139-33" tabindex="-1"></a>      <span class="co"># uas_data</span></span>
<span id="cb139-34"><a href="field_valid.html#cb139-34" tabindex="-1"></a>        u_dta <span class="ot">=</span> <span class="fu">read_uas_data</span>(</span>
<span id="cb139-35"><a href="field_valid.html#cb139-35" tabindex="-1"></a>          <span class="at">my_processing_id =</span> p_id</span>
<span id="cb139-36"><a href="field_valid.html#cb139-36" tabindex="-1"></a>          , <span class="at">my_crs =</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(fld_dta)</span>
<span id="cb139-37"><a href="field_valid.html#cb139-37" tabindex="-1"></a>        )</span>
<span id="cb139-38"><a href="field_valid.html#cb139-38" tabindex="-1"></a>      <span class="co"># true positives</span></span>
<span id="cb139-39"><a href="field_valid.html#cb139-39" tabindex="-1"></a>        tp_trees <span class="ot">=</span> <span class="fu">true_positive_trees_fn</span>(<span class="at">uas_data =</span> u_dta, <span class="at">field_data =</span> fld_dta)</span>
<span id="cb139-40"><a href="field_valid.html#cb139-40" tabindex="-1"></a>      <span class="co"># field uas comparison</span></span>
<span id="cb139-41"><a href="field_valid.html#cb139-41" tabindex="-1"></a>        field_uas_comparison <span class="ot">=</span> <span class="fu">field_uas_comparison_fn</span>(</span>
<span id="cb139-42"><a href="field_valid.html#cb139-42" tabindex="-1"></a>            <span class="at">uas_data =</span> u_dta</span>
<span id="cb139-43"><a href="field_valid.html#cb139-43" tabindex="-1"></a>            , <span class="at">field_data =</span> fld_dta</span>
<span id="cb139-44"><a href="field_valid.html#cb139-44" tabindex="-1"></a>            , <span class="at">true_positive_trees =</span> tp_trees</span>
<span id="cb139-45"><a href="field_valid.html#cb139-45" tabindex="-1"></a>            , <span class="at">plot_data =</span> plt_dta</span>
<span id="cb139-46"><a href="field_valid.html#cb139-46" tabindex="-1"></a>          ) <span class="sc">%&gt;%</span> </span>
<span id="cb139-47"><a href="field_valid.html#cb139-47" tabindex="-1"></a>          <span class="co"># attach id information</span></span>
<span id="cb139-48"><a href="field_valid.html#cb139-48" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(</span>
<span id="cb139-49"><a href="field_valid.html#cb139-49" tabindex="-1"></a>            ptcld_processing_data <span class="sc">%&gt;%</span> </span>
<span id="cb139-50"><a href="field_valid.html#cb139-50" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">filter</span>(processing_id <span class="sc">==</span> p_id) <span class="sc">%&gt;%</span> </span>
<span id="cb139-51"><a href="field_valid.html#cb139-51" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb139-52"><a href="field_valid.html#cb139-52" tabindex="-1"></a>                processing_id, study_site, file_name, software</span>
<span id="cb139-53"><a href="field_valid.html#cb139-53" tabindex="-1"></a>                , depth_maps_generation_quality</span>
<span id="cb139-54"><a href="field_valid.html#cb139-54" tabindex="-1"></a>                , depth_maps_generation_filtering_mode</span>
<span id="cb139-55"><a href="field_valid.html#cb139-55" tabindex="-1"></a>                , processing_attribute3</span>
<span id="cb139-56"><a href="field_valid.html#cb139-56" tabindex="-1"></a>                , processed_data_dir</span>
<span id="cb139-57"><a href="field_valid.html#cb139-57" tabindex="-1"></a>              )</span>
<span id="cb139-58"><a href="field_valid.html#cb139-58" tabindex="-1"></a>          )</span>
<span id="cb139-59"><a href="field_valid.html#cb139-59" tabindex="-1"></a>        <span class="co"># write it</span></span>
<span id="cb139-60"><a href="field_valid.html#cb139-60" tabindex="-1"></a>        <span class="fu">write.csv</span>(</span>
<span id="cb139-61"><a href="field_valid.html#cb139-61" tabindex="-1"></a>          field_uas_comparison</span>
<span id="cb139-62"><a href="field_valid.html#cb139-62" tabindex="-1"></a>          , tl_fnm</span>
<span id="cb139-63"><a href="field_valid.html#cb139-63" tabindex="-1"></a>          , <span class="at">row.names =</span> F</span>
<span id="cb139-64"><a href="field_valid.html#cb139-64" tabindex="-1"></a>        )</span>
<span id="cb139-65"><a href="field_valid.html#cb139-65" tabindex="-1"></a>    }</span>
<span id="cb139-66"><a href="field_valid.html#cb139-66" tabindex="-1"></a>    <span class="do">############################################</span></span>
<span id="cb139-67"><a href="field_valid.html#cb139-67" tabindex="-1"></a>    <span class="co"># aggregate field_uas_comparison for return</span></span>
<span id="cb139-68"><a href="field_valid.html#cb139-68" tabindex="-1"></a>    <span class="do">############################################</span></span>
<span id="cb139-69"><a href="field_valid.html#cb139-69" tabindex="-1"></a>      return_dta <span class="ot">=</span></span>
<span id="cb139-70"><a href="field_valid.html#cb139-70" tabindex="-1"></a>        ptcld_processing_data <span class="sc">%&gt;%</span> </span>
<span id="cb139-71"><a href="field_valid.html#cb139-71" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(processing_id <span class="sc">==</span> p_id) <span class="sc">%&gt;%</span></span>
<span id="cb139-72"><a href="field_valid.html#cb139-72" tabindex="-1"></a>        <span class="do">############################################</span></span>
<span id="cb139-73"><a href="field_valid.html#cb139-73" tabindex="-1"></a>        <span class="co"># overall statistics</span></span>
<span id="cb139-74"><a href="field_valid.html#cb139-74" tabindex="-1"></a>        <span class="do">############################################</span></span>
<span id="cb139-75"><a href="field_valid.html#cb139-75" tabindex="-1"></a>        <span class="co"># attach f score</span></span>
<span id="cb139-76"><a href="field_valid.html#cb139-76" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(</span>
<span id="cb139-77"><a href="field_valid.html#cb139-77" tabindex="-1"></a>          <span class="co"># blank data in case missing</span></span>
<span id="cb139-78"><a href="field_valid.html#cb139-78" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">field_uas_group =</span> <span class="fu">c</span>(<span class="st">&quot;tp&quot;</span>, <span class="st">&quot;co&quot;</span>, <span class="st">&quot;om&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb139-79"><a href="field_valid.html#cb139-79" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb139-80"><a href="field_valid.html#cb139-80" tabindex="-1"></a>            field_uas_comparison <span class="sc">%&gt;%</span> </span>
<span id="cb139-81"><a href="field_valid.html#cb139-81" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">count</span>(field_uas_group) <span class="sc">%&gt;%</span> </span>
<span id="cb139-82"><a href="field_valid.html#cb139-82" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">field_uas_group =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb139-83"><a href="field_valid.html#cb139-83" tabindex="-1"></a>                field_uas_group <span class="sc">==</span> <span class="st">&quot;true positive&quot;</span> <span class="sc">~</span> <span class="st">&quot;tp&quot;</span></span>
<span id="cb139-84"><a href="field_valid.html#cb139-84" tabindex="-1"></a>                , field_uas_group <span class="sc">==</span> <span class="st">&quot;commission&quot;</span> <span class="sc">~</span> <span class="st">&quot;co&quot;</span></span>
<span id="cb139-85"><a href="field_valid.html#cb139-85" tabindex="-1"></a>                , field_uas_group <span class="sc">==</span> <span class="st">&quot;omission&quot;</span> <span class="sc">~</span> <span class="st">&quot;om&quot;</span></span>
<span id="cb139-86"><a href="field_valid.html#cb139-86" tabindex="-1"></a>              ))</span>
<span id="cb139-87"><a href="field_valid.html#cb139-87" tabindex="-1"></a>            , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(field_uas_group)</span>
<span id="cb139-88"><a href="field_valid.html#cb139-88" tabindex="-1"></a>          ) <span class="sc">%&gt;%</span> </span>
<span id="cb139-89"><a href="field_valid.html#cb139-89" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">n =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(n),<span class="dv">0</span>,n)) <span class="sc">%&gt;%</span> </span>
<span id="cb139-90"><a href="field_valid.html#cb139-90" tabindex="-1"></a>            tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(</span>
<span id="cb139-91"><a href="field_valid.html#cb139-91" tabindex="-1"></a>              <span class="at">names_from =</span> field_uas_group</span>
<span id="cb139-92"><a href="field_valid.html#cb139-92" tabindex="-1"></a>              , <span class="at">values_from =</span> n</span>
<span id="cb139-93"><a href="field_valid.html#cb139-93" tabindex="-1"></a>              , <span class="at">values_fill =</span> <span class="dv">0</span></span>
<span id="cb139-94"><a href="field_valid.html#cb139-94" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span> </span>
<span id="cb139-95"><a href="field_valid.html#cb139-95" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb139-96"><a href="field_valid.html#cb139-96" tabindex="-1"></a>              <span class="at">f_score =</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(</span>
<span id="cb139-97"><a href="field_valid.html#cb139-97" tabindex="-1"></a>                <span class="dv">2</span> <span class="sc">*</span> ( (tp<span class="sc">/</span>(tp<span class="sc">+</span>om)) <span class="sc">*</span> (tp<span class="sc">/</span>(tp<span class="sc">+</span>co)) ) <span class="sc">/</span> ( (tp<span class="sc">/</span>(tp<span class="sc">+</span>om)) <span class="sc">+</span> (tp<span class="sc">/</span>(tp<span class="sc">+</span>co)) )</span>
<span id="cb139-98"><a href="field_valid.html#cb139-98" tabindex="-1"></a>                , <span class="dv">0</span></span>
<span id="cb139-99"><a href="field_valid.html#cb139-99" tabindex="-1"></a>              )</span>
<span id="cb139-100"><a href="field_valid.html#cb139-100" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span> </span>
<span id="cb139-101"><a href="field_valid.html#cb139-101" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb139-102"><a href="field_valid.html#cb139-102" tabindex="-1"></a>              <span class="at">true_positive_n_trees =</span> tp</span>
<span id="cb139-103"><a href="field_valid.html#cb139-103" tabindex="-1"></a>              , <span class="at">commission_n_trees =</span> co</span>
<span id="cb139-104"><a href="field_valid.html#cb139-104" tabindex="-1"></a>              , <span class="at">omission_n_trees =</span> om</span>
<span id="cb139-105"><a href="field_valid.html#cb139-105" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span> </span>
<span id="cb139-106"><a href="field_valid.html#cb139-106" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span>
<span id="cb139-107"><a href="field_valid.html#cb139-107" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb139-108"><a href="field_valid.html#cb139-108" tabindex="-1"></a>        <span class="co"># attach summary error metrics</span></span>
<span id="cb139-109"><a href="field_valid.html#cb139-109" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(</span>
<span id="cb139-110"><a href="field_valid.html#cb139-110" tabindex="-1"></a>          field_uas_comparison <span class="sc">%&gt;%</span> </span>
<span id="cb139-111"><a href="field_valid.html#cb139-111" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">filter</span>(field_uas_group<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb139-112"><a href="field_valid.html#cb139-112" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb139-113"><a href="field_valid.html#cb139-113" tabindex="-1"></a>            <span class="co"># thx Metrics pkg!!</span></span>
<span id="cb139-114"><a href="field_valid.html#cb139-114" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb139-115"><a href="field_valid.html#cb139-115" tabindex="-1"></a>              <span class="co"># tree_height_m</span></span>
<span id="cb139-116"><a href="field_valid.html#cb139-116" tabindex="-1"></a>              <span class="at">tree_height_m_mae =</span> Metrics<span class="sc">::</span><span class="fu">mae</span>(field_tree_height_m, uas_tree_height_m)</span>
<span id="cb139-117"><a href="field_valid.html#cb139-117" tabindex="-1"></a>              , <span class="at">tree_height_m_mape =</span> Metrics<span class="sc">::</span><span class="fu">mape</span>(field_tree_height_m, uas_tree_height_m)</span>
<span id="cb139-118"><a href="field_valid.html#cb139-118" tabindex="-1"></a>              , <span class="at">tree_height_m_smape =</span> Metrics<span class="sc">::</span><span class="fu">smape</span>(field_tree_height_m, uas_tree_height_m)</span>
<span id="cb139-119"><a href="field_valid.html#cb139-119" tabindex="-1"></a>              , <span class="at">tree_height_m_mse =</span> Metrics<span class="sc">::</span><span class="fu">mse</span>(field_tree_height_m, uas_tree_height_m)</span>
<span id="cb139-120"><a href="field_valid.html#cb139-120" tabindex="-1"></a>              , <span class="at">tree_height_m_rmse =</span> Metrics<span class="sc">::</span><span class="fu">rmse</span>(field_tree_height_m, uas_tree_height_m)</span>
<span id="cb139-121"><a href="field_valid.html#cb139-121" tabindex="-1"></a>              <span class="co"># dbh_cm</span></span>
<span id="cb139-122"><a href="field_valid.html#cb139-122" tabindex="-1"></a>              , <span class="at">dbh_cm_mae =</span> Metrics<span class="sc">::</span><span class="fu">mae</span>(field_dbh_cm, uas_dbh_cm)</span>
<span id="cb139-123"><a href="field_valid.html#cb139-123" tabindex="-1"></a>              , <span class="at">dbh_cm_mape =</span> Metrics<span class="sc">::</span><span class="fu">mape</span>(field_dbh_cm, uas_dbh_cm)</span>
<span id="cb139-124"><a href="field_valid.html#cb139-124" tabindex="-1"></a>              , <span class="at">dbh_cm_smape =</span> Metrics<span class="sc">::</span><span class="fu">smape</span>(field_dbh_cm, uas_dbh_cm)</span>
<span id="cb139-125"><a href="field_valid.html#cb139-125" tabindex="-1"></a>              , <span class="at">dbh_cm_mse =</span> Metrics<span class="sc">::</span><span class="fu">mse</span>(field_dbh_cm, uas_dbh_cm)</span>
<span id="cb139-126"><a href="field_valid.html#cb139-126" tabindex="-1"></a>              , <span class="at">dbh_cm_rmse =</span> Metrics<span class="sc">::</span><span class="fu">rmse</span>(field_dbh_cm, uas_dbh_cm)</span>
<span id="cb139-127"><a href="field_valid.html#cb139-127" tabindex="-1"></a>            )</span>
<span id="cb139-128"><a href="field_valid.html#cb139-128" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb139-129"><a href="field_valid.html#cb139-129" tabindex="-1"></a>        <span class="do">############################################</span></span>
<span id="cb139-130"><a href="field_valid.html#cb139-130" tabindex="-1"></a>        <span class="co"># overstory/understory statistics</span></span>
<span id="cb139-131"><a href="field_valid.html#cb139-131" tabindex="-1"></a>        <span class="do">############################################</span></span>
<span id="cb139-132"><a href="field_valid.html#cb139-132" tabindex="-1"></a>        <span class="co"># attach f score</span></span>
<span id="cb139-133"><a href="field_valid.html#cb139-133" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(</span>
<span id="cb139-134"><a href="field_valid.html#cb139-134" tabindex="-1"></a>          <span class="co"># blank data in case missing</span></span>
<span id="cb139-135"><a href="field_valid.html#cb139-135" tabindex="-1"></a>          tidyr<span class="sc">::</span><span class="fu">crossing</span>(</span>
<span id="cb139-136"><a href="field_valid.html#cb139-136" tabindex="-1"></a>            <span class="at">field_uas_group =</span> <span class="fu">c</span>(<span class="st">&quot;tp&quot;</span>, <span class="st">&quot;co&quot;</span>, <span class="st">&quot;om&quot;</span>)</span>
<span id="cb139-137"><a href="field_valid.html#cb139-137" tabindex="-1"></a>            , <span class="at">overstory_understory_grp =</span> <span class="fu">c</span>(<span class="st">&quot;overstory&quot;</span>, <span class="st">&quot;understory&quot;</span>)</span>
<span id="cb139-138"><a href="field_valid.html#cb139-138" tabindex="-1"></a>          ) <span class="sc">%&gt;%</span> </span>
<span id="cb139-139"><a href="field_valid.html#cb139-139" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb139-140"><a href="field_valid.html#cb139-140" tabindex="-1"></a>            field_uas_comparison <span class="sc">%&gt;%</span> </span>
<span id="cb139-141"><a href="field_valid.html#cb139-141" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">count</span>(field_uas_group, overstory_understory_grp) <span class="sc">%&gt;%</span> </span>
<span id="cb139-142"><a href="field_valid.html#cb139-142" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">field_uas_group =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb139-143"><a href="field_valid.html#cb139-143" tabindex="-1"></a>                field_uas_group <span class="sc">==</span> <span class="st">&quot;true positive&quot;</span> <span class="sc">~</span> <span class="st">&quot;tp&quot;</span></span>
<span id="cb139-144"><a href="field_valid.html#cb139-144" tabindex="-1"></a>                , field_uas_group <span class="sc">==</span> <span class="st">&quot;commission&quot;</span> <span class="sc">~</span> <span class="st">&quot;co&quot;</span></span>
<span id="cb139-145"><a href="field_valid.html#cb139-145" tabindex="-1"></a>                , field_uas_group <span class="sc">==</span> <span class="st">&quot;omission&quot;</span> <span class="sc">~</span> <span class="st">&quot;om&quot;</span></span>
<span id="cb139-146"><a href="field_valid.html#cb139-146" tabindex="-1"></a>              ))</span>
<span id="cb139-147"><a href="field_valid.html#cb139-147" tabindex="-1"></a>            , <span class="at">by =</span> dplyr<span class="sc">::</span><span class="fu">join_by</span>(field_uas_group, overstory_understory_grp)</span>
<span id="cb139-148"><a href="field_valid.html#cb139-148" tabindex="-1"></a>          ) <span class="sc">%&gt;%</span> </span>
<span id="cb139-149"><a href="field_valid.html#cb139-149" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">n =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(n),<span class="dv">0</span>,n)) <span class="sc">%&gt;%</span> </span>
<span id="cb139-150"><a href="field_valid.html#cb139-150" tabindex="-1"></a>            tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(</span>
<span id="cb139-151"><a href="field_valid.html#cb139-151" tabindex="-1"></a>              <span class="at">names_from =</span> field_uas_group</span>
<span id="cb139-152"><a href="field_valid.html#cb139-152" tabindex="-1"></a>              , <span class="at">values_from =</span> n</span>
<span id="cb139-153"><a href="field_valid.html#cb139-153" tabindex="-1"></a>              , <span class="at">values_fill =</span> <span class="dv">0</span></span>
<span id="cb139-154"><a href="field_valid.html#cb139-154" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span> </span>
<span id="cb139-155"><a href="field_valid.html#cb139-155" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb139-156"><a href="field_valid.html#cb139-156" tabindex="-1"></a>              <span class="at">f_score =</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(</span>
<span id="cb139-157"><a href="field_valid.html#cb139-157" tabindex="-1"></a>                <span class="dv">2</span> <span class="sc">*</span> ( (tp<span class="sc">/</span>(tp<span class="sc">+</span>om)) <span class="sc">*</span> (tp<span class="sc">/</span>(tp<span class="sc">+</span>co)) ) <span class="sc">/</span> ( (tp<span class="sc">/</span>(tp<span class="sc">+</span>om)) <span class="sc">+</span> (tp<span class="sc">/</span>(tp<span class="sc">+</span>co)) )</span>
<span id="cb139-158"><a href="field_valid.html#cb139-158" tabindex="-1"></a>                , <span class="dv">0</span></span>
<span id="cb139-159"><a href="field_valid.html#cb139-159" tabindex="-1"></a>              )</span>
<span id="cb139-160"><a href="field_valid.html#cb139-160" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span> </span>
<span id="cb139-161"><a href="field_valid.html#cb139-161" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb139-162"><a href="field_valid.html#cb139-162" tabindex="-1"></a>              <span class="at">true_positive_n_trees =</span> tp</span>
<span id="cb139-163"><a href="field_valid.html#cb139-163" tabindex="-1"></a>              , <span class="at">commission_n_trees =</span> co</span>
<span id="cb139-164"><a href="field_valid.html#cb139-164" tabindex="-1"></a>              , <span class="at">omission_n_trees =</span> om</span>
<span id="cb139-165"><a href="field_valid.html#cb139-165" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span> </span>
<span id="cb139-166"><a href="field_valid.html#cb139-166" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb139-167"><a href="field_valid.html#cb139-167" tabindex="-1"></a>            tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(</span>
<span id="cb139-168"><a href="field_valid.html#cb139-168" tabindex="-1"></a>              <span class="at">names_from =</span> overstory_understory_grp</span>
<span id="cb139-169"><a href="field_valid.html#cb139-169" tabindex="-1"></a>              , <span class="at">values_from =</span> <span class="sc">-</span><span class="fu">c</span>(overstory_understory_grp)</span>
<span id="cb139-170"><a href="field_valid.html#cb139-170" tabindex="-1"></a>              , <span class="at">values_fill =</span> <span class="dv">0</span></span>
<span id="cb139-171"><a href="field_valid.html#cb139-171" tabindex="-1"></a>              , <span class="at">names_glue =</span> <span class="st">&quot;{overstory_understory_grp}_{.value}&quot;</span></span>
<span id="cb139-172"><a href="field_valid.html#cb139-172" tabindex="-1"></a>            )</span>
<span id="cb139-173"><a href="field_valid.html#cb139-173" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb139-174"><a href="field_valid.html#cb139-174" tabindex="-1"></a>        <span class="co"># attach summary error metrics</span></span>
<span id="cb139-175"><a href="field_valid.html#cb139-175" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(</span>
<span id="cb139-176"><a href="field_valid.html#cb139-176" tabindex="-1"></a>          field_uas_comparison <span class="sc">%&gt;%</span> </span>
<span id="cb139-177"><a href="field_valid.html#cb139-177" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">filter</span>(field_uas_group<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb139-178"><a href="field_valid.html#cb139-178" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">group_by</span>(overstory_understory_grp) <span class="sc">%&gt;%</span> </span>
<span id="cb139-179"><a href="field_valid.html#cb139-179" tabindex="-1"></a>            <span class="co"># thx Metrics pkg!!</span></span>
<span id="cb139-180"><a href="field_valid.html#cb139-180" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb139-181"><a href="field_valid.html#cb139-181" tabindex="-1"></a>              <span class="co"># tree_height_m</span></span>
<span id="cb139-182"><a href="field_valid.html#cb139-182" tabindex="-1"></a>              <span class="at">tree_height_m_mae =</span> Metrics<span class="sc">::</span><span class="fu">mae</span>(field_tree_height_m, uas_tree_height_m)</span>
<span id="cb139-183"><a href="field_valid.html#cb139-183" tabindex="-1"></a>              , <span class="at">tree_height_m_mape =</span> Metrics<span class="sc">::</span><span class="fu">mape</span>(field_tree_height_m, uas_tree_height_m)</span>
<span id="cb139-184"><a href="field_valid.html#cb139-184" tabindex="-1"></a>              , <span class="at">tree_height_m_smape =</span> Metrics<span class="sc">::</span><span class="fu">smape</span>(field_tree_height_m, uas_tree_height_m)</span>
<span id="cb139-185"><a href="field_valid.html#cb139-185" tabindex="-1"></a>              , <span class="at">tree_height_m_mse =</span> Metrics<span class="sc">::</span><span class="fu">mse</span>(field_tree_height_m, uas_tree_height_m)</span>
<span id="cb139-186"><a href="field_valid.html#cb139-186" tabindex="-1"></a>              , <span class="at">tree_height_m_rmse =</span> Metrics<span class="sc">::</span><span class="fu">rmse</span>(field_tree_height_m, uas_tree_height_m)</span>
<span id="cb139-187"><a href="field_valid.html#cb139-187" tabindex="-1"></a>              <span class="co"># dbh_cm</span></span>
<span id="cb139-188"><a href="field_valid.html#cb139-188" tabindex="-1"></a>              , <span class="at">dbh_cm_mae =</span> Metrics<span class="sc">::</span><span class="fu">mae</span>(field_dbh_cm, uas_dbh_cm)</span>
<span id="cb139-189"><a href="field_valid.html#cb139-189" tabindex="-1"></a>              , <span class="at">dbh_cm_mape =</span> Metrics<span class="sc">::</span><span class="fu">mape</span>(field_dbh_cm, uas_dbh_cm)</span>
<span id="cb139-190"><a href="field_valid.html#cb139-190" tabindex="-1"></a>              , <span class="at">dbh_cm_smape =</span> Metrics<span class="sc">::</span><span class="fu">smape</span>(field_dbh_cm, uas_dbh_cm)</span>
<span id="cb139-191"><a href="field_valid.html#cb139-191" tabindex="-1"></a>              , <span class="at">dbh_cm_mse =</span> Metrics<span class="sc">::</span><span class="fu">mse</span>(field_dbh_cm, uas_dbh_cm)</span>
<span id="cb139-192"><a href="field_valid.html#cb139-192" tabindex="-1"></a>              , <span class="at">dbh_cm_rmse =</span> Metrics<span class="sc">::</span><span class="fu">rmse</span>(field_dbh_cm, uas_dbh_cm)</span>
<span id="cb139-193"><a href="field_valid.html#cb139-193" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span> </span>
<span id="cb139-194"><a href="field_valid.html#cb139-194" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb139-195"><a href="field_valid.html#cb139-195" tabindex="-1"></a>            tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(</span>
<span id="cb139-196"><a href="field_valid.html#cb139-196" tabindex="-1"></a>              <span class="at">names_from =</span> overstory_understory_grp</span>
<span id="cb139-197"><a href="field_valid.html#cb139-197" tabindex="-1"></a>              , <span class="at">values_from =</span> <span class="sc">-</span><span class="fu">c</span>(overstory_understory_grp)</span>
<span id="cb139-198"><a href="field_valid.html#cb139-198" tabindex="-1"></a>              , <span class="at">values_fill =</span> <span class="dv">0</span></span>
<span id="cb139-199"><a href="field_valid.html#cb139-199" tabindex="-1"></a>              , <span class="at">names_glue =</span> <span class="st">&quot;{overstory_understory_grp}_{.value}&quot;</span></span>
<span id="cb139-200"><a href="field_valid.html#cb139-200" tabindex="-1"></a>            )</span>
<span id="cb139-201"><a href="field_valid.html#cb139-201" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb139-202"><a href="field_valid.html#cb139-202" tabindex="-1"></a>        <span class="co"># where is the tree list ?</span></span>
<span id="cb139-203"><a href="field_valid.html#cb139-203" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb139-204"><a href="field_valid.html#cb139-204" tabindex="-1"></a>          <span class="at">validation_file_full_path =</span> tl_fnm</span>
<span id="cb139-205"><a href="field_valid.html#cb139-205" tabindex="-1"></a>          <span class="co"># what is this overstory/understory?</span></span>
<span id="cb139-206"><a href="field_valid.html#cb139-206" tabindex="-1"></a>          , <span class="at">overstory_ht_m =</span> field_uas_comparison<span class="sc">$</span>overstory_ht_m[<span class="dv">1</span>]</span>
<span id="cb139-207"><a href="field_valid.html#cb139-207" tabindex="-1"></a>        )</span>
<span id="cb139-208"><a href="field_valid.html#cb139-208" tabindex="-1"></a>      </span>
<span id="cb139-209"><a href="field_valid.html#cb139-209" tabindex="-1"></a>    <span class="co"># return</span></span>
<span id="cb139-210"><a href="field_valid.html#cb139-210" tabindex="-1"></a>      <span class="fu">return</span>(return_dta)</span>
<span id="cb139-211"><a href="field_valid.html#cb139-211" tabindex="-1"></a>  }</span></code></pre></div>
<p>check validation function</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="field_valid.html#cb140-1" tabindex="-1"></a>validation_temp <span class="ot">=</span> </span>
<span id="cb140-2"><a href="field_valid.html#cb140-2" tabindex="-1"></a>  <span class="fu">validate_file_fn</span>(</span>
<span id="cb140-3"><a href="field_valid.html#cb140-3" tabindex="-1"></a>    <span class="at">p_id =</span> ptcld_processing_data <span class="sc">%&gt;%</span> </span>
<span id="cb140-4"><a href="field_valid.html#cb140-4" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(study_site <span class="sc">==</span> study_site_list[<span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb140-5"><a href="field_valid.html#cb140-5" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">pull</span>(processing_id) <span class="sc">%&gt;%</span> </span>
<span id="cb140-6"><a href="field_valid.html#cb140-6" tabindex="-1"></a>      .[<span class="dv">1</span>]</span>
<span id="cb140-7"><a href="field_valid.html#cb140-7" tabindex="-1"></a>    , <span class="at">fld_dta =</span> <span class="fu">read_field_data</span>(study_site_list[<span class="dv">1</span>])</span>
<span id="cb140-8"><a href="field_valid.html#cb140-8" tabindex="-1"></a>    , <span class="at">plt_dta =</span> validation_plots <span class="sc">%&gt;%</span> </span>
<span id="cb140-9"><a href="field_valid.html#cb140-9" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(study_site <span class="sc">==</span> study_site_list[<span class="dv">1</span>])</span>
<span id="cb140-10"><a href="field_valid.html#cb140-10" tabindex="-1"></a>  )</span></code></pre></div>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="field_valid.html#cb141-1" tabindex="-1"></a><span class="co"># what? </span></span>
<span id="cb141-2"><a href="field_valid.html#cb141-2" tabindex="-1"></a>validation_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 1
## Columns: 77
## $ tracking_file_full_path              &lt;chr&gt; &quot;D:\\SfM_Software_Comparison\\Met…
## $ software                             &lt;chr&gt; &quot;METASHAPE&quot;
## $ study_site                           &lt;chr&gt; &quot;KAIBAB_HIGH&quot;
## $ processing_attribute1                &lt;chr&gt; &quot;HIGH&quot;
## $ processing_attribute2                &lt;chr&gt; &quot;AGGRESSIVE&quot;
## $ processing_attribute3                &lt;chr&gt; NA
## $ file_name                            &lt;chr&gt; &quot;HIGH_AGGRESSIVE&quot;
## $ number_of_points                     &lt;int&gt; 52974294
## $ las_area_m2                          &lt;dbl&gt; 86661.27
## $ timer_tile_time_mins                 &lt;dbl&gt; 0.636007
## $ timer_class_dtm_norm_chm_time_mins   &lt;dbl&gt; 3.655956
## $ timer_treels_time_mins               &lt;dbl&gt; 8.906527
## $ timer_itd_time_mins                  &lt;dbl&gt; 0.02202115
## $ timer_competition_time_mins          &lt;dbl&gt; 0.1059074
## $ timer_estdbh_time_mins               &lt;dbl&gt; 0.02290262
## $ timer_silv_time_mins                 &lt;dbl&gt; 0.01256553
## $ timer_total_time_mins                &lt;dbl&gt; 13.36189
## $ sttng_input_las_dir                  &lt;chr&gt; &quot;D:/Metashape_Testing_2024&quot;
## $ sttng_use_parallel_processing        &lt;lgl&gt; FALSE
## $ sttng_desired_chm_res                &lt;dbl&gt; 0.25
## $ sttng_max_height_threshold_m         &lt;int&gt; 60
## $ sttng_minimum_tree_height_m          &lt;int&gt; 2
## $ sttng_dbh_max_size_m                 &lt;int&gt; 2
## $ sttng_local_dbh_model                &lt;chr&gt; &quot;rf&quot;
## $ sttng_user_supplied_epsg             &lt;lgl&gt; NA
## $ sttng_accuracy_level                 &lt;int&gt; 2
## $ sttng_pts_m2_for_triangulation       &lt;int&gt; 20
## $ sttng_normalization_with             &lt;chr&gt; &quot;triangulation&quot;
## $ sttng_competition_buffer_m           &lt;int&gt; 5
## $ depth_maps_generation_quality        &lt;ord&gt; high
## $ depth_maps_generation_filtering_mode &lt;ord&gt; aggressive
## $ processed_data_dir                   &lt;chr&gt; &quot;D:/SfM_Software_Comparison/Metas…
## $ processing_id                        &lt;int&gt; 1
## $ true_positive_n_trees                &lt;int&gt; 229
## $ commission_n_trees                   &lt;int&gt; 173
## $ omission_n_trees                     &lt;int&gt; 772
## $ f_score                              &lt;dbl&gt; 0.3264433
## $ tree_height_m_mae                    &lt;dbl&gt; 0.787361
## $ tree_height_m_mape                   &lt;dbl&gt; 0.06624939
## $ tree_height_m_smape                  &lt;dbl&gt; 0.06776453
## $ tree_height_m_mse                    &lt;dbl&gt; 0.9842433
## $ tree_height_m_rmse                   &lt;dbl&gt; 0.9920904
## $ dbh_cm_mae                           &lt;dbl&gt; 11.5553
## $ dbh_cm_mape                          &lt;dbl&gt; 0.9053919
## $ dbh_cm_smape                         &lt;dbl&gt; 0.4586408
## $ dbh_cm_mse                           &lt;dbl&gt; 168.5157
## $ dbh_cm_rmse                          &lt;dbl&gt; 12.98136
## $ overstory_commission_n_trees         &lt;int&gt; 141
## $ understory_commission_n_trees        &lt;int&gt; 32
## $ overstory_omission_n_trees           &lt;int&gt; 558
## $ understory_omission_n_trees          &lt;int&gt; 214
## $ overstory_true_positive_n_trees      &lt;int&gt; 185
## $ understory_true_positive_n_trees     &lt;int&gt; 44
## $ overstory_f_score                    &lt;dbl&gt; 0.3461179
## $ understory_f_score                   &lt;dbl&gt; 0.2634731
## $ overstory_tree_height_m_mae          &lt;dbl&gt; 0.8201433
## $ understory_tree_height_m_mae         &lt;dbl&gt; 0.6495266
## $ overstory_tree_height_m_mape         &lt;dbl&gt; 0.04662933
## $ understory_tree_height_m_mape        &lt;dbl&gt; 0.1487428
## $ overstory_tree_height_m_smape        &lt;dbl&gt; 0.04589942
## $ understory_tree_height_m_smape       &lt;dbl&gt; 0.1596974
## $ overstory_tree_height_m_mse          &lt;dbl&gt; 1.062376
## $ understory_tree_height_m_mse         &lt;dbl&gt; 0.65573
## $ overstory_tree_height_m_rmse         &lt;dbl&gt; 1.030716
## $ understory_tree_height_m_rmse        &lt;dbl&gt; 0.8097715
## $ overstory_dbh_cm_mae                 &lt;dbl&gt; 10.10785
## $ understory_dbh_cm_mae                &lt;dbl&gt; 17.64118
## $ overstory_dbh_cm_mape                &lt;dbl&gt; 0.4071769
## $ understory_dbh_cm_mape               &lt;dbl&gt; 3.000159
## $ overstory_dbh_cm_smape               &lt;dbl&gt; 0.3089094
## $ understory_dbh_cm_smape              &lt;dbl&gt; 1.088193
## $ overstory_dbh_cm_mse                 &lt;dbl&gt; 132.7215
## $ understory_dbh_cm_mse                &lt;dbl&gt; 319.0139
## $ overstory_dbh_cm_rmse                &lt;dbl&gt; 11.52048
## $ understory_dbh_cm_rmse               &lt;dbl&gt; 17.86096
## $ validation_file_full_path            &lt;chr&gt; &quot;D:/SfM_Software_Comparison/Metas…
## $ overstory_ht_m                       &lt;dbl&gt; 7</code></pre>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="field_valid.html#cb143-1" tabindex="-1"></a><span class="co"># output file is the same thing as field_uas_comparison_fn</span></span>
<span id="cb143-2"><a href="field_valid.html#cb143-2" tabindex="-1"></a>validation_temp<span class="sc">$</span>validation_file_full_path <span class="sc">%&gt;%</span> </span>
<span id="cb143-3"><a href="field_valid.html#cb143-3" tabindex="-1"></a>  readr<span class="sc">::</span><span class="fu">read_csv</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb143-4"><a href="field_valid.html#cb143-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 1,174
## Columns: 28
## $ field_uas_group                      &lt;chr&gt; &quot;true positive&quot;, &quot;true positive&quot;,…
## $ uas_tree_id                          &lt;chr&gt; &quot;1000_-157206.9_4068542.9&quot;, &quot;1020…
## $ field_tree_id                        &lt;dbl&gt; 96, 82, 87, 42, 77, 85, 51, 56, 4…
## $ height_diff_pct                      &lt;dbl&gt; -0.065845684, -0.014773812, 0.009…
## $ field_uas_distance_m                 &lt;dbl&gt; 0.5527370, 1.7755352, 2.1687497, …
## $ uas_dbh_cm                           &lt;dbl&gt; 31.85495, 42.68784, 37.65799, 43.…
## $ uas_tree_utm_x                       &lt;dbl&gt; 380396.4, 380441.5, 380403.7, 380…
## $ uas_tree_utm_y                       &lt;dbl&gt; 4044246, 4044246, 4044240, 404423…
## $ field_dbh_cm                         &lt;dbl&gt; 25.908, 33.020, 28.448, 34.290, 4…
## $ field_tree_utm_x                     &lt;dbl&gt; 380396.4, 380441.9, 380403.7, 380…
## $ field_tree_utm_y                     &lt;dbl&gt; 4044246, 4044244, 4044242, 404423…
## $ uas_tree_height_m                    &lt;dbl&gt; 10.851, 19.284, 15.638, 20.122, 2…
## $ field_tree_height_m                  &lt;dbl&gt; 11.615854, 19.573171, 15.487805, …
## $ dbh_diff_cm                          &lt;dbl&gt; 5.946947, 9.667837, 9.209988, 9.5…
## $ tree_height_diff_m                   &lt;dbl&gt; -0.7648538, -0.2891703, 0.1501947…
## $ dbh_diff_pct                         &lt;dbl&gt; 0.22954097, 0.29278732, 0.3237481…
## $ abs_dbh_diff_pct                     &lt;dbl&gt; 0.22954097, 0.29278732, 0.3237481…
## $ abs_height_diff_pct                  &lt;dbl&gt; 0.065845684, 0.014773812, 0.00969…
## $ overstory_understory_grp             &lt;chr&gt; &quot;overstory&quot;, &quot;overstory&quot;, &quot;overst…
## $ overstory_ht_m                       &lt;dbl&gt; 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, …
## $ processing_id                        &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
## $ study_site                           &lt;chr&gt; &quot;KAIBAB_HIGH&quot;, &quot;KAIBAB_HIGH&quot;, &quot;KA…
## $ file_name                            &lt;chr&gt; &quot;HIGH_AGGRESSIVE&quot;, &quot;HIGH_AGGRESSI…
## $ software                             &lt;chr&gt; &quot;METASHAPE&quot;, &quot;METASHAPE&quot;, &quot;METASH…
## $ depth_maps_generation_quality        &lt;chr&gt; &quot;high&quot;, &quot;high&quot;, &quot;high&quot;, &quot;high&quot;, &quot;…
## $ depth_maps_generation_filtering_mode &lt;chr&gt; &quot;aggressive&quot;, &quot;aggressive&quot;, &quot;aggr…
## $ processing_attribute3                &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ processed_data_dir                   &lt;chr&gt; &quot;D:/SfM_Software_Comparison/Metas…</code></pre>
</div>
</div>
<div id="full-pipeline-function" class="section level2 hasAnchor" number="5.4">
<h2><span class="header-section-number">5.4</span> Full pipeline function<a href="field_valid.html#full-pipeline-function" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>function to map over study sites represented in <code>ptcld_processing_data</code></p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="field_valid.html#cb145-1" tabindex="-1"></a><span class="co"># function to map over study sites represented in ptcld_processing_data</span></span>
<span id="cb145-2"><a href="field_valid.html#cb145-2" tabindex="-1"></a><span class="co"># set up in a way so that only have to read field data from disk once and </span></span>
<span id="cb145-3"><a href="field_valid.html#cb145-3" tabindex="-1"></a><span class="co"># perform validation for each uas data represented for that site in ptcld_processing_data</span></span>
<span id="cb145-4"><a href="field_valid.html#cb145-4" tabindex="-1"></a><span class="co"># Returns:</span></span>
<span id="cb145-5"><a href="field_valid.html#cb145-5" tabindex="-1"></a><span class="co"># 1) write full validation tree list to disk</span></span>
<span id="cb145-6"><a href="field_valid.html#cb145-6" tabindex="-1"></a><span class="co"># 2) update ptcld_processing_data with metrics for testing:</span></span>
<span id="cb145-7"><a href="field_valid.html#cb145-7" tabindex="-1"></a>  <span class="co"># f-score</span></span>
<span id="cb145-8"><a href="field_valid.html#cb145-8" tabindex="-1"></a>  <span class="co"># ht rmse</span></span>
<span id="cb145-9"><a href="field_valid.html#cb145-9" tabindex="-1"></a>  <span class="co"># dbh rmse</span></span>
<span id="cb145-10"><a href="field_valid.html#cb145-10" tabindex="-1"></a>  <span class="co"># path to validation tree list</span></span>
<span id="cb145-11"><a href="field_valid.html#cb145-11" tabindex="-1"></a>full_validation_fn <span class="ot">=</span> <span class="cf">function</span>(study_site_nm) {</span>
<span id="cb145-12"><a href="field_valid.html#cb145-12" tabindex="-1"></a>  <span class="co"># filter plot data</span></span>
<span id="cb145-13"><a href="field_valid.html#cb145-13" tabindex="-1"></a>    validation_plot <span class="ot">=</span> validation_plots <span class="sc">%&gt;%</span> </span>
<span id="cb145-14"><a href="field_valid.html#cb145-14" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(study_site <span class="sc">==</span> study_site_nm)</span>
<span id="cb145-15"><a href="field_valid.html#cb145-15" tabindex="-1"></a>  <span class="co"># read field data</span></span>
<span id="cb145-16"><a href="field_valid.html#cb145-16" tabindex="-1"></a>    field_data <span class="ot">=</span> <span class="fu">read_field_data</span>(study_site_nm)</span>
<span id="cb145-17"><a href="field_valid.html#cb145-17" tabindex="-1"></a>  <span class="co"># # map over file validation function and return data</span></span>
<span id="cb145-18"><a href="field_valid.html#cb145-18" tabindex="-1"></a>    <span class="co"># function for a file name identified by processing_id in ptcld_processing_data</span></span>
<span id="cb145-19"><a href="field_valid.html#cb145-19" tabindex="-1"></a>    d <span class="ot">=</span> ptcld_processing_data <span class="sc">%&gt;%</span> </span>
<span id="cb145-20"><a href="field_valid.html#cb145-20" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(study_site <span class="sc">==</span> study_site_nm) <span class="sc">%&gt;%</span> </span>
<span id="cb145-21"><a href="field_valid.html#cb145-21" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">pull</span>(processing_id) <span class="sc">%&gt;%</span> </span>
<span id="cb145-22"><a href="field_valid.html#cb145-22" tabindex="-1"></a>      purrr<span class="sc">::</span><span class="fu">map</span>(validate_file_fn, <span class="at">fld_dta =</span> field_data, <span class="at">plt_dta =</span> validation_plot) <span class="sc">%&gt;%</span> </span>
<span id="cb145-23"><a href="field_valid.html#cb145-23" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">bind_rows</span>()</span>
<span id="cb145-24"><a href="field_valid.html#cb145-24" tabindex="-1"></a>  <span class="co"># return</span></span>
<span id="cb145-25"><a href="field_valid.html#cb145-25" tabindex="-1"></a>    <span class="fu">return</span>(d)</span>
<span id="cb145-26"><a href="field_valid.html#cb145-26" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="apply-validation-for-all" class="section level2 hasAnchor" number="5.5">
<h2><span class="header-section-number">5.5</span> Apply validation for all<a href="field_valid.html#apply-validation-for-all" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="field_valid.html#cb146-1" tabindex="-1"></a>ptcld_validation_data <span class="ot">=</span> </span>
<span id="cb146-2"><a href="field_valid.html#cb146-2" tabindex="-1"></a>  study_site_list <span class="sc">%&gt;%</span> </span>
<span id="cb146-3"><a href="field_valid.html#cb146-3" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">map</span>(full_validation_fn) <span class="sc">%&gt;%</span> </span>
<span id="cb146-4"><a href="field_valid.html#cb146-4" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_rows</span>()</span>
<span id="cb146-5"><a href="field_valid.html#cb146-5" tabindex="-1"></a><span class="co"># write this!</span></span>
<span id="cb146-6"><a href="field_valid.html#cb146-6" tabindex="-1"></a><span class="fu">write.csv</span>(</span>
<span id="cb146-7"><a href="field_valid.html#cb146-7" tabindex="-1"></a>    ptcld_validation_data</span>
<span id="cb146-8"><a href="field_valid.html#cb146-8" tabindex="-1"></a>    , <span class="st">&quot;../data/ptcld_full_analysis_data.csv&quot;</span></span>
<span id="cb146-9"><a href="field_valid.html#cb146-9" tabindex="-1"></a>    , <span class="at">row.names =</span> F</span>
<span id="cb146-10"><a href="field_valid.html#cb146-10" tabindex="-1"></a>  )</span></code></pre></div>
<p>what is this validation data?</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="field_valid.html#cb147-1" tabindex="-1"></a>ptcld_validation_data <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 257
## Columns: 77
## $ tracking_file_full_path              &lt;chr&gt; &quot;D:\\SfM_Software_Comparison\\Met…
## $ software                             &lt;chr&gt; &quot;METASHAPE&quot;, &quot;METASHAPE&quot;, &quot;METASH…
## $ study_site                           &lt;chr&gt; &quot;KAIBAB_HIGH&quot;, &quot;KAIBAB_HIGH&quot;, &quot;KA…
## $ processing_attribute1                &lt;chr&gt; &quot;HIGH&quot;, &quot;HIGH&quot;, &quot;HIGH&quot;, &quot;HIGH&quot;, &quot;…
## $ processing_attribute2                &lt;chr&gt; &quot;AGGRESSIVE&quot;, &quot;DISABLED&quot;, &quot;MILD&quot;,…
## $ processing_attribute3                &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ file_name                            &lt;chr&gt; &quot;HIGH_AGGRESSIVE&quot;, &quot;HIGH_DISABLED…
## $ number_of_points                     &lt;int&gt; 52974294, 72549206, 69858217, 698…
## $ las_area_m2                          &lt;dbl&gt; 86661.27, 87175.42, 86404.78, 864…
## $ timer_tile_time_mins                 &lt;dbl&gt; 0.63600698, 2.49318542, 0.8413380…
## $ timer_class_dtm_norm_chm_time_mins   &lt;dbl&gt; 3.6559556, 5.3289152, 5.1638296, …
## $ timer_treels_time_mins               &lt;dbl&gt; 8.9065272, 19.2119663, 12.3391793…
## $ timer_itd_time_mins                  &lt;dbl&gt; 0.02202115, 0.02449968, 0.0379844…
## $ timer_competition_time_mins          &lt;dbl&gt; 0.10590740, 0.17865245, 0.1212486…
## $ timer_estdbh_time_mins               &lt;dbl&gt; 0.02290262, 0.02382533, 0.0219917…
## $ timer_silv_time_mins                 &lt;dbl&gt; 0.012565533, 0.015940932, 0.01503…
## $ timer_total_time_mins                &lt;dbl&gt; 13.361886, 27.276985, 18.540606, …
## $ sttng_input_las_dir                  &lt;chr&gt; &quot;D:/Metashape_Testing_2024&quot;, &quot;D:/…
## $ sttng_use_parallel_processing        &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE…
## $ sttng_desired_chm_res                &lt;dbl&gt; 0.25, 0.25, 0.25, 0.25, 0.25, 0.2…
## $ sttng_max_height_threshold_m         &lt;int&gt; 60, 60, 60, 60, 60, 60, 60, 60, 6…
## $ sttng_minimum_tree_height_m          &lt;int&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, …
## $ sttng_dbh_max_size_m                 &lt;int&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, …
## $ sttng_local_dbh_model                &lt;chr&gt; &quot;rf&quot;, &quot;rf&quot;, &quot;rf&quot;, &quot;rf&quot;, &quot;rf&quot;, &quot;rf…
## $ sttng_user_supplied_epsg             &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ sttng_accuracy_level                 &lt;int&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, …
## $ sttng_pts_m2_for_triangulation       &lt;int&gt; 20, 20, 20, 20, 20, 20, 20, 20, 2…
## $ sttng_normalization_with             &lt;chr&gt; &quot;triangulation&quot;, &quot;triangulation&quot;,…
## $ sttng_competition_buffer_m           &lt;int&gt; 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, …
## $ depth_maps_generation_quality        &lt;ord&gt; high, high, high, high, low, low,…
## $ depth_maps_generation_filtering_mode &lt;ord&gt; aggressive, disabled, mild, moder…
## $ processed_data_dir                   &lt;chr&gt; &quot;D:/SfM_Software_Comparison/Metas…
## $ processing_id                        &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11…
## $ true_positive_n_trees                &lt;dbl&gt; 229, 261, 260, 234, 220, 175, 231…
## $ commission_n_trees                   &lt;dbl&gt; 173, 222, 213, 193, 148, 223, 163…
## $ omission_n_trees                     &lt;dbl&gt; 772, 740, 741, 767, 781, 826, 770…
## $ f_score                              &lt;dbl&gt; 0.3264433, 0.3517520, 0.3527815, …
## $ tree_height_m_mae                    &lt;dbl&gt; 0.7873610, 0.6886235, 0.6914983, …
## $ tree_height_m_mape                   &lt;dbl&gt; 0.06624939, 0.06903969, 0.0605504…
## $ tree_height_m_smape                  &lt;dbl&gt; 0.06776453, 0.06838733, 0.0604101…
## $ tree_height_m_mse                    &lt;dbl&gt; 0.9842433, 0.8507862, 0.8259923, …
## $ tree_height_m_rmse                   &lt;dbl&gt; 0.9920904, 0.9223807, 0.9088412, …
## $ dbh_cm_mae                           &lt;dbl&gt; 11.555302, 9.439955, 11.670151, 8…
## $ dbh_cm_mape                          &lt;dbl&gt; 0.9053919, 0.8691048, 1.0134733, …
## $ dbh_cm_smape                         &lt;dbl&gt; 0.4586408, 0.4672844, 0.5094402, …
## $ dbh_cm_mse                           &lt;dbl&gt; 168.51570, 113.72189, 165.49006, …
## $ dbh_cm_rmse                          &lt;dbl&gt; 12.981360, 10.664046, 12.864294, …
## $ overstory_commission_n_trees         &lt;dbl&gt; 141, 178, 178, 160, 95, 173, 120,…
## $ understory_commission_n_trees        &lt;dbl&gt; 32, 44, 35, 33, 53, 50, 43, 39, 1…
## $ overstory_omission_n_trees           &lt;dbl&gt; 558, 560, 545, 556, 554, 598, 545…
## $ understory_omission_n_trees          &lt;dbl&gt; 214, 180, 196, 211, 227, 228, 225…
## $ overstory_true_positive_n_trees      &lt;dbl&gt; 185, 183, 198, 187, 189, 145, 198…
## $ understory_true_positive_n_trees     &lt;dbl&gt; 44, 78, 62, 47, 31, 30, 33, 40, 2…
## $ overstory_f_score                    &lt;dbl&gt; 0.3461179, 0.3315217, 0.3538874, …
## $ understory_f_score                   &lt;dbl&gt; 0.2634731, 0.4105263, 0.3492958, …
## $ overstory_tree_height_m_mae          &lt;dbl&gt; 0.8201433, 0.7820879, 0.7770369, …
## $ understory_tree_height_m_mae         &lt;dbl&gt; 0.6495266, 0.4693415, 0.4183269, …
## $ overstory_tree_height_m_mape         &lt;dbl&gt; 0.04662933, 0.04863237, 0.0487081…
## $ understory_tree_height_m_mape        &lt;dbl&gt; 0.14874284, 0.11691842, 0.0983694…
## $ overstory_tree_height_m_smape        &lt;dbl&gt; 0.04589942, 0.04776615, 0.0479123…
## $ understory_tree_height_m_smape       &lt;dbl&gt; 0.15969736, 0.11676780, 0.1003222…
## $ overstory_tree_height_m_mse          &lt;dbl&gt; 1.0623763, 1.0055835, 0.9739823, …
## $ understory_tree_height_m_mse         &lt;dbl&gt; 0.6557300, 0.4876080, 0.3533791, …
## $ overstory_tree_height_m_rmse         &lt;dbl&gt; 1.0307164, 1.0027878, 0.9869054, …
## $ understory_tree_height_m_rmse        &lt;dbl&gt; 0.8097715, 0.6982893, 0.5944570, …
## $ overstory_dbh_cm_mae                 &lt;dbl&gt; 10.107851, 8.373138, 10.265066, 8…
## $ understory_dbh_cm_mae                &lt;dbl&gt; 17.641176, 11.942873, 16.157356, …
## $ overstory_dbh_cm_mape                &lt;dbl&gt; 0.4071769, 0.3573197, 0.4596754, …
## $ understory_dbh_cm_mape               &lt;dbl&gt; 3.0001592, 2.0698314, 2.7820538, …
## $ overstory_dbh_cm_smape               &lt;dbl&gt; 0.3089094, 0.2847618, 0.3445048, …
## $ understory_dbh_cm_smape              &lt;dbl&gt; 1.0881933, 0.8955103, 1.0361694, …
## $ overstory_dbh_cm_mse                 &lt;dbl&gt; 132.72154, 97.99970, 132.95525, 9…
## $ understory_dbh_cm_mse                &lt;dbl&gt; 319.013915, 150.608552, 269.39152…
## $ overstory_dbh_cm_rmse                &lt;dbl&gt; 11.520483, 9.899480, 11.530622, 9…
## $ understory_dbh_cm_rmse               &lt;dbl&gt; 17.860961, 12.272268, 16.413151, …
## $ validation_file_full_path            &lt;chr&gt; &quot;D:/SfM_Software_Comparison/Metas…
## $ overstory_ht_m                       &lt;dbl&gt; 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, …</code></pre>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="field_valid.html#cb149-1" tabindex="-1"></a><span class="co"># summary of validation metrics</span></span>
<span id="cb149-2"><a href="field_valid.html#cb149-2" tabindex="-1"></a>ptcld_validation_data <span class="sc">%&gt;%</span> </span>
<span id="cb149-3"><a href="field_valid.html#cb149-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(f_score, tree_height_m_mape, dbh_cm_mape) <span class="sc">%&gt;%</span> </span>
<span id="cb149-4"><a href="field_valid.html#cb149-4" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>##     f_score       tree_height_m_mape  dbh_cm_mape    
##  Min.   :0.0113   Min.   :0.02518    Min.   :0.0745  
##  1st Qu.:0.2996   1st Qu.:0.05227    1st Qu.:0.2127  
##  Median :0.4443   Median :0.06227    Median :0.3029  
##  Mean   :0.4633   Mean   :0.06575    Mean   :0.5889  
##  3rd Qu.:0.6217   3rd Qu.:0.07143    3rd Qu.:0.6367  
##  Max.   :0.8997   Max.   :0.15715    Max.   :9.6853</code></pre>
</div>
<div id="example-validation-process" class="section level2 hasAnchor" number="5.6">
<h2><span class="header-section-number">5.6</span> Example Validation Process<a href="field_valid.html#example-validation-process" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s go through one example</p>
<p>Data setup using functions defined above</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="field_valid.html#cb151-1" tabindex="-1"></a><span class="co"># read field data</span></span>
<span id="cb151-2"><a href="field_valid.html#cb151-2" tabindex="-1"></a>field_data_temp <span class="ot">=</span> <span class="fu">read_field_data</span>(<span class="at">my_study_site =</span> study_site_list[<span class="dv">1</span>])</span>
<span id="cb151-3"><a href="field_valid.html#cb151-3" tabindex="-1"></a><span class="co"># read_uas_data</span></span>
<span id="cb151-4"><a href="field_valid.html#cb151-4" tabindex="-1"></a>uas_data_temp <span class="ot">=</span> <span class="fu">read_uas_data</span>(</span>
<span id="cb151-5"><a href="field_valid.html#cb151-5" tabindex="-1"></a>  <span class="at">my_processing_id =</span> ptcld_processing_data <span class="sc">%&gt;%</span> </span>
<span id="cb151-6"><a href="field_valid.html#cb151-6" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(study_site<span class="sc">==</span>study_site_list[<span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb151-7"><a href="field_valid.html#cb151-7" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(processing_id) <span class="sc">%&gt;%</span> </span>
<span id="cb151-8"><a href="field_valid.html#cb151-8" tabindex="-1"></a>    .[<span class="dv">1</span>]</span>
<span id="cb151-9"><a href="field_valid.html#cb151-9" tabindex="-1"></a>  , <span class="at">my_crs =</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(field_data_temp)</span>
<span id="cb151-10"><a href="field_valid.html#cb151-10" tabindex="-1"></a>)</span>
<span id="cb151-11"><a href="field_valid.html#cb151-11" tabindex="-1"></a><span class="co"># true positive</span></span>
<span id="cb151-12"><a href="field_valid.html#cb151-12" tabindex="-1"></a>true_positive_trees_temp <span class="ot">=</span> <span class="fu">true_positive_trees_fn</span>(<span class="at">uas_data =</span> uas_data_temp, <span class="at">field_data =</span> field_data_temp)</span>
<span id="cb151-13"><a href="field_valid.html#cb151-13" tabindex="-1"></a><span class="co"># field_uas_comparison_fn</span></span>
<span id="cb151-14"><a href="field_valid.html#cb151-14" tabindex="-1"></a>field_uas_comparison_temp <span class="ot">=</span> <span class="fu">field_uas_comparison_fn</span>(</span>
<span id="cb151-15"><a href="field_valid.html#cb151-15" tabindex="-1"></a>  <span class="at">uas_data =</span> uas_data_temp</span>
<span id="cb151-16"><a href="field_valid.html#cb151-16" tabindex="-1"></a>  , <span class="at">field_data =</span> field_data_temp</span>
<span id="cb151-17"><a href="field_valid.html#cb151-17" tabindex="-1"></a>  , <span class="at">true_positive_trees =</span> true_positive_trees_temp </span>
<span id="cb151-18"><a href="field_valid.html#cb151-18" tabindex="-1"></a>  , <span class="at">plot_data =</span> validation_plots <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(study_site<span class="sc">==</span>study_site_list[<span class="dv">1</span>])</span>
<span id="cb151-19"><a href="field_valid.html#cb151-19" tabindex="-1"></a>)</span></code></pre></div>
<p>what is this data?</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="field_valid.html#cb152-1" tabindex="-1"></a><span class="co"># field_data</span></span>
<span id="cb152-2"><a href="field_valid.html#cb152-2" tabindex="-1"></a>field_data_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 1,001
## Columns: 15
## $ field_tree_id              &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, …
## $ site                       &lt;chr&gt; &quot;Kaibab - High&quot;, &quot;Kaibab - High&quot;, &quot;Kaibab -…
## $ northing                   &lt;dbl&gt; 4044280, 4044279, 4044279, 4044277, 4044274…
## $ easting                    &lt;dbl&gt; 380320.7, 380322.0, 380325.2, 380325.3, 380…
## $ spp                        &lt;chr&gt; &quot;PIPO&quot;, &quot;PIPO&quot;, &quot;PIPO&quot;, &quot;PIPO&quot;, &quot;PIPO&quot;, &quot;PI…
## $ a.d                        &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
## $ field_dbh_cm               &lt;dbl&gt; 39.116, 55.118, 29.718, 32.258, 23.622, 25.…
## $ cbh_m                      &lt;dbl&gt; 13.079268, 15.152439, 11.280488, 11.036585,…
## $ field_tree_height_m        &lt;dbl&gt; 24.268293, 20.975610, 18.170732, 21.920732,…
## $ notes                      &lt;chr&gt; NA, NA, NA, NA, NA, NA, &quot;Broken Top&quot;, NA, N…
## $ study_site                 &lt;chr&gt; &quot;KAIBAB_HIGH&quot;, &quot;KAIBAB_HIGH&quot;, &quot;KAIBAB_HIGH&quot;…
## $ intersected_with_plot_geom &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, T…
## $ geometry                   &lt;POINT [m]&gt; POINT (380320.7 4044280), POINT (3803…
## $ tree_utm_x                 &lt;dbl&gt; 380320.7, 380322.0, 380325.2, 380325.3, 380…
## $ tree_utm_y                 &lt;dbl&gt; 4044280, 4044279, 4044279, 4044277, 4044274…</code></pre>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="field_valid.html#cb154-1" tabindex="-1"></a><span class="co"># uas_data</span></span>
<span id="cb154-2"><a href="field_valid.html#cb154-2" tabindex="-1"></a>uas_data_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 1,259
## Columns: 22
## $ treeid                    &lt;chr&gt; &quot;1_-157191.6_4068747.9&quot;, &quot;2_-157198.1_406874…
## $ tree_height_m             &lt;dbl&gt; 2.482, 2.410, 5.571, 2.576, 8.952, 13.015, 6…
## $ crown_area_m2             &lt;dbl&gt; 0.7500, 0.7500, 1.8125, 1.3750, 0.5625, 5.00…
## $ comp_trees_per_ha         &lt;dbl&gt; 636.9108, 127.3822, 636.9108, 764.2929, 764.…
## $ comp_relative_tree_height &lt;dbl&gt; 19.070304, 100.000000, 42.804456, 19.792546,…
## $ comp_dist_to_nearest_m    &lt;dbl&gt; 1.9525624, 5.8363088, 1.7677669, 2.1360009, …
## $ mean_crown_ht_m           &lt;dbl&gt; 2.437000, 2.365500, 4.645339, 2.418045, 8.95…
## $ median_crown_ht_m         &lt;dbl&gt; 2.437000, 2.365500, 4.725667, 2.440250, 8.95…
## $ min_crown_ht_m            &lt;dbl&gt; 2.392000, 2.321000, 2.588000, 2.213000, 8.95…
## $ reg_est_dbh_cm            &lt;dbl&gt; 4.338144, 4.209016, 8.711511, 4.449759, 14.5…
## $ reg_est_dbh_cm_lower      &lt;dbl&gt; 2.284797, 2.225255, 4.611801, 2.345390, 7.66…
## $ reg_est_dbh_cm_upper      &lt;dbl&gt; 6.901735, 6.715011, 13.763752, 7.062646, 23.…
## $ is_training_data          &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FA…
## $ dbh_cm                    &lt;dbl&gt; 24.14333, 24.15568, 26.79370, 24.23745, 30.0…
## $ dbh_m                     &lt;dbl&gt; 0.2414333, 0.2415568, 0.2679370, 0.2423745, …
## $ radius_m                  &lt;dbl&gt; 0.1207166, 0.1207784, 0.1339685, 0.1211873, …
## $ basal_area_m2             &lt;dbl&gt; 0.04578088, 0.04582772, 0.05638391, 0.046138…
## $ basal_area_ft2            &lt;dbl&gt; 0.4927854, 0.4932896, 0.6069164, 0.4966353, …
## $ processing_id             &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ rf_dbh_cm                 &lt;dbl&gt; 33.60728, 41.39027, 34.40597, 33.58731, 30.2…
## $ lin_dbh_cm                &lt;dbl&gt; 24.14333, 24.15568, 26.79370, 24.23745, 30.0…
## $ geometry                  &lt;POINT [m]&gt; POINT (380398.8 4044450), POINT (38039…</code></pre>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="field_valid.html#cb156-1" tabindex="-1"></a><span class="co"># true_positive_trees</span></span>
<span id="cb156-2"><a href="field_valid.html#cb156-2" tabindex="-1"></a>true_positive_trees_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 229
## Columns: 7
## $ uas_tree_id          &lt;chr&gt; &quot;1000_-157206.9_4068542.9&quot;, &quot;1020_-157161.6_40685…
## $ field_tree_id        &lt;int&gt; 96, 82, 87, 42, 77, 85, 51, 56, 45, 788, 792, 784…
## $ uas_tree_height_m    &lt;dbl&gt; 10.851, 19.284, 15.638, 20.122, 24.591, 18.014, 2…
## $ field_tree_height_m  &lt;dbl&gt; 11.615854, 19.573171, 15.487805, 20.457317, 22.80…
## $ height_diff_pct      &lt;dbl&gt; 0.065845684, 0.014773812, 0.009697608, 0.01639107…
## $ field_uas_distance_m &lt;dbl&gt; 0.5527370, 1.7755352, 2.1687497, 1.7193571, 2.827…
## $ field_uas_group      &lt;chr&gt; &quot;true positive&quot;, &quot;true positive&quot;, &quot;true positive&quot;…</code></pre>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="field_valid.html#cb158-1" tabindex="-1"></a><span class="co"># field_uas_comparison</span></span>
<span id="cb158-2"><a href="field_valid.html#cb158-2" tabindex="-1"></a>field_uas_comparison_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 1,174
## Columns: 20
## $ field_uas_group          &lt;ord&gt; true positive, true positive, true positive, …
## $ uas_tree_id              &lt;chr&gt; &quot;1000_-157206.9_4068542.9&quot;, &quot;1020_-157161.6_4…
## $ field_tree_id            &lt;dbl&gt; 96, 82, 87, 42, 77, 85, 51, 56, 45, 788, 792,…
## $ height_diff_pct          &lt;dbl&gt; -0.065845684, -0.014773812, 0.009697608, -0.0…
## $ field_uas_distance_m     &lt;dbl&gt; 0.5527370, 1.7755352, 2.1687497, 1.7193571, 2…
## $ uas_dbh_cm               &lt;dbl&gt; 31.98057, 42.37785, 37.52537, 43.93743, 50.79…
## $ uas_tree_utm_x           &lt;dbl&gt; 380396.4, 380441.5, 380403.7, 380408.0, 38042…
## $ uas_tree_utm_y           &lt;dbl&gt; 4044246, 4044246, 4044240, 4044239, 4044241, …
## $ field_dbh_cm             &lt;dbl&gt; 25.908, 33.020, 28.448, 34.290, 44.958, 37.59…
## $ field_tree_utm_x         &lt;dbl&gt; 380396.4, 380441.9, 380403.7, 380408.0, 38042…
## $ field_tree_utm_y         &lt;dbl&gt; 4044246, 4044244, 4044242, 4044238, 4044238, …
## $ uas_tree_height_m        &lt;dbl&gt; 10.851, 19.284, 15.638, 20.122, 24.591, 18.01…
## $ field_tree_height_m      &lt;dbl&gt; 11.615854, 19.573171, 15.487805, 20.457317, 2…
## $ dbh_diff_cm              &lt;dbl&gt; 6.072571, 9.357850, 9.077368, 9.647426, 5.838…
## $ tree_height_diff_m       &lt;dbl&gt; -0.7648538, -0.2891703, 0.1501947, -0.3353173…
## $ dbh_diff_pct             &lt;dbl&gt; 0.23438980, 0.28339947, 0.31908634, 0.2813480…
## $ abs_dbh_diff_pct         &lt;dbl&gt; 0.23438980, 0.28339947, 0.31908634, 0.2813480…
## $ abs_height_diff_pct      &lt;dbl&gt; 0.065845684, 0.014773812, 0.009697608, 0.0163…
## $ overstory_understory_grp &lt;fct&gt; overstory, overstory, overstory, overstory, o…
## $ overstory_ht_m           &lt;dbl&gt; 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, …</code></pre>
<div id="height-vs.-dbh-of-tp-co-om" class="section level3 hasAnchor" number="5.6.1">
<h3><span class="header-section-number">5.6.1</span> Height vs. DBH of <span class="math inline">\(Tp\)</span>, <span class="math inline">\(Co\)</span>, <span class="math inline">\(Om\)</span><a href="field_valid.html#height-vs.-dbh-of-tp-co-om" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="field_valid.html#cb160-1" tabindex="-1"></a>field_uas_comparison_temp <span class="sc">%&gt;%</span> </span>
<span id="cb160-2"><a href="field_valid.html#cb160-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb160-3"><a href="field_valid.html#cb160-3" tabindex="-1"></a>    <span class="at">dbh_temp =</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(field_dbh_cm, uas_dbh_cm)</span>
<span id="cb160-4"><a href="field_valid.html#cb160-4" tabindex="-1"></a>    , <span class="at">ht_temp =</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(field_tree_height_m, uas_tree_height_m)</span>
<span id="cb160-5"><a href="field_valid.html#cb160-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb160-6"><a href="field_valid.html#cb160-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb160-7"><a href="field_valid.html#cb160-7" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> ht_temp, <span class="at">y =</span> dbh_temp, <span class="at">color =</span> field_uas_group)</span>
<span id="cb160-8"><a href="field_valid.html#cb160-8" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb160-9"><a href="field_valid.html#cb160-9" tabindex="-1"></a>    <span class="fu">geom_point</span>(</span>
<span id="cb160-10"><a href="field_valid.html#cb160-10" tabindex="-1"></a>      <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">shape =</span> field_uas_group)</span>
<span id="cb160-11"><a href="field_valid.html#cb160-11" tabindex="-1"></a>      , <span class="at">alpha=</span><span class="fl">0.8</span></span>
<span id="cb160-12"><a href="field_valid.html#cb160-12" tabindex="-1"></a>      , <span class="at">size=</span><span class="dv">2</span></span>
<span id="cb160-13"><a href="field_valid.html#cb160-13" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb160-14"><a href="field_valid.html#cb160-14" tabindex="-1"></a>    <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;cividis&quot;</span>, <span class="at">drop =</span> F) <span class="sc">+</span></span>
<span id="cb160-15"><a href="field_valid.html#cb160-15" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">extended_breaks</span>(<span class="at">n=</span><span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb160-16"><a href="field_valid.html#cb160-16" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">extended_breaks</span>(<span class="at">n=</span><span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb160-17"><a href="field_valid.html#cb160-17" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb160-18"><a href="field_valid.html#cb160-18" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">&quot;detection&quot;</span></span>
<span id="cb160-19"><a href="field_valid.html#cb160-19" tabindex="-1"></a>      , <span class="at">shape =</span> <span class="st">&quot;detection&quot;</span></span>
<span id="cb160-20"><a href="field_valid.html#cb160-20" tabindex="-1"></a>      , <span class="at">y =</span> <span class="st">&quot;DBH (cm)&quot;</span></span>
<span id="cb160-21"><a href="field_valid.html#cb160-21" tabindex="-1"></a>      , <span class="at">x =</span> <span class="st">&quot;Tree Ht. (m)&quot;</span></span>
<span id="cb160-22"><a href="field_valid.html#cb160-22" tabindex="-1"></a>      , <span class="at">title =</span> <span class="st">&quot;UAS and Stem-Mapped Tree Validation Summary&quot;</span></span>
<span id="cb160-23"><a href="field_valid.html#cb160-23" tabindex="-1"></a>      , <span class="at">subtitle =</span> <span class="st">&quot;height and DBH relationship&quot;</span></span>
<span id="cb160-24"><a href="field_valid.html#cb160-24" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb160-25"><a href="field_valid.html#cb160-25" tabindex="-1"></a>    <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb160-26"><a href="field_valid.html#cb160-26" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb160-27"><a href="field_valid.html#cb160-27" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb160-28"><a href="field_valid.html#cb160-28" tabindex="-1"></a>      , <span class="at">legend.direction  =</span> <span class="st">&quot;horizontal&quot;</span></span>
<span id="cb160-29"><a href="field_valid.html#cb160-29" tabindex="-1"></a>      , <span class="at">legend.title =</span> <span class="fu">element_blank</span>()</span>
<span id="cb160-30"><a href="field_valid.html#cb160-30" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb160-31"><a href="field_valid.html#cb160-31" tabindex="-1"></a>    <span class="fu">guides</span>(</span>
<span id="cb160-32"><a href="field_valid.html#cb160-32" tabindex="-1"></a>      <span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">reverse =</span> T, <span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">alpha =</span> <span class="fl">0.9</span>, <span class="at">size =</span> <span class="dv">5</span>))</span>
<span id="cb160-33"><a href="field_valid.html#cb160-33" tabindex="-1"></a>      , <span class="at">shape =</span> <span class="fu">guide_legend</span>(<span class="at">reverse =</span> T)</span>
<span id="cb160-34"><a href="field_valid.html#cb160-34" tabindex="-1"></a>    )  </span></code></pre></div>
<p><img src="metashape_testing_files/figure-html/fld-dta-sum-htdbh-1.png" width="1008" /></p>
</div>
<div id="height-and-dbh-distribution-tp-co-om" class="section level3 hasAnchor" number="5.6.2">
<h3><span class="header-section-number">5.6.2</span> Height and DBH Distribution <span class="math inline">\(Tp\)</span>, <span class="math inline">\(Co\)</span>, <span class="math inline">\(Om\)</span><a href="field_valid.html#height-and-dbh-distribution-tp-co-om" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="field_valid.html#cb161-1" tabindex="-1"></a>field_uas_comparison_temp <span class="sc">%&gt;%</span> </span>
<span id="cb161-2"><a href="field_valid.html#cb161-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb161-3"><a href="field_valid.html#cb161-3" tabindex="-1"></a>    <span class="at">dbh =</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(field_dbh_cm, uas_dbh_cm)</span>
<span id="cb161-4"><a href="field_valid.html#cb161-4" tabindex="-1"></a>    , <span class="at">height =</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(field_tree_height_m, uas_tree_height_m)</span>
<span id="cb161-5"><a href="field_valid.html#cb161-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb161-6"><a href="field_valid.html#cb161-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(dbh, height, field_uas_group) <span class="sc">%&gt;%</span> </span>
<span id="cb161-7"><a href="field_valid.html#cb161-7" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(field_uas_group), <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb161-8"><a href="field_valid.html#cb161-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(field_uas_group,metric) <span class="sc">%&gt;%</span> </span>
<span id="cb161-9"><a href="field_valid.html#cb161-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb161-10"><a href="field_valid.html#cb161-10" tabindex="-1"></a>    <span class="at">metric =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb161-11"><a href="field_valid.html#cb161-11" tabindex="-1"></a>      metric <span class="sc">==</span> <span class="st">&quot;dbh&quot;</span> <span class="sc">~</span> <span class="st">&quot;DBH (cm)&quot;</span></span>
<span id="cb161-12"><a href="field_valid.html#cb161-12" tabindex="-1"></a>      , metric <span class="sc">==</span> <span class="st">&quot;height&quot;</span> <span class="sc">~</span> <span class="st">&quot;Height (m)&quot;</span></span>
<span id="cb161-13"><a href="field_valid.html#cb161-13" tabindex="-1"></a>    )</span>
<span id="cb161-14"><a href="field_valid.html#cb161-14" tabindex="-1"></a>    , <span class="at">n_rows =</span> dplyr<span class="sc">::</span><span class="fu">n</span>()</span>
<span id="cb161-15"><a href="field_valid.html#cb161-15" tabindex="-1"></a>    , <span class="at">plot_lab =</span> <span class="fu">paste0</span>(</span>
<span id="cb161-16"><a href="field_valid.html#cb161-16" tabindex="-1"></a>      field_uas_group</span>
<span id="cb161-17"><a href="field_valid.html#cb161-17" tabindex="-1"></a>      ,<span class="st">&quot; (n=&quot;</span>, scales<span class="sc">::</span><span class="fu">comma</span>(n_rows,<span class="at">accuracy=</span><span class="dv">1</span>),<span class="st">&quot;)&quot;</span></span>
<span id="cb161-18"><a href="field_valid.html#cb161-18" tabindex="-1"></a>    )</span>
<span id="cb161-19"><a href="field_valid.html#cb161-19" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb161-20"><a href="field_valid.html#cb161-20" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> plot_lab, <span class="at">fill =</span> field_uas_group)) <span class="sc">+</span></span>
<span id="cb161-21"><a href="field_valid.html#cb161-21" tabindex="-1"></a>    <span class="fu">geom_violin</span>() <span class="sc">+</span></span>
<span id="cb161-22"><a href="field_valid.html#cb161-22" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(<span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">outlier.shape =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;gray66&quot;</span>) <span class="sc">+</span></span>
<span id="cb161-23"><a href="field_valid.html#cb161-23" tabindex="-1"></a>    <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(metric), <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb161-24"><a href="field_valid.html#cb161-24" tabindex="-1"></a>    <span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;cividis&quot;</span>, <span class="at">drop =</span> F) <span class="sc">+</span></span>
<span id="cb161-25"><a href="field_valid.html#cb161-25" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">extended_breaks</span>(<span class="at">n=</span><span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb161-26"><a href="field_valid.html#cb161-26" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb161-27"><a href="field_valid.html#cb161-27" tabindex="-1"></a>      <span class="at">fill =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb161-28"><a href="field_valid.html#cb161-28" tabindex="-1"></a>      , <span class="at">y =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb161-29"><a href="field_valid.html#cb161-29" tabindex="-1"></a>      , <span class="at">x =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb161-30"><a href="field_valid.html#cb161-30" tabindex="-1"></a>      , <span class="at">title =</span> <span class="st">&quot;UAS and Stem-Mapped Tree Validation Summary&quot;</span></span>
<span id="cb161-31"><a href="field_valid.html#cb161-31" tabindex="-1"></a>      , <span class="at">subtitle =</span> <span class="st">&quot;height and DBH distribution comparison&quot;</span></span>
<span id="cb161-32"><a href="field_valid.html#cb161-32" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb161-33"><a href="field_valid.html#cb161-33" tabindex="-1"></a>    <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb161-34"><a href="field_valid.html#cb161-34" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb161-35"><a href="field_valid.html#cb161-35" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb161-36"><a href="field_valid.html#cb161-36" tabindex="-1"></a>      , <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb161-37"><a href="field_valid.html#cb161-37" tabindex="-1"></a>      , <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb161-38"><a href="field_valid.html#cb161-38" tabindex="-1"></a>      , <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>,<span class="at">size=</span><span class="dv">10</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>)</span>
<span id="cb161-39"><a href="field_valid.html#cb161-39" tabindex="-1"></a>      , <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb161-40"><a href="field_valid.html#cb161-40" tabindex="-1"></a>      , <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;gray88&quot;</span>)</span>
<span id="cb161-41"><a href="field_valid.html#cb161-41" tabindex="-1"></a>    )</span></code></pre></div>
<p><img src="metashape_testing_files/figure-html/fld-dta-sum-htdbh-dist-1.png" width="1008" /></p>
</div>
<div id="detected-overstory-tp-height-difference" class="section level3 hasAnchor" number="5.6.3">
<h3><span class="header-section-number">5.6.3</span> Detected Overstory (<span class="math inline">\(TP\)</span>) Height Difference<a href="field_valid.html#detected-overstory-tp-height-difference" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Detected overstory tree (<span class="math inline">\(TP\)</span>) height reliability.</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="field_valid.html#cb162-1" tabindex="-1"></a>field_uas_comparison_temp <span class="sc">%&gt;%</span></span>
<span id="cb162-2"><a href="field_valid.html#cb162-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(field_uas_group <span class="sc">==</span> <span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb162-3"><a href="field_valid.html#cb162-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(field_uas_group) <span class="sc">%&gt;%</span> </span>
<span id="cb162-4"><a href="field_valid.html#cb162-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb162-5"><a href="field_valid.html#cb162-5" tabindex="-1"></a>    <span class="at">plot_lab =</span> <span class="fu">paste0</span>(</span>
<span id="cb162-6"><a href="field_valid.html#cb162-6" tabindex="-1"></a>      field_uas_group</span>
<span id="cb162-7"><a href="field_valid.html#cb162-7" tabindex="-1"></a>      ,<span class="st">&quot; (n=&quot;</span>, scales<span class="sc">::</span><span class="fu">comma</span>(dplyr<span class="sc">::</span><span class="fu">n</span>(),<span class="at">accuracy=</span><span class="dv">1</span>),<span class="st">&quot;)&quot;</span></span>
<span id="cb162-8"><a href="field_valid.html#cb162-8" tabindex="-1"></a>    )</span>
<span id="cb162-9"><a href="field_valid.html#cb162-9" tabindex="-1"></a>    , <span class="at">med =</span> <span class="fu">median</span>(height_diff_pct, <span class="at">na.rm=</span>T)</span>
<span id="cb162-10"><a href="field_valid.html#cb162-10" tabindex="-1"></a>    , <span class="at">color_box =</span> med<span class="sc">&lt;</span><span class="dv">0</span></span>
<span id="cb162-11"><a href="field_valid.html#cb162-11" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb162-12"><a href="field_valid.html#cb162-12" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> height_diff_pct)) <span class="sc">+</span> <span class="co"># height_diff_pct</span></span>
<span id="cb162-13"><a href="field_valid.html#cb162-13" tabindex="-1"></a>  <span class="co"># ggplot(mapping = aes(x = height_diff_pct, y = plot_lab )) + # height_diff_pct</span></span>
<span id="cb162-14"><a href="field_valid.html#cb162-14" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;gray22&quot;</span>, <span class="at">lwd =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb162-15"><a href="field_valid.html#cb162-15" tabindex="-1"></a>    <span class="co"># geom_boxplot(mapping = aes(fill = color_box), alpha = 0.8, width = 0.7, outlier.shape = NA) +</span></span>
<span id="cb162-16"><a href="field_valid.html#cb162-16" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> color_box), <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb162-17"><a href="field_valid.html#cb162-17" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> med), <span class="at">color =</span> <span class="st">&quot;gray66&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span> <span class="co"># ymin = -Inf, ymax = Inf</span></span>
<span id="cb162-18"><a href="field_valid.html#cb162-18" tabindex="-1"></a>    <span class="fu">geom_text</span>(</span>
<span id="cb162-19"><a href="field_valid.html#cb162-19" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">x =</span> med, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">&quot;median: &quot;</span>,scales<span class="sc">::</span><span class="fu">percent</span>(med, <span class="at">accuracy =</span> <span class="fl">0.1</span>)))</span>
<span id="cb162-20"><a href="field_valid.html#cb162-20" tabindex="-1"></a>      , <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">vjust =</span> <span class="dv">1</span></span>
<span id="cb162-21"><a href="field_valid.html#cb162-21" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb162-22"><a href="field_valid.html#cb162-22" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;steelblue&quot;</span>, <span class="st">&quot;coral&quot;</span>)) <span class="sc">+</span></span>
<span id="cb162-23"><a href="field_valid.html#cb162-23" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(</span>
<span id="cb162-24"><a href="field_valid.html#cb162-24" tabindex="-1"></a>      <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>()</span>
<span id="cb162-25"><a href="field_valid.html#cb162-25" tabindex="-1"></a>      , <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">extended_breaks</span>(<span class="at">n=</span><span class="dv">8</span>)</span>
<span id="cb162-26"><a href="field_valid.html#cb162-26" tabindex="-1"></a>      , <span class="at">limits =</span> <span class="fu">c</span>(</span>
<span id="cb162-27"><a href="field_valid.html#cb162-27" tabindex="-1"></a>        <span class="sc">-</span><span class="fu">max</span>(field_uas_comparison_temp<span class="sc">$</span>abs_height_diff_pct, <span class="at">na.rm =</span> T)</span>
<span id="cb162-28"><a href="field_valid.html#cb162-28" tabindex="-1"></a>        , <span class="fu">max</span>(field_uas_comparison_temp<span class="sc">$</span>abs_height_diff_pct, <span class="at">na.rm =</span> T)</span>
<span id="cb162-29"><a href="field_valid.html#cb162-29" tabindex="-1"></a>      )</span>
<span id="cb162-30"><a href="field_valid.html#cb162-30" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb162-31"><a href="field_valid.html#cb162-31" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb162-32"><a href="field_valid.html#cb162-32" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb162-33"><a href="field_valid.html#cb162-33" tabindex="-1"></a>      <span class="at">fill =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb162-34"><a href="field_valid.html#cb162-34" tabindex="-1"></a>      , <span class="at">y =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb162-35"><a href="field_valid.html#cb162-35" tabindex="-1"></a>      , <span class="at">x =</span> <span class="st">&quot;Percent Difference in Height&quot;</span></span>
<span id="cb162-36"><a href="field_valid.html#cb162-36" tabindex="-1"></a>      , <span class="at">title =</span> <span class="st">&quot;Detected Overstory Height Difference&quot;</span></span>
<span id="cb162-37"><a href="field_valid.html#cb162-37" tabindex="-1"></a>      , <span class="at">caption =</span> <span class="st">&quot;-values = UAS&lt;field | +values = UAS&gt;field&quot;</span></span>
<span id="cb162-38"><a href="field_valid.html#cb162-38" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb162-39"><a href="field_valid.html#cb162-39" tabindex="-1"></a>    <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb162-40"><a href="field_valid.html#cb162-40" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb162-41"><a href="field_valid.html#cb162-41" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb162-42"><a href="field_valid.html#cb162-42" tabindex="-1"></a>      , <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb162-43"><a href="field_valid.html#cb162-43" tabindex="-1"></a>      , <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb162-44"><a href="field_valid.html#cb162-44" tabindex="-1"></a>      , <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>,<span class="at">size=</span><span class="dv">10</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>)</span>
<span id="cb162-45"><a href="field_valid.html#cb162-45" tabindex="-1"></a>    )</span></code></pre></div>
<p><img src="metashape_testing_files/figure-html/fld-dta-sum-ht-1.png" width="1008" /></p>
</div>
<div id="detected-overstory-tp-dbh-difference" class="section level3 hasAnchor" number="5.6.4">
<h3><span class="header-section-number">5.6.4</span> Detected Overstory (<span class="math inline">\(TP\)</span>) DBH Difference<a href="field_valid.html#detected-overstory-tp-dbh-difference" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Detected overstory tree (<span class="math inline">\(TP\)</span>) DBH reliability.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="field_valid.html#cb163-1" tabindex="-1"></a>field_uas_comparison_temp <span class="sc">%&gt;%</span></span>
<span id="cb163-2"><a href="field_valid.html#cb163-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(field_uas_group <span class="sc">==</span> <span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb163-3"><a href="field_valid.html#cb163-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(field_uas_group) <span class="sc">%&gt;%</span> </span>
<span id="cb163-4"><a href="field_valid.html#cb163-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb163-5"><a href="field_valid.html#cb163-5" tabindex="-1"></a>    <span class="at">plot_lab =</span> <span class="fu">paste0</span>(</span>
<span id="cb163-6"><a href="field_valid.html#cb163-6" tabindex="-1"></a>      field_uas_group</span>
<span id="cb163-7"><a href="field_valid.html#cb163-7" tabindex="-1"></a>      ,<span class="st">&quot; (n=&quot;</span>, scales<span class="sc">::</span><span class="fu">comma</span>(dplyr<span class="sc">::</span><span class="fu">n</span>(),<span class="at">accuracy=</span><span class="dv">1</span>),<span class="st">&quot;)&quot;</span></span>
<span id="cb163-8"><a href="field_valid.html#cb163-8" tabindex="-1"></a>    )</span>
<span id="cb163-9"><a href="field_valid.html#cb163-9" tabindex="-1"></a>    , <span class="at">med =</span> <span class="fu">median</span>(dbh_diff_pct, <span class="at">na.rm=</span>T)</span>
<span id="cb163-10"><a href="field_valid.html#cb163-10" tabindex="-1"></a>    , <span class="at">color_box =</span> med<span class="sc">&lt;</span><span class="dv">0</span></span>
<span id="cb163-11"><a href="field_valid.html#cb163-11" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb163-12"><a href="field_valid.html#cb163-12" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> dbh_diff_pct)) <span class="sc">+</span> <span class="co"># height_diff_pct</span></span>
<span id="cb163-13"><a href="field_valid.html#cb163-13" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;gray22&quot;</span>, <span class="at">lwd =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb163-14"><a href="field_valid.html#cb163-14" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> color_box), <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb163-15"><a href="field_valid.html#cb163-15" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> med), <span class="at">color =</span> <span class="st">&quot;gray66&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span> <span class="co"># ymin = -Inf, ymax = Inf</span></span>
<span id="cb163-16"><a href="field_valid.html#cb163-16" tabindex="-1"></a>    <span class="fu">geom_text</span>(</span>
<span id="cb163-17"><a href="field_valid.html#cb163-17" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">x =</span> med, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">&quot;median: &quot;</span>,scales<span class="sc">::</span><span class="fu">percent</span>(med, <span class="at">accuracy =</span> <span class="fl">0.1</span>)))</span>
<span id="cb163-18"><a href="field_valid.html#cb163-18" tabindex="-1"></a>      , <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">vjust =</span> <span class="dv">1</span></span>
<span id="cb163-19"><a href="field_valid.html#cb163-19" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb163-20"><a href="field_valid.html#cb163-20" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;steelblue&quot;</span>, <span class="st">&quot;coral&quot;</span>)) <span class="sc">+</span></span>
<span id="cb163-21"><a href="field_valid.html#cb163-21" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(</span>
<span id="cb163-22"><a href="field_valid.html#cb163-22" tabindex="-1"></a>      <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>()</span>
<span id="cb163-23"><a href="field_valid.html#cb163-23" tabindex="-1"></a>      , <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">extended_breaks</span>(<span class="at">n=</span><span class="dv">8</span>)</span>
<span id="cb163-24"><a href="field_valid.html#cb163-24" tabindex="-1"></a>      , <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb163-25"><a href="field_valid.html#cb163-25" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb163-26"><a href="field_valid.html#cb163-26" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb163-27"><a href="field_valid.html#cb163-27" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb163-28"><a href="field_valid.html#cb163-28" tabindex="-1"></a>      <span class="at">fill =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb163-29"><a href="field_valid.html#cb163-29" tabindex="-1"></a>      , <span class="at">y =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb163-30"><a href="field_valid.html#cb163-30" tabindex="-1"></a>      , <span class="at">x =</span> <span class="st">&quot;Percent Difference in DBH&quot;</span></span>
<span id="cb163-31"><a href="field_valid.html#cb163-31" tabindex="-1"></a>      , <span class="at">title =</span> <span class="st">&quot;Detected Overstory DBH Difference&quot;</span></span>
<span id="cb163-32"><a href="field_valid.html#cb163-32" tabindex="-1"></a>      , <span class="at">caption =</span> <span class="st">&quot;-values = UAS&lt;field | +values = UAS&gt;field&quot;</span></span>
<span id="cb163-33"><a href="field_valid.html#cb163-33" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb163-34"><a href="field_valid.html#cb163-34" tabindex="-1"></a>    <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb163-35"><a href="field_valid.html#cb163-35" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb163-36"><a href="field_valid.html#cb163-36" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb163-37"><a href="field_valid.html#cb163-37" tabindex="-1"></a>      , <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb163-38"><a href="field_valid.html#cb163-38" tabindex="-1"></a>      , <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb163-39"><a href="field_valid.html#cb163-39" tabindex="-1"></a>      , <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>,<span class="at">size=</span><span class="dv">10</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>)</span>
<span id="cb163-40"><a href="field_valid.html#cb163-40" tabindex="-1"></a>    )</span></code></pre></div>
<p><img src="metashape_testing_files/figure-html/fld-dta-sum-dbh-1.png" width="1008" /></p>
<div id="detected-overstory-tp-reliability" class="section level4 hasAnchor" number="5.6.4.1">
<h4><span class="header-section-number">5.6.4.1</span> Detected Overstory (<span class="math inline">\(TP\)</span>) Reliability<a href="field_valid.html#detected-overstory-tp-reliability" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="field_valid.html#cb164-1" tabindex="-1"></a>dbh_f_temp <span class="ot">=</span> field_uas_comparison_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(field_uas_group<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(field_dbh_cm)</span>
<span id="cb164-2"><a href="field_valid.html#cb164-2" tabindex="-1"></a>dbh_u_temp <span class="ot">=</span> field_uas_comparison_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(field_uas_group<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(uas_dbh_cm)</span>
<span id="cb164-3"><a href="field_valid.html#cb164-3" tabindex="-1"></a>ht_f_temp <span class="ot">=</span> field_uas_comparison_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(field_uas_group<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(field_tree_height_m)</span>
<span id="cb164-4"><a href="field_valid.html#cb164-4" tabindex="-1"></a>ht_u_temp <span class="ot">=</span> field_uas_comparison_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(field_uas_group<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(uas_tree_height_m)</span>
<span id="cb164-5"><a href="field_valid.html#cb164-5" tabindex="-1"></a></span>
<span id="cb164-6"><a href="field_valid.html#cb164-6" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb164-7"><a href="field_valid.html#cb164-7" tabindex="-1"></a>  <span class="at">mae_dbh =</span> Metrics<span class="sc">::</span><span class="fu">mae</span>(</span>
<span id="cb164-8"><a href="field_valid.html#cb164-8" tabindex="-1"></a>    dbh_f_temp</span>
<span id="cb164-9"><a href="field_valid.html#cb164-9" tabindex="-1"></a>    , dbh_u_temp</span>
<span id="cb164-10"><a href="field_valid.html#cb164-10" tabindex="-1"></a>  )</span>
<span id="cb164-11"><a href="field_valid.html#cb164-11" tabindex="-1"></a>  , <span class="at">mape_dbh =</span> Metrics<span class="sc">::</span><span class="fu">mape</span>(</span>
<span id="cb164-12"><a href="field_valid.html#cb164-12" tabindex="-1"></a>    dbh_f_temp</span>
<span id="cb164-13"><a href="field_valid.html#cb164-13" tabindex="-1"></a>    , dbh_u_temp</span>
<span id="cb164-14"><a href="field_valid.html#cb164-14" tabindex="-1"></a>  )</span>
<span id="cb164-15"><a href="field_valid.html#cb164-15" tabindex="-1"></a>  , <span class="at">rmse_dbh =</span> Metrics<span class="sc">::</span><span class="fu">rmse</span>(</span>
<span id="cb164-16"><a href="field_valid.html#cb164-16" tabindex="-1"></a>    dbh_f_temp</span>
<span id="cb164-17"><a href="field_valid.html#cb164-17" tabindex="-1"></a>    , dbh_u_temp</span>
<span id="cb164-18"><a href="field_valid.html#cb164-18" tabindex="-1"></a>  )</span>
<span id="cb164-19"><a href="field_valid.html#cb164-19" tabindex="-1"></a>    <span class="do">## height</span></span>
<span id="cb164-20"><a href="field_valid.html#cb164-20" tabindex="-1"></a>  , <span class="at">mae_height =</span> Metrics<span class="sc">::</span><span class="fu">mae</span>(</span>
<span id="cb164-21"><a href="field_valid.html#cb164-21" tabindex="-1"></a>    ht_f_temp</span>
<span id="cb164-22"><a href="field_valid.html#cb164-22" tabindex="-1"></a>    , ht_u_temp</span>
<span id="cb164-23"><a href="field_valid.html#cb164-23" tabindex="-1"></a>  )</span>
<span id="cb164-24"><a href="field_valid.html#cb164-24" tabindex="-1"></a>  , <span class="at">mape_height =</span> Metrics<span class="sc">::</span><span class="fu">mape</span>(</span>
<span id="cb164-25"><a href="field_valid.html#cb164-25" tabindex="-1"></a>    ht_f_temp</span>
<span id="cb164-26"><a href="field_valid.html#cb164-26" tabindex="-1"></a>    , ht_u_temp</span>
<span id="cb164-27"><a href="field_valid.html#cb164-27" tabindex="-1"></a>  )</span>
<span id="cb164-28"><a href="field_valid.html#cb164-28" tabindex="-1"></a>  , <span class="at">rmse_height =</span> Metrics<span class="sc">::</span><span class="fu">rmse</span>(</span>
<span id="cb164-29"><a href="field_valid.html#cb164-29" tabindex="-1"></a>    ht_f_temp</span>
<span id="cb164-30"><a href="field_valid.html#cb164-30" tabindex="-1"></a>    , ht_u_temp</span>
<span id="cb164-31"><a href="field_valid.html#cb164-31" tabindex="-1"></a>  )</span>
<span id="cb164-32"><a href="field_valid.html#cb164-32" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb164-33"><a href="field_valid.html#cb164-33" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(dplyr<span class="sc">::</span><span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb164-34"><a href="field_valid.html#cb164-34" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">separate_wider_delim</span>(<span class="at">cols =</span> name, <span class="at">delim =</span> <span class="st">&quot;_&quot;</span>, <span class="at">names =</span> <span class="fu">c</span>(<span class="st">&quot;error&quot;</span>, <span class="st">&quot;metric&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb164-35"><a href="field_valid.html#cb164-35" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> error, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span> </span>
<span id="cb164-36"><a href="field_valid.html#cb164-36" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb164-37"><a href="field_valid.html#cb164-37" tabindex="-1"></a>    <span class="at">metric =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb164-38"><a href="field_valid.html#cb164-38" tabindex="-1"></a>      metric <span class="sc">==</span> <span class="st">&quot;dbh&quot;</span> <span class="sc">~</span> <span class="st">&quot;DBH (cm)&quot;</span></span>
<span id="cb164-39"><a href="field_valid.html#cb164-39" tabindex="-1"></a>      , metric <span class="sc">==</span> <span class="st">&quot;height&quot;</span> <span class="sc">~</span> <span class="st">&quot;Height (m)&quot;</span></span>
<span id="cb164-40"><a href="field_valid.html#cb164-40" tabindex="-1"></a>    )</span>
<span id="cb164-41"><a href="field_valid.html#cb164-41" tabindex="-1"></a>    , <span class="at">n =</span> field_uas_comparison_temp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(field_uas_group<span class="sc">==</span><span class="st">&quot;true positive&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span>
<span id="cb164-42"><a href="field_valid.html#cb164-42" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb164-43"><a href="field_valid.html#cb164-43" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb164-44"><a href="field_valid.html#cb164-44" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">&quot;Detected overstory tree height and DBH prediction performance&quot;</span></span>
<span id="cb164-45"><a href="field_valid.html#cb164-45" tabindex="-1"></a>      , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb164-46"><a href="field_valid.html#cb164-46" tabindex="-1"></a>        <span class="st">&quot; &quot;</span></span>
<span id="cb164-47"><a href="field_valid.html#cb164-47" tabindex="-1"></a>        , <span class="st">&quot;Mean Abs. Error&quot;</span></span>
<span id="cb164-48"><a href="field_valid.html#cb164-48" tabindex="-1"></a>        , <span class="st">&quot;Mean Abs. Percent Error&quot;</span></span>
<span id="cb164-49"><a href="field_valid.html#cb164-49" tabindex="-1"></a>        , <span class="st">&quot;Root Mean Squared Error&quot;</span></span>
<span id="cb164-50"><a href="field_valid.html#cb164-50" tabindex="-1"></a>        , <span class="st">&quot;N&quot;</span></span>
<span id="cb164-51"><a href="field_valid.html#cb164-51" tabindex="-1"></a>      )</span>
<span id="cb164-52"><a href="field_valid.html#cb164-52" tabindex="-1"></a>      , <span class="at">digits =</span> <span class="dv">2</span></span>
<span id="cb164-53"><a href="field_valid.html#cb164-53" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb164-54"><a href="field_valid.html#cb164-54" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:fld-dta-sum-rmse">Table 5.1: </span>Detected overstory tree height and DBH prediction performance
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Mean Abs. Error
</th>
<th style="text-align:right;">
Mean Abs. Percent Error
</th>
<th style="text-align:right;">
Root Mean Squared Error
</th>
<th style="text-align:right;">
N
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
DBH (cm)
</td>
<td style="text-align:right;">
11.55
</td>
<td style="text-align:right;">
0.90
</td>
<td style="text-align:right;">
12.98
</td>
<td style="text-align:right;">
229
</td>
</tr>
<tr>
<td style="text-align:left;">
Height (m)
</td>
<td style="text-align:right;">
0.79
</td>
<td style="text-align:right;">
0.07
</td>
<td style="text-align:right;">
0.99
</td>
<td style="text-align:right;">
229
</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="stats_processing_time.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
